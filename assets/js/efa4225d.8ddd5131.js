"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6114],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),l=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,s=e.originalType,p=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),d=l(t),m=o,k=d["".concat(p,".").concat(m)]||d[m]||c[m]||s;return t?r.createElement(k,i(i({ref:n},u),{},{components:t})):r.createElement(k,i({ref:n},u))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=t.length,i=new Array(s);i[0]=d;var a={};for(var p in n)hasOwnProperty.call(n,p)&&(a[p]=n[p]);a.originalType=e,a.mdxType="string"==typeof e?e:o,i[1]=a;for(var l=2;l<s;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},8406:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return a},contentTitle:function(){return p},metadata:function(){return l},toc:function(){return u},default:function(){return d}});var r=t(7462),o=t(3366),s=(t(7294),t(3905)),i=["components"],a={title:"[TS] ts-axios(8) - \u5f02\u5e38\u5904\u7406",sidebar_position:16},p=void 0,l={unversionedId:"TypeScript/ts-axios-8",id:"TypeScript/ts-axios-8",title:"[TS] ts-axios(8) - \u5f02\u5e38\u5904\u7406",description:"-----",source:"@site/docs/TypeScript/ts-axios-8.md",sourceDirName:"TypeScript",slug:"/TypeScript/ts-axios-8",permalink:"/docs/TypeScript/ts-axios-8",editUrl:"https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/TypeScript/ts-axios-8.md",tags:[],version:"current",sidebarPosition:16,frontMatter:{title:"[TS] ts-axios(8) - \u5f02\u5e38\u5904\u7406",sidebar_position:16},sidebar:"tutorialSidebar",previous:{title:"[TS] ts-axios(7) - \u57fa\u7840\u529f\u80fd(\u83b7\u53d6\u54cd\u5e94data)",permalink:"/docs/TypeScript/ts-axios-7"},next:{title:"[TS] ts-axios(9) - \u63a5\u53e3\u6269\u5c55",permalink:"/docs/TypeScript/ts-axios-9"}},u=[{value:"\u9700\u6c42\u5206\u6790",id:"\u9700\u6c42\u5206\u6790",children:[],level:2},{value:"\u5904\u7406\u7f51\u7edc\u5f02\u5e38\u9519\u8bef",id:"\u5904\u7406\u7f51\u7edc\u5f02\u5e38\u9519\u8bef",children:[],level:2},{value:"\u5904\u7406\u8d85\u65f6\u9519\u8bef",id:"\u5904\u7406\u8d85\u65f6\u9519\u8bef",children:[],level:2},{value:"\u5904\u7406\u975e 200 \u72b6\u6001\u7801",id:"\u5904\u7406\u975e-200-\u72b6\u6001\u7801",children:[],level:2},{value:"demo \u7f16\u5199",id:"demo-\u7f16\u5199",children:[],level:2},{value:"\u9519\u8bef\u4fe1\u606f\u589e\u5f3a",id:"\u9519\u8bef\u4fe1\u606f\u589e\u5f3a",children:[{value:"\u521b\u5efa AxiosError \u7c7b",id:"\u521b\u5efa-axioserror-\u7c7b",children:[],level:3},{value:"createError \u65b9\u6cd5\u5e94\u7528",id:"createerror-\u65b9\u6cd5\u5e94\u7528",children:[],level:3},{value:"\u5bfc\u51fa\u7c7b\u578b\u5b9a\u4e49",id:"\u5bfc\u51fa\u7c7b\u578b\u5b9a\u4e49",children:[],level:3}],level:2}],c={toc:u};function d(e){var n=e.components,t=(0,o.Z)(e,i);return(0,s.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"\u9700\u6c42\u5206\u6790"},"\u9700\u6c42\u5206\u6790"),(0,s.kt)("p",null,"\u5728\u4e0a\u4e00\u7ae0\u8282\uff0c\u6211\u4eec\u5b9e\u73b0\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"ts-axios")," \u7684\u57fa\u7840\u529f\u80fd\uff0c\u4f46\u76ee\u524d\u4e3a\u6b62\u6211\u4eec\u90fd\u662f\u5904\u7406\u4e86\u6b63\u5e38\u63a5\u6536\u8bf7\u6c42\u7684\u903b\u8f91\uff0c\u5e76\u6ca1\u6709\u8003\u8651\u5230\u4efb\u4f55\u9519\u8bef\u60c5\u51b5\u7684\u5904\u7406\uff0c\u8fd9\u5bf9\u4e8e\u4e00\u4e2a\u7a0b\u5e8f\u7684\u5065\u58ee\u6027\u800c\u8a00\u662f\u8fdc\u4e0d\u591f\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u8fd9\u4e00\u7ae0\u9700\u8981\u5bf9 AJAX \u5404\u79cd\u9519\u8bef\u60c5\u51b5\u505a\u5904\u7406\u3002"),(0,s.kt)("p",null,"\u5e76\u4e14\u6211\u4eec\u5e0c\u671b\u7a0b\u5e8f\u4e5f\u80fd\u6355\u83b7\u5230\u8fd9\u4e9b\u9519\u8bef\uff0c\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"axios({\n  method: 'get',\n  url: '/error/get'\n}).then((res) => {\n  console.log(res)\n}).catch((e) => {\n  console.log(e)\n})\n")),(0,s.kt)("p",null,"\u5982\u679c\u5728\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4efb\u4f55\u9519\u8bef\uff0c\u6211\u4eec\u90fd\u53ef\u4ee5\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"reject")," \u56de\u8c03\u51fd\u6570\u4e2d\u6355\u83b7\u5230\u3002"),(0,s.kt)("p",null,"\u6211\u4eec\u628a\u9519\u8bef\u5206\u6210\u4e86\u51e0\u7c7b\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u5206\u522b\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\u60c5\u51b5\u3002"),(0,s.kt)("h2",{id:"\u5904\u7406\u7f51\u7edc\u5f02\u5e38\u9519\u8bef"},"\u5904\u7406\u7f51\u7edc\u5f02\u5e38\u9519\u8bef"),(0,s.kt)("p",null,"\u5f53\u7f51\u7edc\u51fa\u73b0\u5f02\u5e38\uff08\u6bd4\u5982\u4e0d\u901a\uff09\u7684\u65f6\u5019\u53d1\u9001\u8bf7\u6c42\u4f1a\u89e6\u53d1 ",(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," \u5bf9\u8c61\u5b9e\u4f8b\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"error")," \u4e8b\u4ef6\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5728 ",(0,s.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequestEventTarget/onerror"},(0,s.kt)("inlineCode",{parentName:"a"},"onerror"))," \u7684\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\u4e2d\u6355\u83b7\u6b64\u7c7b\u9519\u8bef\u3002"),(0,s.kt)("p",null,"\u6211\u4eec\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"xhr")," \u51fd\u6570\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"request.onerror = function handleError() {\n  reject(new Error('Network Error'))\n}\n")),(0,s.kt)("h2",{id:"\u5904\u7406\u8d85\u65f6\u9519\u8bef"},"\u5904\u7406\u8d85\u65f6\u9519\u8bef"),(0,s.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u67d0\u4e2a\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4 ",(0,s.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/timeout"},(0,s.kt)("inlineCode",{parentName:"a"},"timeout")),"\uff0c\u4e5f\u5c31\u662f\u5f53\u8bf7\u6c42\u53d1\u9001\u540e\u8d85\u8fc7\u67d0\u4e2a\u65f6\u95f4\u540e\u4ecd\u7136\u6ca1\u6536\u5230\u54cd\u5e94\uff0c\u5219\u8bf7\u6c42\u81ea\u52a8\u7ec8\u6b62\uff0c\u5e76\u89e6\u53d1 ",(0,s.kt)("inlineCode",{parentName:"p"},"timeout")," \u4e8b\u4ef6\u3002"),(0,s.kt)("p",null,"\u8bf7\u6c42\u9ed8\u8ba4\u7684\u8d85\u65f6\u65f6\u95f4\u662f 0\uff0c\u5373\u6c38\u4e0d\u8d85\u65f6\u3002\u6240\u4ee5\u6211\u4eec\u9996\u5148\u9700\u8981\u5141\u8bb8\u7a0b\u5e8f\u53ef\u4ee5\u914d\u7f6e\u8d85\u65f6\u65f6\u95f4\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface AxiosRequestConfig {\n  // ...\n  timeout?: number\n}\n")),(0,s.kt)("p",null,"\u63a5\u7740\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"xhr")," \u51fd\u6570\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const { /*...*/ timeout } = config\n\nif (timeout) {\n  request.timeout = timeout\n}\n\nrequest.ontimeout = function handleTimeout() {\n  reject(new Error(`Timeout of ${timeout} ms exceeded`))\n}\n")),(0,s.kt)("h2",{id:"\u5904\u7406\u975e-200-\u72b6\u6001\u7801"},"\u5904\u7406\u975e 200 \u72b6\u6001\u7801"),(0,s.kt)("p",null,"\u5bf9\u4e8e\u4e00\u4e2a\u6b63\u5e38\u7684\u8bf7\u6c42\uff0c\u5f80\u5f80\u4f1a\u8fd4\u56de 200-300 \u4e4b\u95f4\u7684 HTTP \u72b6\u6001\u7801\uff0c\u5bf9\u4e8e\u4e0d\u5728\u8fd9\u4e2a\u533a\u95f4\u7684\u72b6\u6001\u7801\uff0c\u6211\u4eec\u4e5f\u628a\u5b83\u4eec\u8ba4\u4e3a\u662f\u4e00\u79cd\u9519\u8bef\u7684\u60c5\u51b5\u505a\u5904\u7406\u3002"),(0,s.kt)("p",null,"\u5904\u7406\u72b6\u6001\u7801\u7684\u65f6\u673a, \u662f\u5728\u63a5\u6536\u5230\u54cd\u5e94\u7684\u65f6\u5019"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"request.onreadystatechange = function handleLoad() {\n  if (request.readyState !== 4) {\n    return\n  }\n\n  if (request.status === 0) {\n    return\n  }\n\n  const responseHeaders = parseHeaders(request.getAllResponseHeaders())\n  const responseData =\n    responseType && responseType !== 'text' ? request.response : request.responseText\n  const response: AxiosResponse = {\n    data: responseData,\n    status: request.status,\n    statusText: request.statusText,\n    headers: responseHeaders,\n    config,\n    request\n  }\n  handleResponse(response)\n}\n\nfunction handleResponse(response: AxiosResponse) {\n  if (response.status >= 200 && response.status < 300) {\n    resolve(response)\n  } else {\n    reject(new Error(`Request failed with status code ${response.status}`))\n  }\n}\n")),(0,s.kt)("p",null,"\u6211\u4eec\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"onreadystatechange")," \u7684\u56de\u8c03\u51fd\u6570\u4e2d\uff0c\u6dfb\u52a0\u4e86\u5bf9 ",(0,s.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/status"},(0,s.kt)("inlineCode",{parentName:"a"},"request.status"))," \u7684\u5224\u65ad\uff0c\u56e0\u4e3a\u5f53\u51fa\u73b0\u7f51\u7edc\u9519\u8bef\u6216\u8005\u8d85\u65f6\u9519\u8bef\u7684\u65f6\u5019\uff0c\u8be5\u503c\u90fd\u4e3a 0\u3002"),(0,s.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"handleResponse")," \u51fd\u6570\u4e2d\u5bf9 ",(0,s.kt)("inlineCode",{parentName:"p"},"request.status")," \u7684\u503c\u518d\u6b21\u5224\u65ad\uff0c\u5982\u679c\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"2xx")," \u7684\u72b6\u6001\u7801\uff0c\u5219\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6b63\u5e38\u7684\u8bf7\u6c42\uff0c\u5426\u5219\u629b\u9519\u3002"),(0,s.kt)("h2",{id:"demo-\u7f16\u5199"},"demo \u7f16\u5199"),(0,s.kt)("p",null,"\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"examples")," \u76ee\u5f55\u4e0b\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"error")," \u76ee\u5f55\uff0c\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"error")," \u76ee\u5f55\u4e0b\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"index.html"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <meta charset="utf-8">\n    <title>Error example</title>\n  </head>\n  <body>\n    <script src="/__build__/error.js"><\/script>\n  </body>\n</html>\n')),(0,s.kt)("p",null,"\u63a5\u7740\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"app.ts")," \u4f5c\u4e3a\u5165\u53e3\u6587\u4ef6\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import axios from '../../src/index'\n\naxios({\n  method: 'get',\n  url: '/error/get1'\n}).then((res) => {\n  console.log(res)\n}).catch((e) => {\n  console.log(e)\n})\n\naxios({\n  method: 'get',\n  url: '/error/get'\n}).then((res) => {\n  console.log(res)\n}).catch((e) => {\n  console.log(e)\n})\n\nsetTimeout(() => {\n  axios({\n    method: 'get',\n    url: '/error/get'\n  }).then((res) => {\n    console.log(res)\n  }).catch((e) => {\n    console.log(e)\n  })\n}, 5000)\n\naxios({\n  method: 'get',\n  url: '/error/timeout',\n  timeout: 2000\n}).then((res) => {\n  console.log(res)\n}).catch((e) => {\n  console.log(e.message)\n})\n")),(0,s.kt)("p",null,"\u63a5\u7740\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"server.js")," \u6dfb\u52a0\u65b0\u7684\u63a5\u53e3\u8def\u7531\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"router.get('/error/get', function(req, res) {\n  if (Math.random() > 0.5) {\n    res.json({\n      msg: `hello world`\n    })\n  } else {\n    res.status(500)\n    res.end()\n  }\n})\n\nrouter.get('/error/timeout', function(req, res) {\n  setTimeout(() => {\n    res.json({\n      msg: `hello world`\n    })\n  }, 3000)\n})\n")),(0,s.kt)("p",null,"\u7136\u540e\u5728\u547d\u4ee4\u884c\u8fd0\u884c ",(0,s.kt)("inlineCode",{parentName:"p"},"npm run dev"),"\uff0c\u63a5\u7740\u6253\u5f00 chrome \u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee ",(0,s.kt)("inlineCode",{parentName:"p"},"http://localhost:8080/")," \u5373\u53ef\u8bbf\u95ee\u6211\u4eec\u7684 demo \u4e86\uff0c\u6211\u4eec\u70b9\u5230 ",(0,s.kt)("inlineCode",{parentName:"p"},"Error")," \u76ee\u5f55\u4e0b\uff0c\u901a\u8fc7\u5f00\u53d1\u8005\u5de5\u5177\u7684 network \u90e8\u5206\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e0d\u540c\u7684\u9519\u8bef\u60c5\u51b5\u3002"),(0,s.kt)("p",null,"\u81f3\u6b64\u6211\u4eec\u5bf9\u5404\u79cd\u9519\u8bef\u90fd\u505a\u4e86\u5904\u7406\uff0c\u5e76\u628a\u5b83\u4eec\u629b\u7ed9\u4e86\u7a0b\u5e8f\u5e94\u7528\u65b9\uff0c\u8ba9\u4ed6\u4eec\u5bf9\u9519\u8bef\u53ef\u4ee5\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002\u4f46\u662f\u8fd9\u91cc\u6211\u4eec\u7684\u9519\u8bef\u90fd\u4ec5\u4ec5\u662f\u7b80\u5355\u7684 Error \u5b9e\u4f8b\uff0c\u53ea\u6709\u9519\u8bef\u6587\u672c\u4fe1\u606f\uff0c\u5e76\u4e0d\u5305\u542b\u662f\u54ea\u4e2a\u8bf7\u6c42\u3001\u8bf7\u6c42\u7684\u914d\u7f6e\u3001\u54cd\u5e94\u5bf9\u8c61\u7b49\u5176\u5b83\u4fe1\u606f\u3002\u90a3\u4e48\u4e0b\u4e00\u8282\u8bfe\uff0c\u6211\u4eec\u4f1a\u5bf9\u9519\u8bef\u4fe1\u606f\u505a\u589e\u5f3a\u3002"),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"\u9519\u8bef\u4fe1\u606f\u589e\u5f3a"},"\u9519\u8bef\u4fe1\u606f\u589e\u5f3a"),(0,s.kt)("p",null,"\u6211\u4eec\u5df2\u7ecf\u6355\u83b7\u4e86\u51e0\u7c7b AJAX \u7684\u9519\u8bef\uff0c\u4f46\u662f\u5bf9\u4e8e\u9519\u8bef\u4fe1\u606f\u63d0\u4f9b\u7684\u975e\u5e38\u6709\u9650\uff0c\u6211\u4eec\u5e0c\u671b\u5bf9\u5916\u63d0\u4f9b\u7684\u4fe1\u606f\u4e0d\u4ec5\u4ec5\u5305\u542b\u9519\u8bef\u6587\u672c\u4fe1\u606f\uff0c\u8fd8\u5305\u62ec\u4e86\u8bf7\u6c42\u5bf9\u8c61\u914d\u7f6e ",(0,s.kt)("inlineCode",{parentName:"p"},"config"),"\uff0c\u9519\u8bef\u4ee3\u7801 ",(0,s.kt)("inlineCode",{parentName:"p"},"code"),"\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"XMLHttpRequest")," \u5bf9\u8c61\u5b9e\u4f8b ",(0,s.kt)("inlineCode",{parentName:"p"},"request"),"\u4ee5\u53ca\u81ea\u5b9a\u4e49\u54cd\u5e94\u5bf9\u8c61 ",(0,s.kt)("inlineCode",{parentName:"p"},"response"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"axios({\n  method: 'get',\n  url: '/error/timeout',\n  timeout: 2000\n}).then((res) => {\n  console.log(res)\n}).catch((e: AxiosError) => {\n  console.log(e.message)\n  console.log(e.request)\n  console.log(e.code)\n})\n")),(0,s.kt)("p",null,"\u8fd9\u6837\u5bf9\u4e8e\u5e94\u7528\u65b9\u6765\u8bf4\uff0c\u4ed6\u4eec\u5c31\u53ef\u4ee5\u6355\u83b7\u5230\u8fd9\u4e9b\u9519\u8bef\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002"),(0,s.kt)("p",null,"\u90a3\u4e48\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u6765\u5bf9\u9519\u8bef\u4fe1\u606f\u505a\u589e\u5f3a\u3002"),(0,s.kt)("h3",{id:"\u521b\u5efa-axioserror-\u7c7b"},"\u521b\u5efa AxiosError \u7c7b"),(0,s.kt)("p",null,"\u6211\u4eec\u5148\u6765\u5b9a\u4e49 ",(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7c7b\u578b\u63a5\u53e3\uff0c\u7528\u4e8e\u5916\u90e8\u4f7f\u7528\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"types/index.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"export interface AxiosError extends Error {\n  config: AxiosRequestConfig\n  code?: string\n  request?: any\n  response?: AxiosResponse\n  isAxiosError: boolean\n}\n")),(0,s.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"error.ts")," \u6587\u4ef6\uff0c\u7136\u540e\u5b9e\u73b0 ",(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7c7b\uff0c\u5b83\u662f\u7ee7\u627f\u4e8e ",(0,s.kt)("inlineCode",{parentName:"p"},"Error")," \u7c7b\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"helpers/error.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { AxiosRequestConfig, AxiosResponse } from '../types'\n\nexport class AxiosError extends Error {\n  isAxiosError: boolean\n  config: AxiosRequestConfig\n  code?: string | null\n  request?: any\n  response?: AxiosResponse\n\n  constructor(\n    message: string,\n    config: AxiosRequestConfig,\n    code?: string | null,\n    request?: any,\n    response?: AxiosResponse\n  ) {\n    super(message)\n\n    this.config = config\n    this.code = code\n    this.request = request\n    this.response = response\n    this.isAxiosError = true\n\n    Object.setPrototypeOf(this, AxiosError.prototype)\n  }\n}\n\nexport function createError(\n  message: string,\n  config: AxiosRequestConfig,\n  code?: string | null,\n  request?: any,\n  response?: AxiosResponse\n): AxiosError {\n  const error = new AxiosError(message, config, code, request, response)\n\n  return error\n}\n")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7ee7\u627f\u4e8e ",(0,s.kt)("inlineCode",{parentName:"p"},"Error")," \u7c7b\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e9b\u81ea\u5df1\u7684\u5c5e\u6027\uff1a",(0,s.kt)("inlineCode",{parentName:"p"},"config"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"code"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"request"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"response"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"isAxiosError")," \u7b49\u5c5e\u6027\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"Object.setPrototypeOf(this, AxiosError.prototype)"),"\uff0c\u8fd9\u6bb5\u4ee3\u7801\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3 TypeScript \u7ee7\u627f\u4e00\u4e9b\u5185\u7f6e\u5bf9\u8c61\u7684\u65f6\u5019\u7684\u5751\uff0c",(0,s.kt)("a",{parentName:"p",href:"https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work"},"\u53c2\u8003"),"\u3002"),(0,s.kt)("p",null,"\u53e6\u5916\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\uff0c\u6211\u4eec\u5bf9\u5916\u66b4\u9732\u4e86\u4e00\u4e2a ",(0,s.kt)("inlineCode",{parentName:"p"},"createError")," \u7684\u5de5\u5382\u65b9\u6cd5\u3002"),(0,s.kt)("h3",{id:"createerror-\u65b9\u6cd5\u5e94\u7528"},"createError \u65b9\u6cd5\u5e94\u7528"),(0,s.kt)("p",null,"\u4fee\u6539\u5173\u4e8e\u9519\u8bef\u5bf9\u8c61\u521b\u5efa\u90e8\u5206\u7684\u903b\u8f91\uff0c\u5982\u4e0b\uff1a"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"xhr.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import { createError } from './helpers/error'\n\nrequest.onerror = function handleError() {\n  reject(createError(\n    'Network Error',\n    config,\n    null,\n    request\n  ))\n}\n\nrequest.ontimeout = function handleTimeout() {\n  reject(createError(\n    `Timeout of ${config.timeout} ms exceeded`,\n    config,\n    'ECONNABORTED',\n    request\n  ))\n}\n\nfunction handleResponse(response: AxiosResponse) {\n  if (response.status >= 200 && response.status < 300) {\n    resolve(response)\n  } else {\n    reject(createError(\n      `Request failed with status code ${response.status}`,\n      config,\n      null,\n      request,\n      response\n    ))\n  }\n}\n")),(0,s.kt)("h3",{id:"\u5bfc\u51fa\u7c7b\u578b\u5b9a\u4e49"},"\u5bfc\u51fa\u7c7b\u578b\u5b9a\u4e49"),(0,s.kt)("p",null,"\u5728 demo \u4e2d\uff0cTypeScript \u5e76\u4e0d\u80fd\u628a ",(0,s.kt)("inlineCode",{parentName:"p"},"e")," \u53c2\u6570\u63a8\u65ad\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7c7b\u578b\uff0c\u4e8e\u662f\u6211\u4eec\u9700\u8981\u624b\u52a8\u6307\u660e\u7c7b\u578b\uff0c\u4e3a\u4e86\u8ba9\u5916\u90e8\u5e94\u7528\u80fd\u5f15\u5165 ",(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7c7b\u578b\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u628a\u5b83\u4eec\u5bfc\u51fa\u3002"),(0,s.kt)("p",null,"\u6211\u4eec\u521b\u5efa ",(0,s.kt)("inlineCode",{parentName:"p"},"axios.ts")," \u6587\u4ef6\uff0c\u628a\u4e4b\u524d\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"index.ts")," \u7684\u4ee3\u7801\u62f7\u8d1d\u8fc7\u53bb\uff0c\u7136\u540e\u4fee\u6539 ",(0,s.kt)("inlineCode",{parentName:"p"},"index.ts")," \u7684\u4ee3\u7801\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"index.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import axios from './axios'\n\nexport * from './types'\n\nexport default axios\n")),(0,s.kt)("p",null,"\u8fd9\u6837\u6211\u4eec\u5728 demo \u4e2d\u5c31\u53ef\u4ee5\u5f15\u5165 ",(0,s.kt)("inlineCode",{parentName:"p"},"AxiosError")," \u7c7b\u578b\u4e86\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"examples/error/app.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import axios, { AxiosError } from '../../src/index'\n\naxios({\n  method: 'get',\n  url: '/error/timeout',\n  timeout: 2000\n}).then((res) => {\n  console.log(res)\n}).catch((e: AxiosError) => {\n  console.log(e.message)\n  console.log(e.code)\n})\n")),(0,s.kt)("p",null,"\u81f3\u6b64\uff0c\u6211\u4eec\u5173\u4e8e ",(0,s.kt)("inlineCode",{parentName:"p"},"ts-axios")," \u7684\u5f02\u5e38\u5904\u7406\u903b\u8f91\u5c31\u544a\u4e00\u6bb5\u843d\u3002\u4e0b\u9762\u7684\u7ae0\u8282\uff0c\u6211\u4eec\u4f1a\u5bf9 ",(0,s.kt)("inlineCode",{parentName:"p"},"ts-axios")," \u7684\u63a5\u53e3\u505a\u6269\u5c55\uff0c\u8ba9\u5b83\u63d0\u4f9b\u66f4\u591a\u597d\u7528\u548c\u65b9\u4fbf\u7684 API\u3002"))}d.isMDXComponent=!0}}]);