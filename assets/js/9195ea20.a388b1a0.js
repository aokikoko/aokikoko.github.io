"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8042],{3905:(e,t,n)=>{n.d(t,{Zo:()=>o,kt:()=>d});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var k=a.createContext({}),s=function(e){var t=a.useContext(k),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},o=function(e){var t=s(e.components);return a.createElement(k.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,k=e.parentName,o=i(e,["components","mdxType","originalType","parentName"]),c=s(n),d=l,m=c["".concat(k,".").concat(d)]||c[d]||u[d]||r;return n?a.createElement(m,p(p({ref:t},o),{},{components:n})):a.createElement(m,p({ref:t},o))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,p=new Array(r);p[0]=c;var i={};for(var k in t)hasOwnProperty.call(t,k)&&(i[k]=t[k]);i.originalType=e,i.mdxType="string"==typeof e?e:l,p[1]=i;for(var s=2;s<r;s++)p[s]=n[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},39550:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>p,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>k});var a=n(87462),l=(n(67294),n(3905));const r={title:"[Nginx] \u4f01\u4e1a\u67b6\u6784\u53cc\u70b9\u670d\u52a1\u5668HA-\u9ad8\u53ef\u7528",sidebar_position:10},p=void 0,i={unversionedId:"Nginx/ha",id:"Nginx/ha",title:"[Nginx] \u4f01\u4e1a\u67b6\u6784\u53cc\u70b9\u670d\u52a1\u5668HA-\u9ad8\u53ef\u7528",description:"\u80cc\u666f\u63cf\u8ff0\u53ca\u5176\u65b9\u6848\u8bbe\u8ba1",source:"@site/docs/Nginx/ha.md",sourceDirName:"Nginx",slug:"/Nginx/ha",permalink:"/docs/Nginx/ha",editUrl:"https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/Nginx/ha.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{title:"[Nginx] \u4f01\u4e1a\u67b6\u6784\u53cc\u70b9\u670d\u52a1\u5668HA-\u9ad8\u53ef\u7528",sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"[Nginx] \u5b89\u5168",permalink:"/docs/Nginx/safe"},next:{title:"[Nginx] \u4f01\u4e1a\u67b6\u6784\u9ad8\u53ef\u7528\u8d1f\u8f7d\u5747\u8861LB\u670d\u52a1\u5668",permalink:"/docs/Nginx/lb"}},k=[{value:"\u80cc\u666f\u63cf\u8ff0\u53ca\u5176\u65b9\u6848\u8bbe\u8ba1",id:"\u80cc\u666f\u63cf\u8ff0\u53ca\u5176\u65b9\u6848\u8bbe\u8ba1",children:[{value:"1\u3001\u4e1a\u52a1\u80cc\u666f\u63cf\u8ff0",id:"1\u4e1a\u52a1\u80cc\u666f\u63cf\u8ff0",children:[],level:3},{value:"2\u3001\u6a21\u62df\u8fd0\u7ef4\u8bbe\u8ba1\u65b9\u6848",id:"2\u6a21\u62df\u8fd0\u7ef4\u8bbe\u8ba1\u65b9\u6848",children:[],level:3}],level:2},{value:"\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fc1\u79fb",id:"\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fc1\u79fb",children:[{value:"1\u3001\u670d\u52a1\u5668 ip",id:"1\u670d\u52a1\u5668-ip",children:[],level:3},{value:"2\u3001\u670d\u52a1\u5668\u57fa\u672c\u914d\u7f6e",id:"2\u670d\u52a1\u5668\u57fa\u672c\u914d\u7f6e",children:[],level:3},{value:"3\u3001\u6570\u636e\u5907\u4efd\u548c\u8fc1\u79fb",id:"3\u6570\u636e\u5907\u4efd\u548c\u8fc1\u79fb",children:[],level:3}],level:2},{value:"\u9ad8\u53ef\u7528\u670d\u52a1\u642d\u5efa",id:"\u9ad8\u53ef\u7528\u670d\u52a1\u642d\u5efa",children:[{value:"1\u3001HA \u9ad8\u53ef\u7528",id:"1ha-\u9ad8\u53ef\u7528",children:[],level:3},{value:"2\u3001keepalived \u4ecb\u7ecd",id:"2keepalived-\u4ecb\u7ecd",children:[],level:3},{value:"3\u3001keepalived \u7ec4\u6210\u548c\u539f\u7406",id:"3keepalived-\u7ec4\u6210\u548c\u539f\u7406",children:[],level:3},{value:"4\u3001\u5b89\u88c5\u914d\u7f6e\u542f\u52a8 keepalived",id:"4\u5b89\u88c5\u914d\u7f6e\u542f\u52a8-keepalived",children:[],level:3}],level:2},{value:"\u5b9e\u73b0\u670d\u52a1 HA",id:"\u5b9e\u73b0\u670d\u52a1-ha",children:[{value:"1\u3001Nginx \u670d\u52a1\u53ef\u7528\u68c0\u6d4b\u811a\u672c",id:"1nginx-\u670d\u52a1\u53ef\u7528\u68c0\u6d4b\u811a\u672c",children:[],level:3},{value:"2\u3001\u6a21\u62df\u5b95\u673a\u5b9e\u73b0\u670d\u52a1\u5207\u6362",id:"2\u6a21\u62df\u5b95\u673a\u5b9e\u73b0\u670d\u52a1\u5207\u6362",children:[],level:3}],level:2},{value:"keepalived \u7684\u914d\u7f6e\u8865\u5145",id:"keepalived-\u7684\u914d\u7f6e\u8865\u5145",children:[{value:"1\u3001\u975e\u62a2\u5360\u6a21\u5f0f",id:"1\u975e\u62a2\u5360\u6a21\u5f0f",children:[],level:3},{value:"2\u3001\u5355\u64ad\u6a21\u5f0f",id:"2\u5355\u64ad\u6a21\u5f0f",children:[],level:3}],level:2}],s={toc:k};function o(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,a.Z)({},s,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u80cc\u666f\u63cf\u8ff0\u53ca\u5176\u65b9\u6848\u8bbe\u8ba1"},"\u80cc\u666f\u63cf\u8ff0\u53ca\u5176\u65b9\u6848\u8bbe\u8ba1"),(0,l.kt)("h3",{id:"1\u4e1a\u52a1\u80cc\u666f\u63cf\u8ff0"},"1\u3001\u4e1a\u52a1\u80cc\u666f\u63cf\u8ff0"),(0,l.kt)("p",null,"\u200b \u968f\u7740\u7528\u6237\u91cf\u589e\u591a\uff0c\u5355\u53f0 WEB \u670d\u52a1\u5668\uff0c\u538b\u529b\u8d8a\u6765\u8d8a\u5927\u3002\u867d\u7136\u5355\u53f0 WEB \u670d\u52a1\u5668\uff0c\u76ee\u524d\u53ef\u4ee5\u5b8c\u6210\u5de5\u4f5c\u4efb\u52a1\u3002\u4f46\u662f\u5982\u679c\u4e00\u65e6\u5b95\u673a\uff0c\u7528\u6237\u5c31\u5b8c\u5168\u5931\u53bb\u670d\u52a1\u4e86\uff0c\u7528\u6237\u4f53\u9a8c\u7279\u522b\u4e0d\u597d\u3002\u9700\u8981\u5907\u7528\u4e00\u53f0\u670d\u52a1\u5668\u8fdb\u884c\u4f7f\u7528\uff0c\u4e3b\u670d\u52a1\u5668\u5b95\u673a\u4e4b\u540e\uff0c\u5feb\u901f\u5207\u6362\u4e3a\u5907\u7528\u670d\u52a1\u5668"),(0,l.kt)("h3",{id:"2\u6a21\u62df\u8fd0\u7ef4\u8bbe\u8ba1\u65b9\u6848"},"2\u3001\u6a21\u62df\u8fd0\u7ef4\u8bbe\u8ba1\u65b9\u6848"),(0,l.kt)("p",null,"\u5728\u4e4b\u524d\u67b6\u6784\u4e2d\uff0c\u5148\u5c06\u6570\u636e\u5e93\u670d\u52a1\u5668\u5355\u72ec\u8fc1\u79fb"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"ha1",src:n(59614).Z})),(0,l.kt)("p",null,"\u9488\u5bf9 web \u670d\u52a1\u5668\u5355\u70b9\u6545\u969c\uff0c\u5347\u7ea7\u4e3a\u4e3b\u5907\u670d\u52a1\u5668\u67b6\u6784"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"ha2",src:n(26886).Z})),(0,l.kt)("h2",{id:"\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fc1\u79fb"},"\u6570\u636e\u5e93\u670d\u52a1\u5668\u8fc1\u79fb"),(0,l.kt)("h3",{id:"1\u670d\u52a1\u5668-ip"},"1\u3001\u670d\u52a1\u5668 ip"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"server01 WEB \u670d\u52a1\u5668 master 192.168.17.102"),(0,l.kt)("p",{parentName:"blockquote"},"server02 \u6570\u636e\u5e93\u670d\u52a1\u5668 192.168.17.100"),(0,l.kt)("p",{parentName:"blockquote"},"server03 WEB \u670d\u52a1\u5668 backup 192.168.17.101")),(0,l.kt)("h3",{id:"2\u670d\u52a1\u5668\u57fa\u672c\u914d\u7f6e"},"2\u3001\u670d\u52a1\u5668\u57fa\u672c\u914d\u7f6e"),(0,l.kt)("p",null,"\u6839\u636e\u4e4b\u524d\u7684\u670d\u52a1\u5668\u57fa\u672c\u73af\u5883\u7684\u8981\u6c42\u8fdb\u884c\u914d\u7f6e"),(0,l.kt)("p",null,"\u56e0\u4e3a\u662f\u514b\u9686\u83b7\u53d6\u865a\u62df\u673a\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u8fdb\u884c IP \u548c MAC \u5730\u5740\u7684\u4fee\u6539\u5373\u53ef\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'#1\u3001\u5220\u9664\u539f\u6709\u7f51\u5361mac\u5730\u5740\u8bb0\u5f55\u4fe1\u606f\nshell > cd /etc/udev/rules.d\nshell > rm -rf 70-persistent-net.rules\n#2\u3001\u5220\u9664eth0\u91cc\u7684mac\u5730\u5740\u9879 HWADDR\u53c2\u6570\n#3\u3001\u4fee\u6539\u4e3b\u673a\u540d\u79f0\nshell > sed -i "s/server01/server02/" /etc/sysconfig/network;\n#4\u3001\u542f\u52a8\u4e4b\u540e\uff0c\u628ahosts\u6587\u4ef6\u5bf9\u5e94\u4e5f\u505a\u89e3\u6790\n')),(0,l.kt)("h3",{id:"3\u6570\u636e\u5907\u4efd\u548c\u8fc1\u79fb"},"3\u3001\u6570\u636e\u5907\u4efd\u548c\u8fc1\u79fb"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460 \u6e90\u6570\u636e\u5e93\u670d\u52a1\u5668\u5bfc\u51fa\u6570\u636e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u6e90\u6570\u636e\u5e93\u662fserver01 \u5728server01\u4e0a\u64cd\u4f5c\nshell > mysqldump -uroot -p --database tp5shop > /root/tp5shop.sql\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461 \u5bfc\u5165\u6570\u636e\u5230\u65b0\u6570\u636e\u5e93\u670d\u52a1\u5668")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-mysql"},"#\u56e0\u4e3a\u6570\u636e\u5e93\u670d\u52a1\u5668\u514b\u9686\u6765\u7684\uff0c\u6240\u6709\u672c\u8eab\u5177\u6709\u6570\u636e \u53ef\u4ee5\u5220\u9664\u4e86\u5e93\uff0c\u6a21\u62df\u65b0\u673a\u5668\uff0c\u91cd\u65b0\u5bfc\u5165\nmysql > drop database tp5shop;\n#\u521b\u5efa\u6570\u636e\u5e93\u5e76\u5bfc\u5165\u6570\u636e\nmysql > create database tp5shop;\nmysql > use tp5shop;\nmysql > source /root/tp5shop.sql;\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462 \u5728 server02 MySQL \u670d\u52a1\u5668\u4e2d\u5efa\u7acb\u8fdc\u7a0b\u8fde\u63a5\u7528\u6237\u5e76\u6388\u4e88\u6743\u9650")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-mysql"},"mysql > grant all on tp5shop.* to 'tp5shop'@'192.168.17.%' identified by '$Abc3721';\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2463 \u4fee\u6539\u9879\u76ee\u6570\u636e\u5e93\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"shell > vim /usr/local/nginx/html/tp5shop/application/database.php\n")),(0,l.kt)("p",null,"\u4fee\u6539\u53c2\u8003\u793a\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php"},"return [\n    // \u6570\u636e\u5e93\u7c7b\u578b\n    'type'            => 'mysql',\n    // \u670d\u52a1\u5668\u5730\u5740\n    'hostname'        => '192.168.17.100',\n    // \u6570\u636e\u5e93\u540d\n    'database'        => 'tp5shop',\n    // \u7528\u6237\u540d\n    'username'        => 'tp5shop',\n    // \u5bc6\u7801\n    'password'        => '$Abc3721',\n    // \u7aef\u53e3\n    'hostport'        => '3306',\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2464 \u8bbf\u95ee\u9875\u9762\uff0c\u67e5\u770b\u4e1a\u52a1\u4f7f\u7528\u60c5\u51b5")),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"\u9ad8\u53ef\u7528\u670d\u52a1\u642d\u5efa"},"\u9ad8\u53ef\u7528\u670d\u52a1\u642d\u5efa"),(0,l.kt)("h3",{id:"1ha-\u9ad8\u53ef\u7528"},"1\u3001HA \u9ad8\u53ef\u7528"),(0,l.kt)("p",null,"\u200b \u9ad8\u53ef\u7528 HA\uff08High Availability\uff09\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u67b6\u6784\u8bbe\u8ba1\u4e2d\u5fc5\u987b\u8003\u8651\u7684\u56e0\u7d20\u4e4b\u4e00\uff0c\u5b83\u901a\u5e38\u662f\u6307\u901a\u8fc7\u8bbe\u8ba1\uff0c\u51cf\u5c11\u7cfb\u7edf\u670d\u52a1\u4e0d\u53ef\u7528\u7684\u65f6\u95f4\u3002\u5047\u8bbe\u7cfb\u7edf\u4e00\u76f4\u80fd\u591f\u63d0\u4f9b\u670d\u52a1\uff0c\u6211\u4eec\u8bf4\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u662f 100%\u3002\u5982\u679c\u7cfb\u7edf\u6bcf\u8fd0\u884c 100 \u4e2a\u65f6\u95f4\u5355\u4f4d\uff0c\u4f1a\u6709 1 \u4e2a\u65f6\u95f4\u5355\u4f4d\u65e0\u6cd5\u63d0\u4f9b\u670d\u52a1\uff0c\u6211\u4eec\u8bf4\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u662f 99%\u3002==\u5f88\u591a\u516c\u53f8\u7684\u9ad8\u53ef\u7528\u76ee\u6807\u662f 4 \u4e2a 9\uff0c\u4e5f\u5c31\u662f 99.99%\uff0c\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u7cfb\u7edf\u7684\u5e74\u505c\u673a\u65f6\u95f4\u4e3a 0.876 \u4e2a\u5c0f\u65f6==\u3002"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u63cf\u8ff0")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u901a\u4fd7\u53eb\u6cd5")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u53ef\u7528\u6027\u7ea7\u522b")),(0,l.kt)("th",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"th"},"\u5e74\u5ea6\u505c\u673a\u65f6\u95f4")))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u57fa\u672c\u53ef\u7528\u6027"),(0,l.kt)("td",{parentName:"tr",align:null},"2 \u4e2a 9"),(0,l.kt)("td",{parentName:"tr",align:null},"99%"),(0,l.kt)("td",{parentName:"tr",align:null},"87.6 \u5c0f\u65f6")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u8f83\u9ad8\u53ef\u7528\u6027"),(0,l.kt)("td",{parentName:"tr",align:null},"3 \u4e2a 9"),(0,l.kt)("td",{parentName:"tr",align:null},"99.9%"),(0,l.kt)("td",{parentName:"tr",align:null},"8.8 \u5c0f\u65f6")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"\u5177\u6709\u6545\u969c\u81ea\u52a8\u6062\u590d\u80fd\u529b\u7684\u53ef\u7528\u6027")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"4 \u4e2a 9")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"99.99%")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("strong",{parentName:"td"},"53 \u5206\u949f"))),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"\u6781\u9ad8\u53ef\u7528\u6027"),(0,l.kt)("td",{parentName:"tr",align:null},"5 \u4e2a 9"),(0,l.kt)("td",{parentName:"tr",align:null},"99.999%"),(0,l.kt)("td",{parentName:"tr",align:null},"5 \u5206\u949f")))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684\u6838\u5fc3\u70b9\uff1a")),(0,l.kt)("p",{parentName:"blockquote"},"\u2460 \u5197\u4f59\uff08\u591a\u53f0\u670d\u52a1\u5668\uff09"),(0,l.kt)("p",{parentName:"blockquote"},"\u2461 \u81ea\u52a8\u5207\u6362")),(0,l.kt)("p",null,"\u5907\u4efd\u670d\u52a1\u5668\uff1a"),(0,l.kt)("p",null,"\u51b7\u5907 \u670d\u52a1\u5668\u4e0d\u542f\u7528\uff08\u57df\u540d\u4e0d\u89e3\u6790\uff09\uff0c\u4f7f\u7528\u7684\u65f6\u5019\u518d\u5f00\u542f\uff0c\u9700\u8981\u624b\u52a8\u5207\u6362"),(0,l.kt)("p",null,"\u70ed\u5907 \u670d\u52a1\u5668\u5728\u7b49\u5f85\u72b6\u6001\uff08\u76d1\u63a7\u4e3b\u670d\u52a1\u5668\u72b6\u6001\uff09\uff0c\u4e00\u65e6\u4e3b\u5b95\u673a\uff0c\u5907\u5c31\u63a5\u7ba1\uff0c\u81ea\u52a8\u5207\u6362"),(0,l.kt)("p",null,"\u5b9e\u73b0\u70ed\u5907\uff0c\u5f15\u5165 VIP \u7684\u5207\u6362"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"ha3",src:n(57414).Z})),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u901a\u8fc7 VIP \u7684\u65b9\u5f0f\uff0c\u5207\u6362\u4e3b\u5907\u670d\u52a1\u5668")),(0,l.kt)("p",null,"\u2460 \u9ed8\u8ba4 VIP \u7ed1\u5b9a\u5728\u4e3b\u670d\u52a1\u5668\uff08master\uff09"),(0,l.kt)("p",null,"\u2461master \u4e0d\u53ef\u7528\uff0c\u5c31\u5207\u6362 VIP \u5230\u5907\u4efd\u670d\u52a1\u5668\uff08backup\uff09"),(0,l.kt)("p",null,"\u2462 \u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u5230\u8fde\u7eed\u6027\u66f4\u597d\u7684\u670d\u52a1\uff0c\u901a\u8fc7 VIP \u8bbf\u95ee\u670d\u52a1\u5668"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5e38\u7528\u6765\u5355\u72ec\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684\u8f6f\u4ef6\uff1a")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"\u2460keepalived")),(0,l.kt)("p",null,"\u2461heartbeat \u8f83\u65e9 \u5c5e\u4e8e redhat HA \u5de5\u7a0b\u7684\u4e00\u90e8\u5206"),(0,l.kt)("h3",{id:"2keepalived-\u4ecb\u7ecd"},"2\u3001keepalived \u4ecb\u7ecd"),(0,l.kt)("p",null,"\u200b Keepalived \u8f6f\u4ef6\u8d77\u521d\u662f\u4e13\u4e3a LVS \u8d1f\u8f7d\u5747\u8861\u8f6f\u4ef6\u8bbe\u8ba1\u7684\uff0c\u7528\u6765\u7ba1\u7406\u5e76\u76d1\u63a7 LVS \u96c6\u7fa4\u7cfb\u7edf\u4e2d\u5404\u4e2a\u670d\u52a1\u8282\u70b9\u7684\u72b6\u6001\uff0c\u540e\u6765\u53c8\u52a0\u5165\u4e86\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u53ef\u7528\u7684 VRRP \u529f\u80fd\u3002\u56e0\u6b64\uff0cKeepalived \u9664\u4e86\u80fd\u591f\u7ba1\u7406 LVS \u8f6f\u4ef6\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f5c\u4e3a\u5176\u4ed6\u670d\u52a1\uff08\u4f8b\u5982\uff1aNginx\u3001Haproxy\u3001MySQL \u7b49\uff09\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848\u8f6f\u4ef6"),(0,l.kt)("h3",{id:"3keepalived-\u7ec4\u6210\u548c\u539f\u7406"},"3\u3001keepalived \u7ec4\u6210\u548c\u539f\u7406"),(0,l.kt)("p",null,"\u200b Keepalived \u8f6f\u4ef6\u4e3b\u8981\u662f\u901a\u8fc7 VRRP \u534f\u8bae\u5b9e\u73b0\u9ad8\u53ef\u7528\u529f\u80fd\u7684\u3002"),(0,l.kt)("p",null,"\u200b VRRP \u662f Virtual Router RedundancyProtocol(\u865a\u62df\u8def\u7531\u5668\u5197\u4f59\u534f\u8bae\uff09\u7684\u7f29\u5199\uff0cVRRP \u51fa\u73b0\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u9759\u6001\u8def\u7531\u5355\u70b9\u6545\u969c\u95ee\u9898\u7684\uff0c\u5b83\u80fd\u591f\u4fdd\u8bc1\u5f53\u4e2a\u522b\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u6574\u4e2a\u7f51\u7edc\u53ef\u4ee5\u4e0d\u95f4\u65ad\u5730\u8fd0\u884c\u3002"),(0,l.kt)("p",null,"\u200b \u865a\u62df\u8def\u7531\u5197\u4f59\u534f\u8bae\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5b9e\u73b0\u8def\u7531\u5668\u9ad8\u53ef\u7528\u7684\u534f\u8bae\uff0c\u5373\u5c06 N \u53f0\u63d0\u4f9b\u76f8\u540c\u529f\u80fd\u7684\u8def\u7531\u5668\u7ec4\u6210\u4e00\u4e2a\u8def\u7531\u5668\u7ec4\uff0c\u8fd9\u4e2a\u7ec4\u91cc\u9762\u6709\u4e00\u4e2a master \u548c\u591a\u4e2a backup\uff0cmaster \u4e0a\u9762\u6709\u4e00\u4e2a\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684 vip\uff08\u8be5\u8def\u7531\u5668\u6240\u5728\u5c40\u57df\u7f51\u5185\u5176\u4ed6\u673a\u5668\u7684\u9ed8\u8ba4\u8def\u7531\u4e3a\u8be5 vip\uff09\uff0cmaster \u4f1a\u53d1\u7ec4\u64ad\uff0c\u5f53 backup \u6536\u4e0d\u5230 vrrp \u5305\u65f6\u5c31\u8ba4\u4e3a master \u5b95\u6389\u4e86\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u6839\u636e VRRP \u7684\u4f18\u5148\u7ea7\u6765\u9009\u4e3e\u4e00\u4e2a backup \u5f53 master\u3002\u8fd9\u6837\u7684\u8bdd\u5c31\u53ef\u4ee5\u4fdd\u8bc1\u8def\u7531\u5668\u7684\u9ad8\u53ef\u7528\u4e86\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"ha4",src:n(63573).Z}),"\n",(0,l.kt)("img",{alt:"ha5",src:n(61759).Z})),(0,l.kt)("p",null,"Keepalived \u7684\u529f\u80fd\u4f53\u7cfb\u7ed3\u6784\uff0c\u5927\u81f4\u5206\u4e24\u5c42\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u7528\u6237\u7a7a\u95f4\uff08user space\uff09\u548c\u5185\u6838\u7a7a\u95f4\uff08kernel space\uff09"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5185\u6838\u7a7a\u95f4\uff1a")),(0,l.kt)("p",null,"\u4e3b\u8981\u5305\u62ec IPVS\uff08IP \u865a\u62df\u670d\u52a1\u5668\uff0c\u7528\u4e8e\u5b9e\u73b0\u7f51\u7edc\u670d\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\uff09\u548c NETLINK\uff08\u63d0\u4f9b\u9ad8\u7ea7\u8def\u7531\u53ca\u5176\u4ed6\u76f8\u5173\u7684\u7f51\u7edc\u529f\u80fd\uff09\u4e24\u4e2a\u90e8\u4efd\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u7528\u6237\u7a7a\u95f4\uff1a")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"WatchDog\uff1a\u8d1f\u8f7d\u76d1\u63a7 checkers \u548c VRRP \u8fdb\u7a0b\u7684\u72b6\u51b5"),(0,l.kt)("p",{parentName:"blockquote"},"VRRP Stack\uff1a\u8d1f\u8f7d\u5747\u8861\u5668\u4e4b\u95f4\u7684\u5931\u8d25\u5207\u6362 FailOver\uff0c\u5982\u679c\u53ea\u7528\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5219 VRRP \u4e0d\u662f\u5fc5\u987b\u7684\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"Checkers\uff1a\u8d1f\u8d23\u771f\u5b9e\u670d\u52a1\u5668\u7684\u5065\u5eb7\u68c0\u67e5 healthchecking\uff0c\u662f keepalived \u6700\u4e3b\u8981\u7684\u529f\u80fd\u3002\u6362\u8a00\u4e4b\uff0c\u53ef\u4ee5\u6ca1\u6709 VRRP Stack\uff0c\u4f46\u5065\u5eb7\u68c0\u67e5 healthchecking \u662f\u4e00\u5b9a\u8981\u6709\u7684\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"IPVS wrapper\uff1a\u7528\u6237\u53d1\u9001\u8bbe\u5b9a\u7684\u89c4\u5219\u5230\u5185\u6838 ipvs \u4ee3\u7801"),(0,l.kt)("p",{parentName:"blockquote"},"Netlink Reflector\uff1a\u7528\u6765\u8bbe\u5b9a vrrp \u7684 vip \u5730\u5740\u7b49\u3002")),(0,l.kt)("p",null,"keepalived \u4e3b\u8981\u4f7f\u7528\u4e09\u4e2a\u6a21\u5757\uff0c\u5206\u522b\u662f core\u3001check \u548c vrrp\u3002"),(0,l.kt)("p",null,"core \u6a21\u5757\u4e3a keepalived \u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u4e3b\u8fdb\u7a0b\u7684\u542f\u52a8\u3001\u7ef4\u62a4\u4ee5\u53ca\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684\u52a0\u8f7d\u548c\u89e3\u6790\u3002"),(0,l.kt)("p",null,"check \u8d1f\u8d23\u5065\u5eb7\u68c0\u67e5\uff0c\u5305\u62ec\u5e38\u89c1\u7684\u5404\u79cd\u68c0\u67e5\u65b9\u5f0f\u3002"),(0,l.kt)("p",null,"vrrp \u6a21\u5757\u662f\u6765\u5b9e\u73b0 VRRP \u534f\u8bae\u7684\u3002"),(0,l.kt)("h3",{id:"4\u5b89\u88c5\u914d\u7f6e\u542f\u52a8-keepalived"},"4\u3001\u5b89\u88c5\u914d\u7f6e\u542f\u52a8 keepalived"),(0,l.kt)("p",null,"master \u548c backup \u90fd\u9700\u8981\u8fdb\u884c\u5b89\u88c5\uff0c\u4e5f\u5c31\u662f server01 \u548c server03 \u673a\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5b89\u88c5keepalived\nshell > yum -y install keepalived\n")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u4e3b\u673a\u540d\u79f0"),(0,l.kt)("th",{parentName:"tr",align:null},"\u670d\u52a1\u5668 IP"),(0,l.kt)("th",{parentName:"tr",align:null}))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"server01"),(0,l.kt)("td",{parentName:"tr",align:null},"192.168.17.102"),(0,l.kt)("td",{parentName:"tr",align:null},"master")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"server03"),(0,l.kt)("td",{parentName:"tr",align:null},"192.168.17.101"),(0,l.kt)("td",{parentName:"tr",align:null},"backup")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"keepalived \u9700\u8981\u4f7f\u7528\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff1a")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"\u6587\u4ef6\u6216\u8005\u76ee\u5f55"),(0,l.kt)("th",{parentName:"tr",align:null},"\u4f5c\u7528"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"/etc/keepalived/keepalived.conf"),(0,l.kt)("td",{parentName:"tr",align:null},"\u751f\u6548\u7684\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"/etc/init.d/keepalived"),(0,l.kt)("td",{parentName:"tr",align:null},"\u670d\u52a1\u5668\u7ba1\u7406\u811a\u672c")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"/var/log/messages"),(0,l.kt)("td",{parentName:"tr",align:null},"\u65e5\u5fd7\u4fe1\u606f")))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u914d\u7f6e keepalived")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460 \u5907\u4efd\u4e3b\u5907\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"shell > cd  /etc/keepalived\nshell > cp keepalived.conf keepalived.conf_bak\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461 \u5206\u522b\u4fee\u6539\u4e3b\u5907\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"shell > vim keepalived.conf\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"! Configuration File for keepalived\n#\u53d1\u9001\u90ae\u4ef6\u7684\u914d\u7f6e\nglobal_defs {\n   notification_email {\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server 192.168.200.1\n   smtp_connect_timeout 30\n   router_id LVS_DEVEL\n}\n#vrrp\u534f\u8bae\u7684\u914d\u7f6e\nvrrp_instance VI_1 {\n    #\u5de5\u4f5c\u6a21\u5f0f\n    state MASTER\n    #\u76d1\u542c\u7684\u7f51\u5361\n    interface eth0\n    #\u865a\u62df\u8def\u7531id \u9700\u8981\u548c\u5907\u670d\u52a1\u5668\u4e00\u81f4\n    virtual_router_id 51\n    #\u6743\u91cd \u4f18\u5148\u7ea7\n    priority 100\n    #vrrp\u5305\u7684\u53d1\u9001\u5468\u671f  1s\n    advert_int 1\n    #\u6743\u9650\u9a8c\u8bc1\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    #\u9700\u8981\u7ed1\u5b9a\u5207\u6362\u7684VIP\n    virtual_ipaddress {\n        192.168.200.16\n        192.168.200.17\n        192.168.200.18\n    }\n}\n")),(0,l.kt)("p",null,"\u4e3b\u670d\u52a1\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"! Configuration File for keepalived\nglobal_defs {\n   notification_email {\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server 192.168.200.1\n   smtp_connect_timeout 30\n   router_id LVS_DEVEL\n}\nvrrp_instance VI_1 {\n    state MASTER\n    interface eth0\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    #master\u9ed8\u8ba4\u53ea\u9700\u8981\u4fee\u6539\u4f7f\u7528VIP\u5373\u53ef\n    virtual_ipaddress {\n        192.168.17.200\n    }\n}\n")),(0,l.kt)("p",null,"\u5907\u670d\u52a1\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"! Configuration File for keepalived\nglobal_defs {\n   notification_email {\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   }\n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server 192.168.200.1\n   smtp_connect_timeout 30\n   router_id LVS_DEVEL\n}\nvrrp_instance VI_1 {\n    #\u4fee\u6539\u5de5\u4f5c\u6a21\u5f0f\u4e3a\u5907\n    state BACKUP\n    interface eth0\n    virtual_router_id 51\n    priority 100\n    advert_int 1\n    authentication {\n        auth_type PASS\n        auth_pass 1111\n    }\n    #\u6ce8\u610f\u4fee\u6539VIP\n    virtual_ipaddress {\n        192.168.17.200\n    }\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2462 \u5206\u522b\u6309\u7167\u987a\u5e8f\u542f\u52a8\u4e3b\u670d\u52a1\u5668\u548c\u5907\u670d\u52a1\u5668\u7684 keepalived")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"shell > service keepalived start\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2463 \u67e5\u770b\u4e3b\u5907\u670d\u52a1\u5668\u7684\u7f51\u5361\u4fe1\u606f")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u9700\u8981\u901a\u8fc7ip a\u547d\u4ee4\u67e5\u770b  \u5206\u522b\u5728server01\u548cserver03\u67e5\u770b\nshell > ip a\n")),(0,l.kt)("p",null,"##5\u3001\u6a21\u62df\u670d\u52a1\u5668\u4e0d\u53ef\u7528 VIP \u5207\u6362"),(0,l.kt)("p",null,"\u670d\u52a1\u5668\u6574\u673a\u4e0d\u53ef\u7528\uff0c\u5e38\u89c1\u4e8e\u670d\u52a1\u5668\u65ad\u7f51\uff0c\u6216\u8005\u65ad\u7535\u5173\u673a\u7b49\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u65b9\u6cd5\u4e00\uff1a\u6a21\u62df\u4e3b\u670d\u52a1\u5668\u65ad\u7535\u5173\u95ed")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5173\u95ed\u4e3b\u670d\u52a1\u5668  VIP\u6240\u5728\u670d\u52a1\u5668\nshell > poweroff\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u65b9\u6cd5\u4e8c\uff1a\u6a21\u62df\u4e3b\u670d\u52a1\u5668\u65ad\u7f51")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5173\u95edVIP\u6240\u5728\u670d\u52a1\u5668\u7684\u7f51\u5361  \u4f7f\u5176\u4e0d\u80fd\u591f\u8054\u7f51\nshell > service network stop\n")),(0,l.kt)("p",null,"\u901a\u8fc7\u4ee5\u4e0a\u5b9e\u9a8c\u68c0\u6d4b\uff0c\u53d1\u73b0\u5f53\u4e3b\u670d\u52a1\u5668\u6574\u673a\u4e0d\u53ef\u7528\u65f6\uff0cVIP \u4f1a\u5207\u6362\u5230\u5907\u7528\u670d\u52a1\u5668"),(0,l.kt)("h2",{id:"\u5b9e\u73b0\u670d\u52a1-ha"},"\u5b9e\u73b0\u670d\u52a1 HA"),(0,l.kt)("p",null,"\u200b \u901a\u8fc7 keepalived \u53ef\u4ee5\u76f4\u63a5\u5b9e\u73b0\u4e3b\u670d\u52a1\u5668\u6574\u673a\u4e0d\u53ef\u7528\uff0c\u5b9e\u73b0 VIP \u7684\u5207\u6362\u3002\u4fdd\u8bc1\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 VIP \u8fdb\u884c\u8bbf\u95ee\u670d\u52a1\u3002"),(0,l.kt)("p",null,"\u4f46\u662f\u5b9e\u9645\u60c5\u51b5\u4e0b\uff0c\u5f80\u5f80\u5e76\u4e0d\u662f\u670d\u52a1\u5668\u6574\u673a\u4e0d\u53ef\u7528\uff0c\u53ea\u662f\u5bf9\u5e94\u7684\u670d\u52a1\u6216\u8005\u8f6f\u4ef6\u4e0d\u53ef\u7528\u3002"),(0,l.kt)("p",null,"\u6bd4\u5982\u8bf4\uff1anginx \u63d0\u4f9b\u7684 web \u670d\u52a1\uff0cnginx \u8fdb\u7a0b\u5173\u95ed"),(0,l.kt)("p",null,"\u5c31\u9700\u8981\u68c0\u6d4b\u5f53 nginx \u4e0d\u53ef\u7528\u65f6\uff0c\u5c31\u5207\u6362 VIP"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5b9e\u73b0\u8fc7\u7a0b\u5206\u6790\uff1a")),(0,l.kt)("p",null,"VIP \u5b9e\u9645\u662f\u7531 keepalived \u8fdb\u884c\u7ed1\u5b9a\u7684\uff0c\u6240\u4ee5\u5f53 nginx \u670d\u52a1\u4e0d\u53ef\u7528\u65f6\uff0c\u5c31\u5173\u95ed\u5f53\u524d\u673a\u5668\u7684 keepalived \u5373\u53ef\uff0c\u91ca\u653e VIP\u3002\u8fdb\u800c\u7ed1\u5b9a\u5230\u5176\u4ed6\u5907\u7528\u670d\u52a1\u5668\u3002"),(0,l.kt)("p",null,"\u2460 \u7f16\u5199\u670d\u52a1\u68c0\u6d4b\u811a\u672c\uff0c\u5b9e\u73b0\u68c0\u6d4b nginx \u662f\u5426\u53ef\u7528\uff0c\u4e0d\u53ef\u7528\u5219\u5173\u95ed\u5f53\u524d\u6240\u5728\u4e3b\u673a\u7684 keepalived"),(0,l.kt)("p",null,"\u2461 \u5728 keepalived \u914d\u7f6e\u4e2d\u8c03\u7528\u68c0\u6d4b\u670d\u52a1\u811a\u672c"),(0,l.kt)("h3",{id:"1nginx-\u670d\u52a1\u53ef\u7528\u68c0\u6d4b\u811a\u672c"},"1\u3001Nginx \u670d\u52a1\u53ef\u7528\u68c0\u6d4b\u811a\u672c"),(0,l.kt)("p",null,"\u4e3b\u5907\u670d\u52a1\u5668\u90fd\u8981\u5b9e\u73b0\u6b64\u811a\u672c"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460 \u7f16\u5199\u6d4b\u8bd5\u811a\u672c \u8d4b\u4e88\u6267\u884c\u6743\u9650")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"shell > cd /etc/keepalived\nshell > vim check_nginx.sh\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u811a\u672c\u5185\u5bb9\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#!/bin/bash\nnginx_status=`ps -C nginx --no-header | wc -l`\nif [ $nginx_status -eq 0 ];then\n   service keepalived stop\nfi\n")),(0,l.kt)("p",null,"\u8d4b\u4e88\u811a\u672c\u6267\u884c\u6743\u9650 \u65b9\u4fbf\u4e4b\u540e\u5176\u4ed6\u8f6f\u4ef6\u8c03\u7528\u6267\u884c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"shell > chmod +x check_nginx.sh\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461 \u6d4b\u8bd5\u811a\u672c\u53ef\u7528\u6027")),(0,l.kt)("p",null,"\u542f\u52a8 nginx \u548c keepalived"),(0,l.kt)("p",null,"\u5173\u95ed nginx \u6267\u884c\u811a\u672c \u67e5\u770b keepalived \u662f\u5426\u4e5f\u5173\u95ed"),(0,l.kt)("h3",{id:"2\u6a21\u62df\u5b95\u673a\u5b9e\u73b0\u670d\u52a1\u5207\u6362"},"2\u3001\u6a21\u62df\u5b95\u673a\u5b9e\u73b0\u670d\u52a1\u5207\u6362"),(0,l.kt)("p",null,"\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e2d\u914d\u7f6e keepalived \u5b9a\u65f6\u89e6\u53d1\u68c0\u6d4b nginx \u7684\u811a\u672c\u6a21\u5757"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5728vrrp_instance\u5916\u4e0a\u9762\u5b9a\u4e49\nvrrp_script check_nginx {\n   #\u8c03\u7528\u811a\u672c\u5730\u5740\n   script  /etc/keepalived/check_nginx.sh\n   #\u68c0\u6d4b\u95f4\u9694\u65f6\u95f4\n   interval 3\n}\n#\u5728vrrp_instance\u91cc\u8c03\u7528\ntrack_script {\n    #\u4e0a\u7ebf\u5b9a\u4e49\u7684\u540d\u79f0\n    check_nginx\n}\n")),(0,l.kt)("p",null,"##3\u3001\u5b9e\u73b0 web \u670d\u52a1\u5668\u9ad8\u53ef\u7528"),(0,l.kt)("p",null,"\u4ee5\u4e0a\u6848\u4f8b\u5df2\u7ecf\u5b9e\u73b0\u4e86\uff0c\u670d\u52a1\u4e0d\u53ef\u7528 VIP \u5207\u6362\u5230\u53ef\u7528\u670d\u52a1\u5668\u3002"),(0,l.kt)("p",null,"\u73b0\u5728\u9700\u6c42\u7528\u6237\u7684\u670d\u52a1\u662f\u8fde\u7eed\u4e0d\u95f4\u65ad\u7684\uff0c\u6545",(0,l.kt)("strong",{parentName:"p"},"\u7528\u6237\u9700\u8981\u901a\u8fc7 VIP \u8fdb\u884c\u8bbf\u95ee")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460 \u89e3\u6790\u57df\u540d\u5230 VIP")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461 \u6a21\u62df\u7528\u6237\u8bbf\u95ee")),(0,l.kt)("h2",{id:"keepalived-\u7684\u914d\u7f6e\u8865\u5145"},"keepalived \u7684\u914d\u7f6e\u8865\u5145"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8111\u88c2\uff08\u88c2\u8111\uff09\uff1avip \u51fa\u73b0\u5728\u4e86\u591a\u53f0\u673a\u5668\u4e0a\u3002\u7f51\u7edc\u4e0d\u901a\u7545\uff0c\u7981\u7528\u4e86\u6570\u636e\u5305\uff0c\u4e3b\u5907\u670d\u52a1\u5668\u6ca1\u6cd5\u901a\u8baf\uff0c\u9020\u6210\u5907\u670d\u52a1\u5668\u8ba4\u4e3a\u4e3b\u670d\u52a1\u5668\u4e0d\u53ef\u7528\uff0c\u7ed1\u5b9a VIP\uff0c\u4e3b\u670d\u52a1\u5668 VIP \u4e0d\u4f1a\u91ca\u653e\u3002"),(0,l.kt)("p",{parentName:"blockquote"},"\u89e3\u51b3\u65b9\u6848\uff1a"),(0,l.kt)("p",{parentName:"blockquote"},"\u2460 \u53cc\u5907\u6216\u8005\u591a\u5907\u6a21\u5f0f BACKUP \u901a\u8fc7 priority \u6743\u91cd\u6765\u533a\u5206\u8c01\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8"),(0,l.kt)("p",{parentName:"blockquote"},"\u2461 \u5355\u64ad(\u5b9a\u5411\u5e7f\u64ad)\u7684\u65b9\u5f0f (\u4e00\u4e9b\u7279\u5b9a\u73af\u5883\u7981\u7528\u4e86\u7ec4\u64ad\u65b9\u5f0f)"),(0,l.kt)("p",{parentName:"blockquote"},"\u2462 \u65f6\u95f4\u4e0d\u540c\u6b65 \u670d\u52a1\u5668\u65f6\u95f4\u6821\u65f6")),(0,l.kt)("h3",{id:"1\u975e\u62a2\u5360\u6a21\u5f0f"},"1\u3001\u975e\u62a2\u5360\u6a21\u5f0f"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2460nopreempt")),(0,l.kt)("p",null,"\u5728\u4e3b\u5907\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\uff0cvrrp_instance \u6bb5\u4e2d"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u2461 \u8bbe\u7f6e state \u5de5\u4f5c\u6a21\u5f0f\u4e3a BACKUP"),"\n\u4e24\u4e2a keepalived \u8282\u70b9\u90fd\u542f\u52a8\u540e\uff0c\u9ed8\u8ba4\u90fd\u662f BACKUP \u72b6\u6001\uff0c\u53cc\u65b9\u5728\u53d1\u9001\u7ec4\u64ad\u4fe1\u606f\u540e\uff0c\u4f1a\u6839\u636e\u4f18\u5148\u7ea7\u6765\u9009\u4e3e\u4e00\u4e2a MASTER \u51fa\u6765\u3002\u7531\u4e8e\u4e24\u8005\u90fd\u914d\u7f6e\u4e86 nopreempt\uff0c\u6240\u4ee5 MASTER \u4ece\u6545\u969c\u4e2d\u6062\u590d\u540e\uff0c\u4e0d\u4f1a\u62a2\u5360 vip\u3002\u8fd9\u6837\u4f1a\u907f\u514d VIP \u5207\u6362\u53ef\u80fd\u9020\u6210\u7684\u670d\u52a1\u5ef6\u8fdf\u3002"),(0,l.kt)("h3",{id:"2\u5355\u64ad\u6a21\u5f0f"},"2\u3001\u5355\u64ad\u6a21\u5f0f"),(0,l.kt)("p",null,"\u4e00\u4e9b\u7279\u5b9a\u73af\u5883\u4e0b\u4e0d\u5141\u8bb8\u53d1\u9001\u7ec4\u64ad\uff0c\u9020\u6210\u5907\u670d\u52a1\u5668\u65e0\u6cd5\u6536\u5230 vrrp \u5305\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u8111\u88c2\u73b0\u8c61\u3002\u53ef\u4ee5\u901a\u8fc7\u5355\u64ad\u7684\u65b9\u5f0f\u89e3\u51b3\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5355\u64ad\u793a\u4f8b\u914d\u7f6e\uff1a"),"\u6ce8\u610f\u6b64\u8bed\u6cd5\u5728 keepalived1.2.11 \u7248\u672c\u4ee5\u4e0a\u652f\u6301"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"unicast_src_ip 192.168.1.21##\uff08\u672c\u5730 IP \u5730\u5740\uff09"),(0,l.kt)("p",{parentName:"blockquote"},"unicast_peer {"),(0,l.kt)("p",{parentName:"blockquote"},"\u200b 192.168.1.22##\uff08\u5bf9\u7aef IP \u5730\u5740\uff09\u6b64\u5730\u5740\u4e00\u5b9a\u4e0d\u80fd\u5fd8\u8bb0"),(0,l.kt)("p",{parentName:"blockquote"},"}")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4e3b\u670d\u52a1\u5668 server01 \u914d\u7f6e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5728vrrp_instace\u6bb5\u4e2d\u52a0\u5165\n#\u672c\u5730IP\nunicast_src_ip 192.168.17.102\nunicast_peer {\n    #\u5bf9\u8c61IP  \u53d1\u9001vrrp\u5305\u7ed9\u5907\u670d\u52a1\u5668\n    192.168.17.101\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5907\u670d\u52a1\u5668 server03 \u914d\u7f6e")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"#\u5728vrrp_instace\u6bb5\u4e2d\u52a0\u5165\n#\u672c\u5730IP\nunicast_src_ip 192.168.17.101\nunicast_peer {\n    #\u5bf9\u8c61IP  \u53d1\u9001vrrp\u5305\u7ed9\u5907\u670d\u52a1\u5668\n    192.168.17.102\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"tcpdump \u6293 vrrp \u5305\u7684\u65b9\u5f0f\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"shell > tcpdump vrrp -n\n")))}o.isMDXComponent=!0},59614:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ha1-36de72211be3bd7550a8e88e7a1bb579.jpg"},26886:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ha2-45fd75f790d30e5525bca70cb0bc5f25.jpg"},57414:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ha3-57bd73db814df29a787a75d8a18f7dd8.jpg"},63573:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ha4-7e7eafd5810a2a3f371d42faf203c9f5.jpg"},61759:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ha5-61bf24b1c2c206f5af56accb9f2f76fb.JPG"}}]);