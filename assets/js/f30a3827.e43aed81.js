"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1899],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>u});var l=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,l,r=function(e,t){if(null==e)return{};var n,l,r={},a=Object.keys(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=l.createContext({}),d=function(e){var t=l.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=d(e.components);return l.createElement(c.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},p=l.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=d(n),u=r,m=p["".concat(c,".").concat(u)]||p[u]||k[u]||a;return n?l.createElement(m,o(o({ref:t},s),{},{components:n})):l.createElement(m,o({ref:t},s))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var d=2;d<a;d++)o[d]=n[d];return l.createElement.apply(null,o)}return l.createElement.apply(null,n)}p.displayName="MDXCreateElement"},57860:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>s,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var l=n(87462),r=(n(67294),n(3905));const a={title:"[DevOps] \u5bb9\u5668\u6280\u672f\u7ba1\u7406\u5de5\u5177-Docker(\u4e2d)",sidebar_position:6},o=void 0,i={unversionedId:"DevOps/docker2",id:"DevOps/docker2",title:"[DevOps] \u5bb9\u5668\u6280\u672f\u7ba1\u7406\u5de5\u5177-Docker(\u4e2d)",description:"docker \u955c\u50cf",source:"@site/docs/DevOps/docker2.md",sourceDirName:"DevOps",slug:"/DevOps/docker2",permalink:"/docs/DevOps/docker2",editUrl:"https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/DevOps/docker2.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"[DevOps] \u5bb9\u5668\u6280\u672f\u7ba1\u7406\u5de5\u5177-Docker(\u4e2d)",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"[DevOps] \u5bb9\u5668\u6280\u672f\u7ba1\u7406\u5de5\u5177-Docker(\u4e0a)",permalink:"/docs/DevOps/docker1"},next:{title:"[DevOps] \u5bb9\u5668\u6280\u672f\u7ba1\u7406\u5de5\u5177-Docker(\u4e0b)",permalink:"/docs/DevOps/docker3"}},c=[{value:"docker \u955c\u50cf",id:"docker-\u955c\u50cf",children:[{value:"\u5bb9\u5668\u4e0e\u955c\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb",id:"\u5bb9\u5668\u4e0e\u955c\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb",children:[],level:3},{value:"\u5bb9\u5668\u955c\u50cf\u4ecb\u7ecd",id:"\u5bb9\u5668\u955c\u50cf\u4ecb\u7ecd",children:[],level:3}],level:2},{value:"\u5236\u4f5c\u57fa\u7840\u955c\u50cf",id:"\u5236\u4f5c\u57fa\u7840\u955c\u50cf",children:[{value:"1. \u5b89\u88c5\u4e00\u4e2a\u6700\u5c0f\u5316\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u673a",id:"1-\u5b89\u88c5\u4e00\u4e2a\u6700\u5c0f\u5316\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u673a",children:[],level:3},{value:"2. \u6253\u5305\u64cd\u4f5c\u7cfb\u7edf\u7684\u6839\u76ee\u5f55",id:"2-\u6253\u5305\u64cd\u4f5c\u7cfb\u7edf\u7684\u6839\u76ee\u5f55",children:[],level:3},{value:"3. \u628a\u83b7\u53d6\u7684\u6839\u6253\u5305\u6587\u4ef6\u5bfc\u5165\u5230 Docker host \u4e3b\u673a\u4e2d",id:"3-\u628a\u83b7\u53d6\u7684\u6839\u6253\u5305\u6587\u4ef6\u5bfc\u5165\u5230-docker-host-\u4e3b\u673a\u4e2d",children:[],level:3},{value:"4. \u4f7f\u7528\u57fa\u7840\u955c\u50cf\u542f\u52a8\u5bb9\u5668",id:"4-\u4f7f\u7528\u57fa\u7840\u955c\u50cf\u542f\u52a8\u5bb9\u5668",children:[],level:3}],level:2},{value:"\u5236\u4f5c\u5e94\u7528\u955c\u50cf",id:"\u5236\u4f5c\u5e94\u7528\u955c\u50cf",children:[{value:"\u4f7f\u7528 commit \u63d0\u4ea4\u955c\u50cf",id:"\u4f7f\u7528-commit-\u63d0\u4ea4\u955c\u50cf",children:[],level:3}],level:2},{value:"\u4f7f\u7528 docker build \u521b\u5efa\u6307\u5b9a\u5e94\u7528\u5bb9\u5668\u955c\u50cf",id:"\u4f7f\u7528-docker-build-\u521b\u5efa\u6307\u5b9a\u5e94\u7528\u5bb9\u5668\u955c\u50cf",children:[{value:"1. \u4f7f\u7528 docker build \u547d\u4ee4",id:"1-\u4f7f\u7528-docker-build-\u547d\u4ee4",children:[],level:3},{value:"2. \u57fa\u4e8e Dockerfile",id:"2-\u57fa\u4e8e-dockerfile",children:[],level:3},{value:"3. Dockfile \u539f\u7406",id:"3-dockfile-\u539f\u7406",children:[],level:3},{value:"4. Dockerfile \u5173\u952e\u5b57",id:"4-dockerfile-\u5173\u952e\u5b57",children:[{value:"<strong>FROM\uff08\u6307\u5b9a\u57fa\u7840 image\uff09</strong>",id:"from\u6307\u5b9a\u57fa\u7840-image",children:[],level:4},{value:"<strong>MAINTAINER\uff08\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f\uff09</strong>",id:"maintainer\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f",children:[],level:4},{value:"<strong>RUN (\u8fd0\u884c\u547d\u4ee4)</strong>",id:"run-\u8fd0\u884c\u547d\u4ee4",children:[],level:4},{value:"<strong>CMD\uff08\u8bbe\u7f6e container \u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09</strong>",id:"cmd\u8bbe\u7f6e-container-\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c",children:[],level:4},{value:"ENTRYPOINT\uff08\u8bbe\u7f6e container \u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09",id:"entrypoint\u8bbe\u7f6e-container-\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c",children:[],level:4},{value:"USER\uff08\u8bbe\u7f6e container \u5bb9\u5668\u7684\u7528\u6237\uff09",id:"user\u8bbe\u7f6e-container-\u5bb9\u5668\u7684\u7528\u6237",children:[],level:4},{value:"<strong>EXPOSE\uff08\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3\uff09</strong>",id:"expose\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3",children:[],level:4},{value:"ENV\uff08\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff09",id:"env\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf",children:[],level:4},{value:"<strong>ADD\uff08\u4ece src \u590d\u5236\u6587\u4ef6\u5230 container \u7684 dest \u8def\u5f84\uff09</strong>",id:"add\u4ece-src-\u590d\u5236\u6587\u4ef6\u5230-container-\u7684-dest-\u8def\u5f84",children:[],level:4},{value:"VOLUME\uff08\u6307\u5b9a\u6302\u8f7d\u70b9\uff09",id:"volume\u6307\u5b9a\u6302\u8f7d\u70b9",children:[],level:4},{value:"<strong>WORKDIR\uff08\u5207\u6362\u76ee\u5f55\uff09</strong>",id:"workdir\u5207\u6362\u76ee\u5f55",children:[],level:4}],level:3}],level:2},{value:"Dockerfile \u5e94\u7528\u6848\u4f8b\u4e00",id:"dockerfile-\u5e94\u7528\u6848\u4f8b\u4e00",children:[{value:"<code>\u8fc7\u7a0b</code>\uff1a",id:"\u8fc7\u7a0b",children:[],level:3}],level:2},{value:"\u66ff\u4ee3\u539f\u7f51\u7ad9\u5185\u5bb9\u6848\u4f8b",id:"\u66ff\u4ee3\u539f\u7f51\u7ad9\u5185\u5bb9\u6848\u4f8b",children:[],level:2},{value:"\u628a nginx \u5e94\u7528\u5bb9\u5668\u5316\u6848\u4f8b",id:"\u628a-nginx-\u5e94\u7528\u5bb9\u5668\u5316\u6848\u4f8b",children:[],level:2},{value:"\u5bb9\u5668\u955c\u50cf\u5728 docker host \u5b58\u50a8\u4f4d\u7f6e",id:"\u5bb9\u5668\u955c\u50cf\u5728-docker-host-\u5b58\u50a8\u4f4d\u7f6e",children:[{value:"Overlay \u53ca Overlay2 \u539f\u7406",id:"overlay-\u53ca-overlay2-\u539f\u7406",children:[],level:3},{value:"\u67e5\u770b docker \u9ed8\u8ba4\u4f7f\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u65b9\u6cd5",id:"\u67e5\u770b-docker-\u9ed8\u8ba4\u4f7f\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u65b9\u6cd5",children:[],level:3},{value:"docker \u8fd0\u884c\u524d",id:"docker-\u8fd0\u884c\u524d",children:[],level:3}],level:2}],d={toc:c};function s(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,l.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"docker-\u955c\u50cf"},"docker \u955c\u50cf"),(0,r.kt)("h3",{id:"\u5bb9\u5668\u4e0e\u955c\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb"},"\u5bb9\u5668\u4e0e\u955c\u50cf\u4e4b\u95f4\u7684\u5173\u7cfb"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"docker client \u5411 docker daemon \u53d1\u8d77\u521b\u5efa\u5bb9\u5668\u7684\u8bf7\u6c42"),(0,r.kt)("li",{parentName:"ul"},"docker daemon \u67e5\u627e\u6709\u65e0\u5ba2\u6237\u7aef\u9700\u8981\u7684\u955c\u50cf"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u65e0\uff0c\u5219\u5230\u5bb9\u5668\u7684\u955c\u50cf\u4ed3\u5e93\u4e2d\u4e0b\u8f7d\u9700\u8981\u7684\u955c\u50cf"),(0,r.kt)("li",{parentName:"ul"},"\u62ff\u5230\u5bb9\u5668\u955c\u50cf\u540e\uff0c\u542f\u52a8\u5bb9\u5668")),(0,r.kt)("h3",{id:"\u5bb9\u5668\u955c\u50cf\u4ecb\u7ecd"},"\u5bb9\u5668\u955c\u50cf\u4ecb\u7ecd"),(0,r.kt)("p",null,"Docker \u955c\u50cf\u5c31\u662f\u4e00\u7ec4\u53ea\u8bfb\u7684\u76ee\u5f55\uff0c\u6216\u8005\u53eb\u53ea\u8bfb\u7684 Docker \u5bb9\u5668\u6a21\u677f\uff0c\u955c\u50cf\u4e2d\u542b\u6709\u4e00\u4e2a Docker \u5bb9\u5668\u8fd0\u884c\u6240\u9700\u8981\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u4eec\u8bf4 Docker \u955c\u50cf\u662f\u542f\u52a8\u4e00\u4e2a Docker \u5bb9\u5668\u7684\u57fa\u7840\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5c06 Docker \u955c\u50cf\u770b\u6210\u662f Docker \u5bb9\u5668\u7684\u9759\u6001\u65f6\uff0c\u4e5f\u53ef\u5c06 Docker \u5bb9\u5668\u770b\u6210\u662f Docker \u955c\u50cf\u7684\u8fd0\u884c\u65f6\u3002"),(0,r.kt)("p",null,"\u4ece Docker \u7684\u5b98\u65b9\u6587\u6863\u6765\u770b\uff0cDocker \u5bb9\u5668\u7684\u5b9a\u4e49\u548c Docker \u955c\u50cf\u7684\u5b9a\u4e49\u51e0\u4e4e\u662f\u76f8\u540c\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"Docker \u5bb9\u5668\u548cDocker \u955c\u50cf\u7684\u533a\u522b\u4e3b\u8981\u5728\u4e8edocker \u5bb9\u5668\u591a\u51fa\u4e86\u4e00\u4e2a\u53ef\u5199\u5c42\u3002")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"wr",src:n(61644).Z})),(0,r.kt)("p",null,"\u5bb9\u5668\u4e2d\u7684\u8fdb\u7a0b\u5c31\u8fd0\u884c\u5728\u8fd9\u4e2a\u53ef\u5199\u5c42\uff0c\u8fd9\u4e2a\u53ef\u5199\u5c42\u6709\u4e24\u4e2a\u72b6\u6001\uff0c\u5373\u8fd0\u884c\u6001\u548c\u9000\u51fa\u6001\u3002\u5f53\u6211\u4eec docker run \u8fd0\u884c\u5bb9\u5668\u540e\uff0cdocker \u5bb9\u5668\u5c31\u8fdb\u5165\u4e86\u8fd0\u884c\u6001\uff0c\u5f53\u6211\u4eec\u505c\u6b62\u6b63\u5728\u8fd0\u884c\u4e2d\u7684\u5bb9\u5668\u65f6\uff0cdocker \u5bb9\u5668\u5c31\u8fdb\u5165\u4e86\u9000\u51fa\u6001\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u5c06\u5bb9\u5668\u4ece\u8fd0\u884c\u6001\u8f6c\u4e3a\u9000\u51fa\u6001\u65f6\uff0c\u671f\u95f4\u53d1\u751f\u7684\u53d8\u66f4\u90fd\u4f1a\u5199\u5165\u5230\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d(\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u5904\u4e0d\u662f\u5199\u5165\u5230\u4e86 docker \u955c\u50cf\u4e2d)\u3002"),(0,r.kt)("p",null,"\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\uff08UnionFS\uff09\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u9ad8\u6027\u80fd\u5206\u5c42\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u652f\u6301\u5c06\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4fee\u6539\u4fe1\u606f\u4f5c\u4e3a\u4e00\u6b21\u63d0\u4ea4\uff0c\u5e76\u5c42\u5c42\u53e0\u52a0\uff0c\u540c\u65f6\u53ef\u4ee5\u5c06\u4e0d\u540c\u76ee\u5f55\u6302\u8f7d\u5230\u540c\u4e00\u4e2a\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u4e0b\uff0c\u5e94\u7528\u770b\u5230\u7684\u662f\u6302\u8f7d\u7684\u6700\u7ec8\u7ed3\u679c\u3002"),(0,r.kt)("p",null,"\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\u662f\u5b9e\u73b0 Docker \u955c\u50cf\u7684\u6280\u672f\u57fa\u7840\u3002Docker \u955c\u50cf\u53ef\u4ee5\u901a\u8fc7\u5206\u5c42\u6765\u8fdb\u884c\u7ee7\u627f\u3002\u4f8b\u5982\uff0c\u7528\u6237\u57fa\u4e8e\u57fa\u7840\u955c\u50cf\uff08\u7528\u6765\u751f\u6210\u5176\u4ed6\u955c\u50cf\u7684\u57fa\u7840\uff0c\u5f80\u5f80\u6ca1\u6709\u7236\u955c\u50cf\uff09\u6765\u5236\u4f5c\u5404\u79cd\u4e0d\u540c\u7684\u5e94\u7528\u955c\u50cf\u3002\u8fd9\u4e9b\u955c\u50cf\u5171\u4eab\u540c\u4e00\u4e2a\u57fa\u7840\u955c\u50cf\u5c42\uff0c\u63d0\u9ad8\u4e86\u5b58\u50a8\u6548\u7387\u3002\u6b64\u5916\uff0c\u5f53\u7528\u6237\u6539\u53d8\u4e86\u4e00\u4e2a Docker \u955c\u50cf\uff08\u6bd4\u5982\u5347\u7ea7\u7a0b\u5e8f\u5230\u65b0\u7684\u7248\u672c\uff09\uff0c\u5219\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5c42\uff08layer\uff09\u3002\u56e0\u6b64\uff0c\u7528\u6237\u4e0d\u7528\u66ff\u6362\u6574\u4e2a\u539f\u955c\u50cf\u6216\u8005\u91cd\u65b0\u5efa\u7acb\uff0c\u53ea\u9700\u8981\u6dfb\u52a0\u65b0\u5c42\u5373\u53ef\u3002\u7528\u6237\u5206\u53d1\u955c\u50cf\u7684\u65f6\u5019\uff0c\u4e5f\u53ea\u9700\u8981\u5206\u53d1\u88ab\u6539\u52a8\u7684\u65b0\u5c42\u5185\u5bb9\uff08\u589e\u91cf\u90e8\u5206\uff09\u3002\u8fd9\u8ba9 Docker \u7684\u955c\u50cf\u7ba1\u7406\u53d8\u5f97\u5341\u5206\u8f7b\u91cf\u7ea7\u548c\u5feb\u901f\u3002"),(0,r.kt)("h2",{id:"\u5236\u4f5c\u57fa\u7840\u955c\u50cf"},"\u5236\u4f5c\u57fa\u7840\u955c\u50cf"),(0,r.kt)("h3",{id:"1-\u5b89\u88c5\u4e00\u4e2a\u6700\u5c0f\u5316\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u673a"},"1. \u5b89\u88c5\u4e00\u4e2a\u6700\u5c0f\u5316\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e3b\u673a"),(0,r.kt)("p",null,"\u865a\u62df\u673a\u7684\u955c\u50cf\u6a21\u677f\u4e2d\u4e0d\u4ec5\u4ec5\u5305\u542b\u6587\u4ef6\u7cfb\u7edf, \u8fd8\u5305\u62ec\u64cd\u4f5c\u7cfb\u7edf. \u4f46\u662f\u5bb9\u5668\u7684\u955c\u50cf\u6a21\u677f\u5f53\u4e2d\u4ec5\u4ec5\u5305\u542b\u6587\u4ef6\u7cfb\u7edf"),(0,r.kt)("h3",{id:"2-\u6253\u5305\u64cd\u4f5c\u7cfb\u7edf\u7684\u6839\u76ee\u5f55"},"2. \u6253\u5305\u64cd\u4f5c\u7cfb\u7edf\u7684\u6839\u76ee\u5f55"),(0,r.kt)("p",null,"\u4e3a\u4ec0\u4e48\u6253\u5305\u6839\u76ee\u5f55, \u56e0\u4e3a\u6839\u76ee\u5f55\u5305\u542b\u4e86\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u91cc\u9762\u7684\u5185\u5bb9"),(0,r.kt)("p",null,"\u542f\u52a8\u72b6\u6001\u7684\u4e3b\u673a\u4e00\u5b9a\u5305\u542b\u8fd9\u4e2a\u4e3b\u673a\u7684\u8fdb\u7a0b\u5bf9\u5e94\u7684\u6620\u5c04, \u56e0\u6b64\u9700\u8981\u6392\u9664/proc"),(0,r.kt)("p",null,"\u542f\u52a8\u72b6\u6001\u7684\u4e3b\u673a\u4e00\u5b9a\u5305\u542b\u8fd9\u4e2a\u4e3b\u673a\u7684\u5bf9\u5e94\u7684\u6620\u5c04, \u56e0\u6b64\u9700\u8981\u6392\u9664/sys"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# --numeric-owner \u53c2\u6570\u6307\u6253\u5305\u8fc7\u7a0b\u4e2d\u7ed9\u6240\u6709\u7684\u6587\u4ef6\u5939\u4ee5\u53ca\u6587\u4ef6\u7684\u7528\u6237\u540d\u5168\u90e8\u66ff\u6362\u6210\u6570\u5b57\n# -cvf \u521b\u5efa\u663e\u793a\u6587\u4ef6\n# / \u4ee3\u8868\u6253\u5305\u5230 / \u76ee\u5f55\n[root@bogon ~]# tar --numeric-owner --exclude=/proc --exclude=/sys -cvf centos7u6.tar /\n\n# ll -h \u67e5\u770b\u6253\u5305\u597d\u7684\u955c\u50cf\n\n# scp \u955c\u50cf\u540d.tar \u76ee\u6807ip:/\u76ee\u5f55\u540d\n")),(0,r.kt)("h3",{id:"3-\u628a\u83b7\u53d6\u7684\u6839\u6253\u5305\u6587\u4ef6\u5bfc\u5165\u5230-docker-host-\u4e3b\u673a\u4e2d"},"3. \u628a\u83b7\u53d6\u7684\u6839\u6253\u5305\u6587\u4ef6\u5bfc\u5165\u5230 Docker host \u4e3b\u673a\u4e2d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# \u628a\u4e0a\u9762\u6253\u597d\u7684tar\u5305\u5bfc\u5165\u5230\u4e3b\u673a\u4e2d\u53d8\u6210\u57fa\u7840\u955c\u50cf\n[root@bogon ~]# docker import centos7u6.tar centos7u6:latest\n\n[root@bogon ~]# docker image ls\nREPOSITORY TAG IMAGE ID CREATED SIZE\ncentos7u6 latest 9223c5786c4c 15 seconds ago 1.5GB\n")),(0,r.kt)("h3",{id:"4-\u4f7f\u7528\u57fa\u7840\u955c\u50cf\u542f\u52a8\u5bb9\u5668"},"4. \u4f7f\u7528\u57fa\u7840\u955c\u50cf\u542f\u52a8\u5bb9\u5668"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon ~]# docker run -it --name c1000 centos7u6:latest /bin/bash\n[root@f56add98265c /]# ls /proc\n1 cpuinfo fs kmsg mounts slabinfo tty\n22 crypto interrupts kpagecount mtrr softirqs uptime\nacpi devices iomem kpageflags net stat version\nasound diskstats ioports loadavg pagetypeinfo swaps\nvmallocinfo\nbuddyinfo dma irq locks partitions sys vmstat\nbus driver kallsyms mdstat sched_debug sysrq-trigger zoneinfo\ncgroups execdomains kcore meminfo schedstat sysvipc\ncmdline fb keys misc scsi timer_list\nconsoles filesystems key-users modules self timer_stats\n[root@f56add98265c /]# ip a s\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen\n1000\nlink/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\ninet 127.0.0.1/8 scope host lo\nvalid_lft forever preferred_lft forever\n38: eth0@if39: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group\ndefault\nlink/ether 02:42:ac:11:00:09 brd ff:ff:ff:ff:ff:ff link-netnsid 0\ninet 172.17.0.9/16 brd 172.17.255.255 scope global eth0\nvalid_lft forever preferred_lft forever\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u5236\u4f5c\u5e94\u7528\u955c\u50cf"},"\u5236\u4f5c\u5e94\u7528\u955c\u50cf"),(0,r.kt)("p",null,"\u5e94\u7528\u955c\u50cf\u6307\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u7684\u73af\u5883"),(0,r.kt)("h3",{id:"\u4f7f\u7528-commit-\u63d0\u4ea4\u955c\u50cf"},"\u4f7f\u7528 commit \u63d0\u4ea4\u955c\u50cf"),(0,r.kt)("p",null,"\u4f7f\u7528\u5bb9\u5668\u7684\u6587\u4ef6\u7cfb\u7edf\u5728\u57fa\u7840\u955c\u50cf\u8fd0\u884c\u7684\u5bb9\u5668\u4e2d\u5b89\u88c5\u5e94\u7528\uff0c\u6b64\u4f8b\u4f7f\u7528 httpd"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@f56add98265c /]# yum -y install httpd\n")),(0,r.kt)("p",null,"\u6b64\u65f6\u5236\u4f5c\u4e86\u4e00\u4e2a\u5bb9\u5668, \u8fd8\u9700\u8981\u8ba9\u8fd9\u4e2a\u5bb9\u5668\u53d8\u6210\u955c\u50cf"),(0,r.kt)("p",null,"\u4f7f\u7528 commit \u547d\u4ee4\u5bf9\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u63d0\u4ea4\u4e3a\u4e00\u4e2a\u5e94\u7528\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon ~]# docker commit c1000 centos7u6-httpd:v1\nsha256:7bc399ab72aa3335e383e58d709770fa5c3bfeee66cccf7976776e22fe5fedc7\n[root@bogon ~]# docker images\nREPOSITORY TAG IMAGE ID CREATED SIZE\ncentos7u6-httpd v1 7bc399ab72aa 5 seconds ago 1.67GB\n")),(0,r.kt)("p",null,"\u6b64\u65f6\u53ef\u4ee5\u4f7f\u7528\u5e94\u7528\u955c\u50cf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon ~]# docker run -it centos7u6-httpd:v1 /bin/bash\n[root@1abdebd392db /]# echo \"ttt\" >> /var/www/html/index.html\n[root@1abdebd392db /]# httpd -k start\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name,\nusing 172.17.0.10. Set the 'ServerName' directive globally to suppress this message\n[root@1abdebd392db /]# curl http://localhost\nttt\n")),(0,r.kt)("h2",{id:"\u4f7f\u7528-docker-build-\u521b\u5efa\u6307\u5b9a\u5e94\u7528\u5bb9\u5668\u955c\u50cf"},"\u4f7f\u7528 docker build \u521b\u5efa\u6307\u5b9a\u5e94\u7528\u5bb9\u5668\u955c\u50cf"),(0,r.kt)("h3",{id:"1-\u4f7f\u7528-docker-build-\u547d\u4ee4"},"1. \u4f7f\u7528 docker build \u547d\u4ee4"),(0,r.kt)("h3",{id:"2-\u57fa\u4e8e-dockerfile"},"2. \u57fa\u4e8e Dockerfile"),(0,r.kt)("h3",{id:"3-dockfile-\u539f\u7406"},"3. Dockfile \u539f\u7406"),(0,r.kt)("p",null,"\u5728 Dockerfile \u5b9a\u4e49\u6240\u8981\u6267\u884c\u7684\u547d\u4ee4\uff0c\u4f7f\u7528 docker build \u521b\u5efa\u955c\u50cf\uff0c\u8fc7\u7a0b\u4e2d\u4f1a\u6309\u7167 Dockerfile \u6240\u5b9a\u4e49\u7684\u5185\u5bb9\u6253\u5f00\u4e34\u65f6\u6027\u5bb9\u5668(\u4f7f\u7528 docker commit \u8fdb\u884c\u63d0\u4ea4)\uff0c\u628a Dockerfile \u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\u5168\u90e8\u6267\u884c\u5b8c\u6210\uff0c\u5c31\u5f97\u5230\u4e86\u4e00\u4e2a\u5bb9\u5668\u5e94\u7528\u955c\u50cf\u3002"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u6267\u884c\u547d\u4ee4\u8d8a\u591a\uff0c\u6700\u7ec8\u5f97\u5230\u7684\u5bb9\u5668\u5e94\u7528\u955c\u50cf\u8d8a\u5927\uff0c\u6240\u4ee5\u8981\u505a\u4f18\u5316"))),(0,r.kt)("h3",{id:"4-dockerfile-\u5173\u952e\u5b57"},"4. Dockerfile \u5173\u952e\u5b57"),(0,r.kt)("h4",{id:"from\u6307\u5b9a\u57fa\u7840-image"},(0,r.kt)("strong",{parentName:"h4"},"FROM\uff08\u6307\u5b9a\u57fa\u7840 image\uff09")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"FROM ",(0,r.kt)("inlineCode",{parentName:"li"},"<image>")," \u6307\u5b9a\u57fa\u7840 image \u4e3a\u8be5 image \u7684\u6700\u540e\u4fee\u6539\u7684\u7248\u672c"),(0,r.kt)("li",{parentName:"ul"},"FROM ",(0,r.kt)("inlineCode",{parentName:"li"},"<image>:<tag>")," \u6307\u5b9a\u57fa\u7840 image \u4e3a\u8be5 image \u7684\u4e00\u4e2a tag \u7248\u672c")),(0,r.kt)("h4",{id:"maintainer\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f"},(0,r.kt)("strong",{parentName:"h4"},"MAINTAINER\uff08\u7528\u6765\u6307\u5b9a\u955c\u50cf\u521b\u5efa\u8005\u4fe1\u606f\uff09")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MAINTAINER ",(0,r.kt)("inlineCode",{parentName:"li"},"<name>")),(0,r.kt)("li",{parentName:"ul"},'\u4f8b\u5982: MAINTAINER "smartgo ',(0,r.kt)("a",{parentName:"li",href:"mailto:smartgodevop@126.com"},"smartgodevop@126.com"),'"')),(0,r.kt)("h4",{id:"run-\u8fd0\u884c\u547d\u4ee4"},(0,r.kt)("strong",{parentName:"h4"},"RUN (\u8fd0\u884c\u547d\u4ee4)")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"RUN ",(0,r.kt)("inlineCode",{parentName:"li"},"<command>")," (the command is run in a shell - /bin/sh -c)"),(0,r.kt)("li",{parentName:"ul"},"RUN ",'["executable", "param1", "param2" ...]')),(0,r.kt)("h4",{id:"cmd\u8bbe\u7f6e-container-\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c"},(0,r.kt)("strong",{parentName:"h4"},"CMD\uff08\u8bbe\u7f6e container \u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u5982\u679c\u5bb9\u5668\u955c\u50cf\u4e2d\u6709\u6b64\u547d\u4ee4\uff0c\u542f\u52a8\u5bb9\u5668\u65f6\uff0c\u4e0d\u8981\u624b\u52a8\u8ba9\u5bb9\u5668\u6267\u884c\u5176\u5b83\u547d\u4ee4"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CMD ",'["executable", "param1", "param2" ...]')),(0,r.kt)("h4",{id:"entrypoint\u8bbe\u7f6e-container-\u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c"},"ENTRYPOINT\uff08\u8bbe\u7f6e container \u542f\u52a8\u65f6\u6267\u884c\u7684\u64cd\u4f5c\uff09"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ENTRYPOINT ",'["executable", "param1", "param2" ...]')),(0,r.kt)("h4",{id:"user\u8bbe\u7f6e-container-\u5bb9\u5668\u7684\u7528\u6237"},"USER\uff08\u8bbe\u7f6e container \u5bb9\u5668\u7684\u7528\u6237\uff09"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"USER daemon")),(0,r.kt)("h4",{id:"expose\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3"},(0,r.kt)("strong",{parentName:"h4"},"EXPOSE\uff08\u6307\u5b9a\u5bb9\u5668\u9700\u8981\u6620\u5c04\u5230\u5bbf\u4e3b\u673a\u5668\u7684\u7aef\u53e3\uff09")),(0,r.kt)("p",null,"\u5982\u679c\u771f\u5b9e\u673a\u5f53\u4e2d\u6709\u7aef\u53e3, \u5bb9\u5668\u91cc\u9762\u6ca1\u6709\u5f00\u542f\u7aef\u53e3, \u6ca1\u6cd5\u505a\u6620\u5c04, \u6240\u4ee5\u9700\u8981\u7ed9\u5bb9\u5668\u5f00\u7aef\u53e3"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"EXPOSE ",(0,r.kt)("inlineCode",{parentName:"li"},"<port> [<port>...]"))),(0,r.kt)("h4",{id:"env\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf"},"ENV\uff08\u7528\u4e8e\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff09"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ENV ",(0,r.kt)("inlineCode",{parentName:"li"},"<key> <value>"))),(0,r.kt)("h4",{id:"add\u4ece-src-\u590d\u5236\u6587\u4ef6\u5230-container-\u7684-dest-\u8def\u5f84"},(0,r.kt)("strong",{parentName:"h4"},"ADD\uff08\u4ece src \u590d\u5236\u6587\u4ef6\u5230 container \u7684 dest \u8def\u5f84\uff09")),(0,r.kt)("p",null,"\u628a docker \u4e3b\u673a\u7684\u6587\u4ef6\u6dfb\u52a0\u5230\u5bb9\u5668\u91cc"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"ADD ",(0,r.kt)("inlineCode",{parentName:"li"},"<src> <dest>"))),(0,r.kt)("h4",{id:"volume\u6307\u5b9a\u6302\u8f7d\u70b9"},"VOLUME\uff08\u6307\u5b9a\u6302\u8f7d\u70b9\uff09"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"VOLUME ",(0,r.kt)("inlineCode",{parentName:"li"},'["<mountpoint>"]'))),(0,r.kt)("h4",{id:"workdir\u5207\u6362\u76ee\u5f55"},(0,r.kt)("strong",{parentName:"h4"},"WORKDIR\uff08\u5207\u6362\u76ee\u5f55\uff09")),(0,r.kt)("p",null,"\u6bd4\u5982\u73b0\u5728\u767b\u5f55\u8fdb\u5bb9\u5668, \u4f4d\u4e8e\u6839\u76ee\u5f55, \u4f46\u662f\u811a\u672c\u653e\u5230 /opt \u6587\u4ef6\u5939\u4e0b, \u539f\u6765\u5de5\u4f5c\u662f\u5728\u6839\u76ee\u5f55\u4e0b\u5de5\u4f5c\u73b0\u5728\u6267\u884c\u811a\u672c\u8981\u5207\u6362\u8def\u5f84, \u4f7f\u7528 workdir \u5207\u6362\u5230/opt"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u683c\u5f0f:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"WORKDIR /path/to/workdir")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"dockerfile-\u5e94\u7528\u6848\u4f8b\u4e00"},"Dockerfile \u5e94\u7528\u6848\u4f8b\u4e00"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u76ee\u7684"),"\uff1a\u901a\u8fc7 Dockerfile \u521b\u5efa\u4e00\u4e2a\u53ef\u4ee5\u5728\u542f\u52a8\u5bb9\u5668\u65f6\u5c31\u76f4\u63a5\u542f\u52a8 httpd \u5e94\u7528\u7684\u955c\u50cf"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u6b65\u9aa4"),"\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8 Dockerfile \u6240\u4f7f\u7528\u7684\u6587\u4ef6"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u6b64\u76ee\u5f55\u4e2d\u521b\u5efa Dockerfile \u6587\u4ef6\u53ca\u5236\u4f5c\u955c\u50cf\u6240\u4f7f\u7528\u5230\u7684\u6587\u4ef6"),(0,r.kt)("li",{parentName:"ul"},"\u5728\u6b64\u6b64\u76ee\u5f55\u4e2d\u4f7f\u7528 docker build \u521b\u5efa\u955c\u50cf(\u8bfb\u53d6 Dockerfile \u6587\u4ef6)"),(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u521b\u5efa\u7684\u955c\u50cf\u542f\u52a8\u5bb9\u5668")),(0,r.kt)("h3",{id:"\u8fc7\u7a0b"},(0,r.kt)("inlineCode",{parentName:"h3"},"\u8fc7\u7a0b"),"\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u76ee\u5f55")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon ~]# mkdir test\n[root@bogon ~]# cd test\n\n[root@bogon ~]vim run-httpd.sh\n\n#\u6587\u4ef6\u91cc\u5199\u5165\n#!/bin/bash\n\nrm -rf /run/httpd/*   #\u5220\u9664apache\u8fdb\u7a0b\nexec /sbin/httpd -D FOREGROUND  # -D \u7528\u6765\u6307\u5b9aapache\u8fd0\u884c\u5728\u524d\u7aef\u8fd8\u662f\u540e\u7aef FOREGROUND\u4ee3\u8868\u524d\u7aef\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u8fdb\u5165\u76ee\u5f55\u5e76\u521b\u5efa\u7528\u4e8e\u542f\u52a8 httpd \u7684\u811a\u672c\u6587\u4ef6")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon test]# cat run-httpd.sh\n#!/bin/bash\nrm -rf /run/httpd/*\nexec /sbin/httpd -D FOREGROUND\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa\u7528\u4e8e\u6d4b\u8bd5 httpd \u662f\u5426\u53ef\u7528\u7684 index.htm")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon test]# cat index.html\nIt's work!!!\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u521b\u5efa Dockerfile")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'[root@bogon test]# vim Dockerfile\n\n# \u6587\u4ef6\u91cc\u5199\u5165\nFROM centos7u6:latest\nMAINTAINER "smartdocker@smartdocker@126.com"\nRUN yum clean all\nRUN rpm --rebuilddb && yum -y install httpd\nADD run-httpd.sh /run-httpd.sh     # \u6254\u8fdb\u6765\u53ea\u6709644\u6743\u9650, \u4e5f\u5c31\u662f\u8bfb\u8bfb, \u8bfb\u5199, \u6ca1\u6709\u6267\u884c\u6743\u9650, \u9700\u8981\u6267\u884c\u6743\u9650\u4e5f\u5c31\u662f\u4e0b\u9762 +x, -v \u663e\u793a\u52a0\u6743\u9650\u8fc7\u7a0b\nRUN chmod -v +x /run-httpd.sh\nADD index.html /var/www/html/\nEXPOSE 80  # \u662f\u66b4\u9732\u5bb9\u5668\u768480\u7aef\u53e3\nWORKDIR /  # \u5207\u6362\u76ee\u5f55\u5230\u6839, \u624d\u80fd\u627e\u5230\u6267\u884c/run-httpd.sh\u6587\u4ef6 \u56e0\u4e3a\u5728\u4e0a\u9762ADD\u547d\u4ee4\u51b3\u5b9a\u4e86\nCMD ["/bin/bash","/run-httpd.sh"]\n\n[root@bogon test]# cat Dockerfile\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528 docker build \u521b\u5efa\u955c\u50cf\uff0c\u6ce8\u610f\u547d\u4ee4\u6700\u540e\u6709\u4e00\u4e2a\u70b9\uff0c\u70b9\u8868\u793a\u5f53\u524d\u76ee\u5f55")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon test]# docker build -t centos7u6-base-httpd:v1 .\n")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u4e0a\u8ff0\u521b\u5efa\u7684\u5e94\u7528\u5bb9\u5668\u542f\u52a8\u5bb9\u5668")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon test]# docker run -d centos7u6-base-httpd:v1\n# -d \u4ee3\u8868\u5bb9\u5668\u5728\u540e\u53f0\u6267\u884c\n")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1\u5bb9\u5668\u53ca httpd \u662f\u5426\u53ef\u7528")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon test]# docker inspect 31d #\u67e5\u770b\u5bb9\u5668IP\u5730\u5740\n[root@bogon test]# curl http://172.17.0.11\nIt's work!!!\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u66ff\u4ee3\u539f\u7f51\u7ad9\u5185\u5bb9\u6848\u4f8b"},"\u66ff\u4ee3\u539f\u7f51\u7ad9\u5185\u5bb9\u6848\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'[root@bogon test]# mkdir /wwwroot\n[root@bogon test]# echo "wwwroot" >> /wwwroot/index.html\n\n[root@bogon test]# docker run -d -v /wwwroot:/var/www/html centos7u6-base-httpd:v1\n415e82ad0041aa18bcb92bc8edbdf9bd758915a8345c71266f51937de3a20a26\n[root@bogon test]# docker inspect 415\n[root@bogon test]# curl http://172.17.0.12\nwwwroot\n')),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"\u5982\u679c\u9047\u5230 Rpmdb \u9519\u8bef\uff0c\u53ef\u4ee5\u8003\u8651\u5b89\u88c5\uff1ayum-plugin-ovl \u8f6f\u4ef6\u5305\u3002"))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"\u628a-nginx-\u5e94\u7528\u5bb9\u5668\u5316\u6848\u4f8b"},"\u628a nginx \u5e94\u7528\u5bb9\u5668\u5316\u6848\u4f8b"),(0,r.kt)("p",null,"\u8981\u6c42\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1\u3001\u901a\u8fc7\u57fa\u7840\u955c\u50cf\u505a nginx \u5e94\u7528\u955c\u50cf"),(0,r.kt)("li",{parentName:"ul"},"2\u3001\u4f7f\u7528 nginx \u5e94\u7528\u955c\u50cf\u542f\u52a8\u5bb9\u5668\u65f6\uff0cnginx \u8981\u6c42\u542f\u52a8"),(0,r.kt)("li",{parentName:"ul"},"3\u3001\u9a8c\u8bc1 nginx \u670d\u52a1\u662f\u5426\u542f\u52a8")),(0,r.kt)("p",null,"\u6b65\u9aa4\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1\u3001\u4f7f\u7528\u54ea\u4e00\u4e2a\u57fa\u7840 centos:latest"),(0,r.kt)("li",{parentName:"ul"},"2\u3001\u9700\u8981\u4f7f\u7528 epel YUM \u6e90"),(0,r.kt)("li",{parentName:"ul"},"3\u3001\u5b89\u88c5 nginx"),(0,r.kt)("li",{parentName:"ul"},"4\u3001\u4fee\u6539 nginx \u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u7528\u4e8e\u5173\u95ed daemon \u540e\u53f0\u8fd0\u884c, \u8fd9\u6837\u5bb9\u5668\u4e2d\u6709 nginx \u4e00\u76f4\u5728\u8fd0\u884c, \u5bb9\u5668\u5c31\u4e0d\u4f1a\u5173\u95ed\u4e86"),(0,r.kt)("li",{parentName:"ul"},"5\u3001\u9a8c\u8bc1\u4f7f\u7528\u7684\u6d4b\u8bd5\u9875\u9762")),(0,r.kt)("p",null,"\u8fc7\u7a0b:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u76ee\u5f55")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@localhost ~]# mkdir nginxtest\n[root@localhost ~]# cd nginxtest/\n[root@localhost nginxtest]#\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa\u6d4b\u8bd5\u6587\u4ef6")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@localhost nginxtest]# echo 'nginx s running!!!' >> index.html\n[root@localhost nginxtest]# ls\nindex.html\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u521b\u5efa Dockerfile")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'[root@localhost nginxtest]# cat Dockerfile\nFROM centos:latest\n\nMAINTAINER "smartaiops<smartaiops@126.com>"\n\n# yum -y install \u7684-y \u4ee3\u8868\u975e\u4ea4\u4e92\u5f0f\nRUN yum clean all && yum -y install yum-plugin-ovl && yum -y install epel-release\nRUN yum -y install nginx\n\nADD index.html /usr/share/nginx/html/\n\nRUN echo "daemon off;" >> /etc/nginx/nginx.conf #\u53d6\u6d88nginx\u4ee5daemon\u8eab\u4efd\u8fd0\u884c\n\nEXPOSE 80\n\nCMD /usr/sbin/nginx\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4f7f\u7528 docker build \u521b\u5efa nginx \u5e94\u7528\u955c\u50cf")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@localhost nginxtest]# docker build -t centos-nginx:v1 .\n# -t \u4ee3\u8868 tag\u540d\u662f\u540e\u9762\u7684\n# \u5982\u679c\u4e0d\u52a0 . \u53ef\u4ee5\u7528 -f \u7edd\u5bf9\u8def\u5f84\u4ee3\u66ff\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u542f\u52a8\u5bb9\u5668\u9a8c\u8bc1 nginx \u670d\u52a1\u662f\u5426\u81ea\u52a8\u5f00\u542f")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'[root@localhost nginxtest]# docker images\nREPOSITORY TAG IMAGE ID CREATED SIZE\ncentos-nginx v1 cf23c20ff2cd 20 seconds ago 466MB\n[root@localhost nginxtest]# docker run -d centos-nginx:v1\n5b1d6dae77d24d9c8dc136a5bf971ebe296e1463838bda46e586d07d6f572f6d\n[root@localhost nginxtest]# docker ps\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES\n5b1d6dae77d2 centos-nginx:v1 "/bin/sh -c /usr/sbi\u2026" 9 seconds ago Up 8 seconds 80/tcp upbeat_khayyam\n[root@localhost nginxtest]# docker inspect 5b1d\n[root@localhost nginxtest]# curl http://172.17.0.3\nnginx s running!!!\n')),(0,r.kt)("h2",{id:"\u5bb9\u5668\u955c\u50cf\u5728-docker-host-\u5b58\u50a8\u4f4d\u7f6e"},"\u5bb9\u5668\u955c\u50cf\u5728 docker host \u5b58\u50a8\u4f4d\u7f6e"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"dh",src:n(152).Z})),(0,r.kt)("p",null,"\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\u9664\u4e86\u6700\u4e0a\u9762\u7684\u4e00\u5c42\u4e3a\u8bfb\u5199\u5c42\u4e4b\u5916\uff0c\u4e0b\u9762\u7684\u5176\u4ed6\u7684\u5c42\u90fd\u662f\u53ea\u8bfb\u7684\u955c\u50cf\u5c42\uff0c\u5e76\u4e14\u9664\u4e86\u6700\u4e0b\u9762\u7684\u4e00\u5c42\u5916\uff0c\u5176\u4ed6\u7684\u5c42\u90fd\u6709\u4f1a\u6709\u4e00\u4e2a\u6307\u9488\u6307\u5411\u81ea\u5df1\u4e0b\u9762\u7684\u4e00\u5c42\u955c\u50cf\u3002"),(0,r.kt)("p",null,"\u867d\u7136\u7edf\u4e00\u6587\u4ef6\u7cfb\u7edf(union file system)\u6280\u672f\u5c06\u4e0d\u540c\u7684\u955c\u50cf\u5c42\u6574\u5408\u6210\u4e00\u4e2a\u7edf\u4e00\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u4e3a\u6784\u6210\u4e00\u4e2a\u5b8c\u6574\u5bb9\u5668\u955c\u50cf\u7684\u5c42\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u89c6\u89d2\uff0c\u9690\u85cf\u4e86\u591a\u4e2a\u5c42\u7684\u590d\u6742\u6027\uff0c\u5bf9\u7528\u6237\u6765\u8bf4\u53ea\u5b58\u5728\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u56fe\u4e2d\u7684\u8fd9\u4e9b\u5c42\u5e76\u4e0d\u662f\u4e0d\u80fd\u770b\u5230\u7684\uff0c\u5982\u679c\u9700\u8981\u67e5\u770b\u7684\u8bdd\u53ef\u4ee5\u8fdb\u5165\u8fd0\u884c Docker \u7684\u673a\u5668\u4e0a\u8fdb\u884c\u67e5\u770b\uff0c\u4ece\u8fd9\u4e9b\u5c42\u4e2d\u53ef\u4ee5\u770b\u5230 Docker \u5185\u90e8\u5b9e\u73b0\u7684\u4e00\u4e9b\u7ec6\u8282\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Docker \u7684\u5bb9\u5668\u955c\u50cf"),"\u548c",(0,r.kt)("inlineCode",{parentName:"p"},"\u5bb9\u5668\u672c\u8eab\u7684\u6570\u636e"),"\u90fd\u5b58\u653e\u5728\u670d\u52a1\u5668\u7684 /var/lib/docker/ \u8fd9\u4e2a\u8def\u5f84\u4e0b\u3002\u4e0d\u8fc7\u4e0d\u540c\u7684 linux \u53d1\u884c\u7248\u5b58\u50a8\u65b9\u5f0f\u4e0a\u6709\u5dee\u522b\uff0c\u6bd4\u5982\uff0c\u5728 ubuntu \u53d1\u884c\u7248\u4e0a\u5b58\u50a8\u65b9\u5f0f\u4e3a AUFS\uff0cCentOS \u53d1\u884c\u7248\u4e0a\u7684\u5b58\u50a8\u65b9\u5f0f\u4e3a Overlay \u6216 Overlay2\u3002"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"centos \u7cfb\u7edf docker \u9ed8\u8ba4\u4f7f\u7528\u5b58\u50a8\u9a71\u52a8\u662f devicemapper\uff0c\u800c\u8fd9\u79cd\u5b58\u50a8\u9a71\u52a8\u6709\u4e24\u79cd\u6a21\u5f0f loop-lvm \u548c direct-lvm\uff0c\u4e0d\u5de7\u9ed8\u8ba4\u53c8\u4f7f\u7528\u4e86\u6bd4\u8f83\u4f4e\u6548\u7684 loop-lvm\u3002"))),(0,r.kt)("p",null,"OverlayFS \u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e AUFS \u7684\u73b0\u4ee3\u8054\u5408\u6587\u4ef6\u7cfb\u7edf\uff0c\u66f4\u5feb\u5b9e\u73b0\u7b80\u5355\u3002"),(0,r.kt)("p",null,"OverlayFS \u662f\u5185\u6838\u63d0\u4f9b\u7684\u6587\u4ef6\u7cfb\u7edf\uff0coverlay \u548c overlay2 \u662f docker \u7684\u5b58\u50a8\u9a71\u52a8"),(0,r.kt)("h3",{id:"overlay-\u53ca-overlay2-\u539f\u7406"},"Overlay \u53ca Overlay2 \u539f\u7406"),(0,r.kt)("p",null,"OverlayFS \u5c06\u5355\u4e2a Linux \u4e3b\u673a\u4e0a\u7684\u4e24\u4e2a\u76ee\u5f55\u5408\u5e76\u6210\u4e00\u4e2a\u76ee\u5f55\u3002\u8fd9\u4e9b\u76ee\u5f55\u88ab\u79f0\u4e3a\u5c42\uff0c\u7edf\u4e00\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u8054\u5408\u6302\u8f7d\u3002OverlayFS \u5e95\u5c42\u76ee\u5f55\u79f0\u4e3a lowerdir\uff0c \u9ad8\u5c42\u76ee\u5f55\u79f0\u4e3a upperdir\u3002\u5408\u5e76\u7edf\u4e00\u89c6\u56fe\u79f0\u4e3a merged\u3002\u5f53\u9700\u8981\u4fee\u6539\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528 CoW \u5c06\u6587\u4ef6\u4ece\u53ea\u8bfb\u7684 Lower \u590d\u5236\u5230\u53ef\u5199\u7684 Upper \u8fdb\u884c\u4fee\u6539\uff0c\u7ed3\u679c\u4e5f\u4fdd\u5b58\u5728 Upper \u5c42\u3002\u5728 Docker \u4e2d\uff0c\u5e95\u4e0b\u7684\u53ea\u8bfb\u5c42\u5c31\u662f image\uff0c\u53ef\u5199\u5c42\u5c31\u662f Container\u3002"),(0,r.kt)("p",null,"overlay2 \u662f overlay \u7684\u6539\u8fdb\u7248\uff0c\u53ea\u652f\u6301 4.0 \u4ee5\u4e0a\u5185\u6838\u6dfb\u52a0\u4e86 Multiple lower layers in overlayfs \u7684\u7279\u6027\uff0c\u6240\u4ee5 overlay2 \u53ef\u4ee5\u76f4\u63a5\u9020\u6210 muitiple lower layers \u4e0d\u7528\u50cf overlay \u4e00\u6837\u8981\u901a\u8fc7\u786c\u94fe\u63a5\u7684\u65b9\u5f0f(\u6700\u5927 128 \u5c42) centos \u7684\u8bdd\u652f\u6301 3.10.0-514 \u53ca\u4ee5\u4e0a\u5185\u6838\u7248\u672c\u4e5f\u6709\u6b64\u7279\u6027\uff0c\u6240\u4ee5\u6d88\u8017\u66f4\u5c11\u7684 inode"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"\u672c\u8d28\u533a\u522b\u662f\u955c\u50cf\u5c42\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u7684\u65b9\u6cd5\u4e0d\u540c")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"overlay \u5171\u4eab\u6570\u636e\u65b9\u5f0f\u662f\u901a\u8fc7\u786c\u8fde\u63a5\uff0c\u53ea\u6302\u8f7d\u4e00\u5c42,\u5176\u4ed6\u5c42\u901a\u8fc7\u6700\u9ad8\u5c42\u901a\u8fc7\u786c\u8fde\u63a5\u5f62\u5f0f\u5171\u4eab(\u589e\u52a0\u4e86\u78c1\u76d8 inode \u7684\u8d1f\u62c5)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"\u800c overlay2 \u662f\u901a\u8fc7\u6bcf\u5c42\u7684 lower \u6587\u4ef6"))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"overlay",src:n(73865).Z})),(0,r.kt)("p",null,"\u5982\u679c upperdir \u548c lowerdir \u6709\u540c\u540d\u6587\u4ef6\u65f6\u4f1a\u7528 upperdir \u7684\u6587\u4ef6"),(0,r.kt)("h3",{id:"\u67e5\u770b-docker-\u9ed8\u8ba4\u4f7f\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u65b9\u6cd5"},"\u67e5\u770b docker \u9ed8\u8ba4\u4f7f\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u65b9\u6cd5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon overlay2]# docker info\nContainers: 1\nRunning: 1\nPaused: 0\nStopped: 0\nImages: 1\nServer Version: 18.09.5\nStorage Driver: overlay2 #\u6ce8\u610f\u6b64\u5904\nBacking Filesystem: xfs\nSupports d_type: true\nNative Overlay Diff: true\nLogging Driver: json-file\nCgroup Driver: cgroupfs\nPlugins:\n# \u4ee5\u4e0b\u7565\n")),(0,r.kt)("h3",{id:"docker-\u8fd0\u884c\u524d"},"docker \u8fd0\u884c\u524d"),(0,r.kt)("p",null,"/var/lib/docker/overlay2 \u8def\u5f84\u4e0b\u7684\u4fe1\u606f\u5728\u4e0d\u540c\u7684\u9636\u6bb5\u4f1a\u6709\u53d8\u5316\uff0c\u4e86\u89e3\u8fd9\u51e0\u4e2a\u9636\u6bb5\u4e2d\u65b0\u589e\u7684\u6570\u636e\u4ee5\u53ca\u5bb9\u5668\u4e0e\u955c\u50cf\u7684\u5b58\u50a8\u7ed3\u6784\u7684\u53d8\u5316\u975e\u5e38\u6709\u5229\u4e8e\u6211\u4eec\u5bf9 Docker \u5bb9\u5668\u4ee5\u53ca Docker \u955c\u50cf\u7684\u7406\u89e3\u3002"),(0,r.kt)("p",null,"Docker \u8fd0\u884c\u524d\u3001Docker \u8fd0\u884c\u540e\u3001\u4e0b\u8f7d\u955c\u50cf\u540e\u3001\u8fd0\u884c\u5bb9\u5668\u540e\u56db\u4e2a\u9636\u6bb5\u4e2d Docker \u5b58\u50a8\u7684\u53d8\u5316"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8fd0\u884c\u524d")),(0,r.kt)("p",null,"\u6ca1\u6709\u542f\u52a8 docker daemon \u4e4b\u95f4\u4e0d\u4f1a\u5728/var/lib/\u76ee\u5f55\u4e2d\u6dfb\u52a0 docker \u76ee\u5f55"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u542f\u52a8\u540e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon ~]# systemctl start docker\n[root@bogon ~]# tree /var/lib/docker\n/var/lib/docker\n\u251c\u2500\u2500 builder\n\u2502 \u2514\u2500\u2500 fscache.db\n\u251c\u2500\u2500 buildkit\n\u2502 \u251c\u2500\u2500 cache.db\n\u2502 \u251c\u2500\u2500 content\n\u2502 \u2502 \u2514\u2500\u2500 ingest\n\u2502 \u251c\u2500\u2500 executor\n\u2502 \u251c\u2500\u2500 metadata.db\n\u2502 \u2514\u2500\u2500 snapshots.db\n\u251c\u2500\u2500 containers\n\u251c\u2500\u2500 image\n\u2502 \u2514\u2500\u2500 overlay2\n\u2502 \u251c\u2500\u2500 distribution\n\u2502 \u251c\u2500\u2500 imagedb\n\u2502 \u2502 \u251c\u2500\u2500 content\n\u2502 \u2502 \u2502 \u2514\u2500\u2500 sha256\n\u2502 \u2502 \u2514\u2500\u2500 metadata\n\u2502 \u2502 \u2514\u2500\u2500 sha256\n\u2502 \u251c\u2500\u2500 layerdb\n\u2502 \u2514\u2500\u2500 repositories.json\n\u251c\u2500\u2500 network\n\u2502 \u2514\u2500\u2500 files\n\u2502 \u2514\u2500\u2500 local-kv.db\n\u251c\u2500\u2500 overlay2 #\u4e0b\u8f7d\u955c\u50cf\u540e\uff0c\u5b58\u50a8\u5728\u6b64\u76ee\u5f55\u4e2d\n\u2502 \u251c\u2500\u2500 backingFsBlockDev\n\u2502 \u2514\u2500\u2500 l\n\u251c\u2500\u2500 plugins\n\u2502 \u251c\u2500\u2500 storage\n\u2502 \u2502 \u2514\u2500\u2500 blobs\n\u2502 \u2502 \u2514\u2500\u2500 tmp\n\u2502 \u2514\u2500\u2500 tmp\n\u251c\u2500\u2500 runtimes\n\u251c\u2500\u2500 swarm\n\u251c\u2500\u2500 tmp\n\u251c\u2500\u2500 trust\n\u2514\u2500\u2500 volumes\n\u2514\u2500\u2500 metadata.db\n29 directories, 8 files\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d\u955c\u50cf\u540e")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon overlay2]# pwd\n/var/lib/docker/overlay2\n[root@bogon overlay2]# ls\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d backingFsBlockDev l\n[root@bogon overlay2]# ls\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d/\ndiff link\n[root@bogon overlay2]# ls\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d/diff/\nanaconda-post.log dev home lib64 mnt proc run srv tmp var\nbin etc lib media opt root sbin sys usr\n")),(0,r.kt)("p",null,"centos \u955c\u50cf\u53ea\u6709\u4e00\u5c42"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon overlay2]# pwd\n/var/lib/docker/overlay2\n[root@bogon overlay2]# ls\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d backingFsBlockDev l\n[root@bogon overlay2]# ll l\n\u603b\u7528\u91cf 0\nlrwxrwxrwx 1 root root 72 4\u6708 26 12:58 MBRXMBFE2MYZYMO5RZLRLTMRGJ ->\n../2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d/diff\n")),(0,r.kt)("p",null,"l \u76ee\u5f55\u4e2d\u5305\u542b\u4e86\u5f88\u591a\u591a\u8f6f\u94fe\u63a5\uff0c\u4f7f\u7528\u77ed\u540d\u79f0\u6307\u5411\u4e86\u5176\u4ed6\u5c42\uff0c\u77ed\u540d\u79f0\u7528\u4e8e\u907f\u514d mount \u53c2\u6570\u65f6\u8fbe\u5230\u9875\u9762\u5927\u5c0f\u7684\u9650\u5236"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u8fd0\u884c\u5bb9\u5668\u540e")),(0,r.kt)("p",null,"Overlay2 \u5bb9\u5668\u7ed3\u6784"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"#\u8fd0\u884c\u5bb9\u5668\u524d\n[root@bogon overlay2]# ls\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d backingFsBlockDev l\n\n#\u8fd0\u884c\u5bb9\u5668\u540e\n[root@bogon overlay2]# ls\n00bd7dcc4c91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cda0\nbackingFsBlockDev\n00bd7dcc4c91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cda0-init l\n2d297a77c653f510dce69815627fdb485462b1b2fc9e0078a9ecc5ca2d222c8d\n[root@bogon overlay2]# ll\n00bd7dcc4c91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cda0\n\u603b\u7528\u91cf 8\ndrwxr-xr-x 2 root root 6 4\u6708 26 13:15 diff\n-rw-r--r-- 1 root root 26 4\u6708 26 13:15 link\n-rw-r--r-- 1 root root 57 4\u6708 26 13:15 lower\ndrwxr-xr-x 1 root root 6 4\u6708 26 13:15 merged\ndrwx------ 3 root root 18 4\u6708 26 13:15 work\n")),(0,r.kt)("p",null,"\u542f\u52a8\u4e00\u4e2a\u5bb9\u5668\uff0c\u4e5f\u662f\u8f7d/var/lib/docker/overlay2 \u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u5c42\u5bb9\u5668\u5c42\uff0c\u76ee\u5f55\u5305\u62ec diff\uff0clink\uff0clower\uff0cmerged\uff0cwork\u3002"),(0,r.kt)("p",null,"diff \u8bb0\u5f55\u6bcf\u4e00\u5c42\u81ea\u5df1\u5185\u5bb9\u7684\u6570\u636e\uff1blink \u8bb0\u5f55\u8be5\u5c42\u94fe\u63a5\u76ee\u5f55\uff08\u5b9e\u9645\u662f l \u76ee\u5f55\u4e0b\u5230\u5c42\u7684\u94fe\u63a5\uff09\uff0c\u6bd4\u5982\u5728\u5bb9\u5668\u4e2d\u521b\u5efa\u76ee\u5f55\u6216\u5728 diff \u65b0\u589e\u8be5\u76ee\u5f55\uff1b\u521b\u5efa\u5bb9\u5668\u65f6\u5c06 lower-id \u6307\u5411\u7684\u955c\u50cf\u5c42\u76ee\u5f55\u4ee5\u53ca upper \u76ee\u5f55\u8054\u5408\u6302\u8f7d\u5230 merged \u76ee\u5f55\uff1bwork \u7528\u6765\u5b8c\u6210\u5982 copy-on_write \u7684\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u542f\u52a8\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u5728 docker host \u67e5\u770b mount \u60c5\u51b5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"[root@bogon overlay2]# mount | grep overlay\noverlay on\n/var/lib/docker/overlay2/00bd7dcc4c91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cd\na0/merged type overlay\n(rw,relatime,lowerdir=/var/lib/docker/overlay2/l/4GXMF7JGUPRUBLW5SM4X4FY5R2:/var/lib/do\ncker/overlay2/l/MBRXMBFE2MYZYMO5RZLRLTMRGJ,upperdir=/var/lib/docker/overlay2/00bd7dcc4c\n91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cda0/diff,workdir=/var/lib/docker/ove\nrlay2/00bd7dcc4c91f9a1a1257b8c0683fdd0b6dfe18af26597457e92b4d15c20cda0/work)\n")))}s.isMDXComponent=!0},152:(e,t,n)=>{n.d(t,{Z:()=>l});const l=n.p+"assets/images/dh-3bb2f0657176dca5ac8fc9cab144405b.JPG"},73865:(e,t,n)=>{n.d(t,{Z:()=>l});const l=n.p+"assets/images/overlay-025643f967db19b53060d68b096e5ade.JPG"},61644:(e,t,n)=>{n.d(t,{Z:()=>l});const l=n.p+"assets/images/wr-13d86120757d29ab09ca4232e80d0e61.JPG"}}]);