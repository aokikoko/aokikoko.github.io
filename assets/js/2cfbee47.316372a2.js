"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2256],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(67294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var p=r.createContext({}),l=function(e){var n=r.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,a=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=l(t),m=s,h=c["".concat(p,".").concat(m)]||c[m]||d[m]||a;return t?r.createElement(h,o(o({ref:n},u),{},{components:t})):r.createElement(h,o({ref:n},u))}));function m(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var a=t.length,o=new Array(a);o[0]=c;var i={};for(var p in n)hasOwnProperty.call(n,p)&&(i[p]=n[p]);i.originalType=e,i.mdxType="string"==typeof e?e:s,o[1]=i;for(var l=2;l<a;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},64649:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>p});var r=t(87462),s=(t(67294),t(3905));const a={title:"[TS] ts-axios(21) - \u5355\u5143\u6d4b\u8bd5(\u8bf7\u6c42\u6a21\u5757\u4e0eheaders\u6a21\u5757)",sidebar_position:29},o=void 0,i={unversionedId:"TypeScript/ts-axios-21",id:"TypeScript/ts-axios-21",title:"[TS] ts-axios(21) - \u5355\u5143\u6d4b\u8bd5(\u8bf7\u6c42\u6a21\u5757\u4e0eheaders\u6a21\u5757)",description:"----------------------------------------------------------------",source:"@site/docs/TypeScript/ts-axios-21.md",sourceDirName:"TypeScript",slug:"/TypeScript/ts-axios-21",permalink:"/docs/TypeScript/ts-axios-21",editUrl:"https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/TypeScript/ts-axios-21.md",tags:[],version:"current",sidebarPosition:29,frontMatter:{title:"[TS] ts-axios(21) - \u5355\u5143\u6d4b\u8bd5(\u8bf7\u6c42\u6a21\u5757\u4e0eheaders\u6a21\u5757)",sidebar_position:29},sidebar:"tutorialSidebar",previous:{title:"[TS] ts-axios(20) - \u5355\u5143\u6d4b\u8bd5(\u8f85\u52a9\u6a21\u5757)",permalink:"/docs/TypeScript/ts-axios-20"},next:{title:"[TS] ts-axios(22) - \u5355\u5143\u6d4b\u8bd5(Axios\u5b9e\u4f8b\u6a21\u5757\u4e0e\u62e6\u622a\u5668\u6a21\u5757)",permalink:"/docs/TypeScript/ts-axios-22"}},p=[{value:"\u8bf7\u6c42\u6a21\u5757",id:"\u8bf7\u6c42\u6a21\u5757",children:[{value:"jasmine-ajax",id:"jasmine-ajax",children:[],level:3},{value:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199",id:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199",children:[],level:3}],level:2},{value:"headers \u6a21\u5757\u5355\u5143\u6d4b\u8bd5",id:"headers-\u6a21\u5757\u5355\u5143\u6d4b\u8bd5",children:[{value:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199",id:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199-1",children:[],level:3}],level:2}],l={toc:p};function u(e){let{components:n,...t}=e;return(0,s.kt)("wrapper",(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"\u8bf7\u6c42\u6a21\u5757"},"\u8bf7\u6c42\u6a21\u5757"),(0,s.kt)("p",null,"\u8bf7\u6c42\u6a21\u5757\u662f axios \u6700\u57fa\u7840\u7684\u6a21\u5757\uff0c\u901a\u8fc7\u4e00\u4e2a axios \u65b9\u6cd5\u53d1\u9001 Ajax \u8bf7\u6c42\u3002"),(0,s.kt)("h3",{id:"jasmine-ajax"},"jasmine-ajax"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://jasmine.github.io/pages/getting_started.html"},"Jasmine")," \u662f\u4e00\u4e2a BDD(\u884c\u4e3a\u9a71\u52a8\u5f00\u53d1)\u7684\u6d4b\u8bd5\u6846\u67b6\uff0c\u5b83\u6709\u5f88\u591a\u6210\u719f\u7684\u63d2\u4ef6\uff0c\u6bd4\u5982\u6211\u4eec\u8981\u7528\u5230\u7684 ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/jasmine/jasmine-ajax"},(0,s.kt)("inlineCode",{parentName:"a"},"jasmine-ajax")),"\uff0c\u5b83\u4f1a\u4e3a\u6211\u4eec\u53d1\u51fa\u7684 Ajax \u8bf7\u6c42\u6839\u636e\u89c4\u8303\u5b9a\u4e49\u4e00\u7ec4\u5047\u7684\u54cd\u5e94\uff0c\u5e76\u8ddf\u8e2a\u6211\u4eec\u53d1\u51fa\u7684Ajax\u8bf7\u6c42\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u65b9\u4fbf\u7684\u4e3a\u7ed3\u679c\u505a\u65ad\u8a00\u3002"),(0,s.kt)("p",null,"\u5176\u5b9e Jest \u4e5f\u53ef\u4ee5\u53bb\u5199\u63d2\u4ef6\uff0c\u4f46\u5e76\u6ca1\u6709\u73b0\u6210\u7684 Ajax \u76f8\u5173\u7684 Jest \u63d2\u4ef6\uff0c\u4f46\u662f Jest \u6d4b\u8bd5\u4e2d\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528 Jasmine \u76f8\u5173\u7684\u63d2\u4ef6\uff0c\u53ea\u9700\u8981\u505a\u4e00\u4e9b\u5c0f\u5c0f\u7684\u914d\u7f6e\u5373\u53ef\u3002"),(0,s.kt)("p",null,"\u5f53\u7136\uff0c\u672a\u6765\u6211\u4e5f\u4f1a\u8003\u8651\u53bb\u7f16\u5199\u4e00\u4e2a Ajax \u76f8\u5173\u7684 Jest \u63d2\u4ef6\uff0c\u76ee\u524d\u6211\u4eec\u4ecd\u7136\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax")," \u53bb\u914d\u5408\u6211\u4eec\u7f16\u5199\u6d4b\u8bd5\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax")," \u4f9d\u8d56 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-core"),"\uff0c\u56e0\u6b64\u9996\u5148\u6211\u4eec\u8981\u5b89\u88c5\u51e0\u4e2a\u4f9d\u8d56\u5305\uff0c",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-core")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"@types/jasmine-ajax"),"\u3002"),(0,s.kt)("p",null,"\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u9700\u8981\u53bb\u4fee\u6539 ",(0,s.kt)("inlineCode",{parentName:"p"},"test/boot.ts")," \u6587\u4ef6\uff0c\u56e0\u4e3a\u6bcf\u6b21\u8dd1\u5177\u4f53\u6d4b\u8bd5\u4ee3\u7801\u4e4b\u524d\u4f1a\u5148\u8fd0\u884c\u8be5\u6587\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u53bb\u521d\u59cb\u5316 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const JasmineCore = require('jasmine-core')\n// @ts-ignore\nglobal.getJasmineRequireObj = function() {\n  return JasmineCore\n}\nrequire('jasmine-ajax')\n")),(0,s.kt)("p",null,"\u8fd9\u91cc\u4e3a\u4e86\u8ba9 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax")," \u63d2\u4ef6\u8fd0\u884c\u6210\u529f\uff0c\u6211\u4eec\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u5168\u5c40\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"getJasmineRequireObj")," \u65b9\u6cd5\uff0c\u53c2\u8003 ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/jasmine/jasmine-ajax/issues/178"},"issue"),"\u3002"),(0,s.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u5f00\u59cb\u7f16\u5199\u8bf7\u6c42\u6a21\u5757\u7684\u5355\u5143\u6d4b\u8bd5\u3002"),(0,s.kt)("h3",{id:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199"},"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"test/requests.spec.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import axios, { AxiosResponse, AxiosError } from '../src/index'\nimport { getAjaxRequest } from './helper'\n\ndescribe('requests', () => {\n  beforeEach(() => {\n    jasmine.Ajax.install()\n  })\n\n  afterEach(() => {\n    jasmine.Ajax.uninstall()\n  })\n\n  test('should treat single string arg as url', () => {\n    axios('/foo')\n\n    return getAjaxRequest().then(request => {\n      expect(request.url).toBe('/foo')\n      expect(request.method).toBe('GET')\n    })\n  })\n\n  test('should treat method value as lowercase string', done => {\n    axios({\n      url: '/foo',\n      method: 'POST'\n    }).then(response => {\n      expect(response.config.method).toBe('post')\n      done()\n    })\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 200\n      })\n    })\n  })\n\n  test('should reject on network errors', done => {\n    const resolveSpy = jest.fn((res: AxiosResponse) => {\n      return res\n    })\n\n    const rejectSpy = jest.fn((e: AxiosError) => {\n      return e\n    })\n\n    jasmine.Ajax.uninstall()\n\n    axios('/foo')\n      .then(resolveSpy)\n      .catch(rejectSpy)\n      .then(next)\n\n    function next(reason: AxiosResponse | AxiosError) {\n      expect(resolveSpy).not.toHaveBeenCalled()\n      expect(rejectSpy).toHaveBeenCalled()\n      expect(reason instanceof Error).toBeTruthy()\n      expect((reason as AxiosError).message).toBe('Network Error')\n      expect(reason.request).toEqual(expect.any(XMLHttpRequest))\n\n      jasmine.Ajax.install()\n\n      done()\n    }\n  })\n\n  test('should reject when request timeout', done => {\n    let err: AxiosError\n\n    axios('/foo', {\n      timeout: 2000,\n      method: 'post'\n    }).catch(error => {\n      err = error\n    })\n\n    getAjaxRequest().then(request => {\n      // @ts-ignore\n      request.eventBus.trigger('timeout')\n\n      setTimeout(() => {\n        expect(err instanceof Error).toBeTruthy()\n        expect(err.message).toBe('Timeout of 2000 ms exceeded')\n        done()\n      }, 100)\n    })\n  })\n\n  test('should reject when validateStatus returns false', done => {\n    const resolveSpy = jest.fn((res: AxiosResponse) => {\n      return res\n    })\n\n    const rejectSpy = jest.fn((e: AxiosError) => {\n      return e\n    })\n\n    axios('/foo', {\n      validateStatus(status) {\n        return status !== 500\n      }\n    })\n      .then(resolveSpy)\n      .catch(rejectSpy)\n      .then(next)\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 500\n      })\n    })\n\n    function next(reason: AxiosError | AxiosResponse) {\n      expect(resolveSpy).not.toHaveBeenCalled()\n      expect(rejectSpy).toHaveBeenCalled()\n      expect(reason instanceof Error).toBeTruthy()\n      expect((reason as AxiosError).message).toBe('Request failed with status code 500')\n      expect((reason as AxiosError).response!.status).toBe(500)\n\n      done()\n    }\n  })\n\n  test('should resolve when validateStatus returns true', done => {\n    const resolveSpy = jest.fn((res: AxiosResponse) => {\n      return res\n    })\n\n    const rejectSpy = jest.fn((e: AxiosError) => {\n      return e\n    })\n\n    axios('/foo', {\n      validateStatus(status) {\n        return status === 500\n      }\n    })\n      .then(resolveSpy)\n      .catch(rejectSpy)\n      .then(next)\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 500\n      })\n    })\n\n    function next(res: AxiosResponse | AxiosError) {\n      expect(resolveSpy).toHaveBeenCalled()\n      expect(rejectSpy).not.toHaveBeenCalled()\n      expect(res.config.url).toBe('/foo')\n\n      done()\n    }\n  })\n\n  test('should return JSON when resolved', done => {\n    let response: AxiosResponse\n\n    axios('/api/account/signup', {\n      auth: {\n        username: '',\n        password: ''\n      },\n      method: 'post',\n      headers: {\n        Accept: 'application/json'\n      }\n    }).then(res => {\n      response = res\n    })\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 200,\n        statusText: 'OK',\n        responseText: '{\"a\": 1}'\n      })\n\n      setTimeout(() => {\n        expect(response.data).toEqual({ a: 1 })\n        done()\n      }, 100)\n    })\n  })\n\n  test('should return JSON when rejecting', done => {\n    let response: AxiosResponse\n\n    axios('/api/account/signup', {\n      auth: {\n        username: '',\n        password: ''\n      },\n      method: 'post',\n      headers: {\n        Accept: 'application/json'\n      }\n    }).catch(error => {\n      response = error.response\n    })\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 400,\n        statusText: 'Bad Request',\n        responseText: '{\"error\": \"BAD USERNAME\", \"code\": 1}'\n      })\n\n      setTimeout(() => {\n        expect(typeof response.data).toBe('object')\n        expect(response.data.error).toBe('BAD USERNAME')\n        expect(response.data.code).toBe(1)\n        done()\n      }, 100)\n    })\n  })\n\n  test('should supply correct response', done => {\n    let response: AxiosResponse\n\n    axios.post('/foo').then(res => {\n      response = res\n    })\n\n    getAjaxRequest().then(request => {\n      request.respondWith({\n        status: 200,\n        statusText: 'OK',\n        responseText: '{\"foo\": \"bar\"}',\n        responseHeaders: {\n          'Content-Type': 'application/json'\n        }\n      })\n\n      setTimeout(() => {\n        expect(response.data.foo).toBe('bar')\n        expect(response.status).toBe(200)\n        expect(response.statusText).toBe('OK')\n        expect(response.headers['content-type']).toBe('application/json')\n        done()\n      }, 100)\n    })\n  })\n\n  test('should allow overriding Content-Type header case-insensitive', () => {\n    let response: AxiosResponse\n\n    axios\n      .post(\n        '/foo',\n        { prop: 'value' },\n        {\n          headers: {\n            'content-type': 'application/json'\n          }\n        }\n      )\n      .then(res => {\n        response = res\n      })\n\n    return getAjaxRequest().then(request => {\n      expect(request.requestHeaders['Content-Type']).toBe('application/json')\n    })\n  })\n})\n")),(0,s.kt)("p",null,"\u6211\u4eec\u8981\u6ce8\u610f\u7684\u4e00\u4e9b\u70b9\uff0c\u5728\u8fd9\u91cc\u5217\u51fa\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"beforeEach & afterEach")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/en/api#beforeeachfn-timeout"},"beforeEach"),"\u8868\u793a\u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u8fd0\u884c\u524d\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u6267\u884c ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.Ajax.install()")," \u5b89\u88c5 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.Ajax"),"\u3002"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/en/api#aftereachfn-timeout"},"afterEach"),"\u8868\u793a\u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u8fd0\u884c\u540e\u7684\u94a9\u5b50\u51fd\u6570\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u6267\u884c ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.Ajax.uninstall()")," \u5378\u8f7d ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.Ajax"),"\u3002"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"getAjaxRequest"))),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"getAjaxRequest")," \u662f\u6211\u4eec\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"test/helper.ts")," \u5b9a\u4e49\u7684\u4e00\u4e2a\u8f85\u52a9\u65b9\u6cd5\uff0c\u901a\u8fc7 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.Ajax.requests.mostRecent()")," \u62ff\u5230\u6700\u8fd1\u4e00\u6b21\u8bf7\u6c42\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"request")," \u5bf9\u8c61\uff0c\u8fd9\u4e2a ",(0,s.kt)("inlineCode",{parentName:"p"},"request")," \u5bf9\u8c61\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine-ajax")," \u5e93\u4f2a\u9020\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"xhr")," \u5bf9\u8c61\uff0c\u5b83\u6a21\u62df\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"xhr")," \u5bf9\u8c61\u4e0a\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e00\u4e9b ",(0,s.kt)("inlineCode",{parentName:"p"},"api")," \u8ba9\u6211\u4eec\u4f7f\u7528\uff0c\u6bd4\u5982 ",(0,s.kt)("inlineCode",{parentName:"p"},"request.respondWith")," \u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\u3002"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u5f02\u6b65\u6d4b\u8bd5")),(0,s.kt)("p",null,"\u6ce8\u610f\u5230\u6211\u4eec\u8fd9\u91cc\u5927\u90e8\u5206\u7684\u6d4b\u8bd5\u7528\u4f8b\u4e0d\u518d\u662f\u540c\u6b65\u7684\u4ee3\u7801\u4e86\uff0c\u51e0\u4e4e\u90fd\u662f\u4e00\u4e9b\u5f02\u6b65\u903b\u8f91\uff0cJest \u975e\u5e38\u597d\u5730\u652f\u6301",(0,s.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/en/asynchronous"},"\u5f02\u6b65\u6d4b\u8bd5\u4ee3\u7801"),"\u3002\u901a\u5e38\u6709 2 \u79cd\u89e3\u51b3\u65b9\u6848\u3002"),(0,s.kt)("p",null,"\u7b2c\u4e00\u79cd\u662f\u5229\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"done")," \u53c2\u6570\uff0c\u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u51fd\u6570\u6709\u4e00\u4e2a ",(0,s.kt)("inlineCode",{parentName:"p"},"done")," \u53c2\u6570\uff0c\u4e00\u65e6\u6211\u4eec\u4f7f\u7528\u4e86\u8be5\u53c2\u6570\uff0c\u53ea\u6709\u5f53 ",(0,s.kt)("inlineCode",{parentName:"p"},"done")," \u51fd\u6570\u6267\u884c\u7684\u65f6\u5019\u8868\u793a\u8fd9\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u7ed3\u675f\u3002"),(0,s.kt)("p",null,"\u7b2c\u4e8c\u79cd\u662f\u6211\u4eec\u7684\u6d4b\u8bd5\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a Promise \u5bf9\u8c61\uff0c\u4e00\u65e6\u8fd9\u4e2a Promise \u5bf9\u8c61 ",(0,s.kt)("inlineCode",{parentName:"p"},"resolve")," \u4e86\uff0c\u8868\u793a\u8fd9\u4e2a\u6d4b\u8bd5\u7ed3\u675f\u3002"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"expect.any(constructor)")),(0,s.kt)("p",null,"\u5b83\u8868\u793a\u5339\u914d\u4efb\u610f\u7531 ",(0,s.kt)("inlineCode",{parentName:"p"},"constructor")," \u521b\u5efa\u7684\u5bf9\u8c61\u5b9e\u4f8b\u3002"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"request.eventBus.trigger"))),(0,s.kt)("p",null,"\u7531\u4e8e ",(0,s.kt)("inlineCode",{parentName:"p"},"request.responseTimeout")," \u65b9\u6cd5\u5185\u90e8\u4f9d\u8d56\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"jasmine.clock")," \u65b9\u6cd5\u4f1a\u5bfc\u81f4\u8fd0\u884c\u5931\u8d25\uff0c\u8fd9\u91cc\u6211\u76f4\u63a5\u7528\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"request.eventBus.trigger('timeout')")," \u65b9\u6cd5\u89e6\u53d1\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"timeout")," \u4e8b\u4ef6\u3002\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u5728\u63a5\u53e3\u5b9a\u4e49\u4e2d\uff0c\u6240\u4ee5\u9700\u8981\u52a0 ",(0,s.kt)("inlineCode",{parentName:"p"},"// @ts-ignore"),"\u3002"),(0,s.kt)("p",null,"\u53e6\u5916\uff0c\u6211\u4eec\u5728\u6d4b\u8bd5\u4e2d\u53d1\u73b0 2 \u4e2a case \u6ca1\u6709\u901a\u8fc7\u3002"),(0,s.kt)("p",null,"\u7b2c\u4e00\u4e2a\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"should treat method value as lowercase string"),"\uff0c\u8fd9\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u662f\u6211\u4eec\u53d1\u9001\u8bf7\u6c42\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"}," method")," \u9700\u8981\u8f6c\u6362\u6210\u5c0f\u5199\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u4e5f\u662f\u4e3a\u4e86\u4e4b\u540e ",(0,s.kt)("inlineCode",{parentName:"p"},"flattenHeaders")," \u80fd\u6b63\u5e38\u5904\u7406\u8fd9\u4e9b ",(0,s.kt)("inlineCode",{parentName:"p"},"method"),"\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4fee\u6539\u6e90\u7801\u903b\u8f91\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"core/Axios.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"  request(url: any, config?: any): AxiosPromise {\n    if (typeof url === 'string') {\n      if (!config) {\n        config = {}\n      }\n      config.url = url\n    } else {\n      config = url\n    }\n\n    config = mergeConfig(this.defaults, config)\n    config.method = config.method.toLowerCase()\n    \n    // ...\n  }\n")),(0,s.kt)("p",null,"\u5728\u5408\u5e76\u914d\u7f6e\u540e\uff0c\u6211\u4eec\u9700\u8981\u628a ",(0,s.kt)("inlineCode",{parentName:"p"},"config.method")," \u8f6c\u6210\u5c0f\u5199\u5b57\u7b26\u4e32\u3002"),(0,s.kt)("p",null,"\u53e6\u4e00\u4e2a\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"should return JSON when rejecting"),"\uff0c\u8fd9\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u662f\u5f53\u6211\u4eec\u53d1\u9001\u8bf7\u6c42\u5931\u8d25\u540e\uff0c\u4e5f\u80fd\u628a\u54cd\u5e94\u6570\u636e\u8f6c\u6362\u6210 JSON \u683c\u5f0f\uff0c\u6240\u4ee5\u4e5f\u9700\u8981\u4fee\u6539\u6e90\u7801\u903b\u8f91\u3002"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"core/dispatchRequest.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"export default function dispatchRequest(config: AxiosRequestConfig): AxiosPromise {\n  throwIfCancellationRequested(config)\n  processConfig(config)\n  return xhr(config).then(\n    res => {\n      return transformResponseData(res)\n    },\n    e => {\n      if (e && e.response) {\n        e.response = transformResponseData(e.response)\n      }\n      return Promise.reject(e)\n    }\n  )\n}\n")),(0,s.kt)("p",null,"\u9664\u4e86\u5bf9\u6b63\u5e38\u60c5\u51b5\u7684\u54cd\u5e94\u6570\u636e\u505a\u8f6c\u6362\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5bf9\u5f02\u5e38\u60c5\u51b5\u7684\u54cd\u5e94\u6570\u636e\u505a\u8f6c\u6362\u3002"),(0,s.kt)("p",null,"\u81f3\u6b64\u6211\u4eec\u5b8c\u6210\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"ts-axios")," \u5e93\u5bf9\u8bf7\u6c42\u6a21\u5757\u7684\u6d4b\u8bd5\uff0c\u4e0b\u4e00\u8282\u8bfe\u6211\u4eec\u4f1a\u4ece\u4e1a\u52a1\u7684\u89d2\u5ea6\u6765\u6d4b\u8bd5 ",(0,s.kt)("inlineCode",{parentName:"p"},"headers")," \u6a21\u5757\u3002"),(0,s.kt)("hr",null),(0,s.kt)("h2",{id:"headers-\u6a21\u5757\u5355\u5143\u6d4b\u8bd5"},"headers \u6a21\u5757\u5355\u5143\u6d4b\u8bd5"),(0,s.kt)("p",null,"\u4e4b\u524d\u6211\u4eec\u6d4b\u8bd5\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"headers")," \u7684\u57fa\u7840\u65b9\u6cd5\u6a21\u5757\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4f1a\u4ece\u4e1a\u52a1\u89d2\u5ea6\u6d4b\u8bd5 ",(0,s.kt)("inlineCode",{parentName:"p"},"headers")," \u7684\u76f8\u5173\u4e1a\u52a1\u903b\u8f91\u3002"),(0,s.kt)("h3",{id:"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199-1"},"\u6d4b\u8bd5\u4ee3\u7801\u7f16\u5199"),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"test/headers.spec.ts"),"\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import axios from '../src/index'\nimport { getAjaxRequest } from './helper'\n\nfunction testHeaderValue(headers: any, key: string, val?: string): void {\n  let found = false\n\n  for (let k in headers) {\n    if (k.toLowerCase() === key.toLowerCase()) {\n      found = true\n      expect(headers[k]).toBe(val)\n      break\n    }\n  }\n\n  if (!found) {\n    if (typeof val === 'undefined') {\n      expect(headers.hasOwnProperty(key)).toBeFalsy()\n    } else {\n      throw new Error(key + ' was not found in headers')\n    }\n  }\n}\n\ndescribe('headers', () => {\n  beforeEach(() => {\n    jasmine.Ajax.install()\n  })\n\n  afterEach(() => {\n    jasmine.Ajax.uninstall()\n  })\n\n  test('should use default common headers', () => {\n    const headers = axios.defaults.headers.common\n\n    axios('/foo')\n\n    return getAjaxRequest().then(request => {\n      for (let key in headers) {\n        if (headers.hasOwnProperty(key)) {\n          expect(request.requestHeaders[key]).toEqual(headers[key])\n        }\n      }\n    })\n  })\n\n  test('should add extra headers for post', () => {\n    axios.post('/foo', 'fizz=buzz')\n\n    return getAjaxRequest().then(request => {\n      testHeaderValue(request.requestHeaders, 'Content-Type', 'application/x-www-form-urlencoded')\n    })\n  })\n\n  test('should use application/json when posting an object', () => {\n    axios.post('/foo/bar', {\n      firstName: 'foo',\n      lastName: 'bar'\n    })\n\n    return getAjaxRequest().then(request => {\n      testHeaderValue(request.requestHeaders, 'Content-Type', 'application/json;charset=utf-8')\n    })\n  })\n\n  test('should remove content-type if data is empty', () => {\n    axios.post('/foo')\n\n    return getAjaxRequest().then(request => {\n      testHeaderValue(request.requestHeaders, 'Content-Type', undefined)\n    })\n  })\n\n  it('should preserve content-type if data is false', () => {\n    axios.post('/foo', false)\n\n    return getAjaxRequest().then(request => {\n      testHeaderValue(request.requestHeaders, 'Content-Type', 'application/x-www-form-urlencoded')\n    })\n  })\n\n  test('should remove content-type if data is FormData', () => {\n    const data = new FormData()\n    data.append('foo', 'bar')\n\n    axios.post('/foo', data)\n\n    return getAjaxRequest().then(request => {\n      testHeaderValue(request.requestHeaders, 'Content-Type', undefined)\n    })\n  })\n})\n")),(0,s.kt)("p",null,"\u5185\u90e8\u5b9a\u4e49\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"testHeaderValue")," \u8f85\u52a9\u51fd\u6570\uff0c\u7528\u4e8e\u6d4b\u8bd5 ",(0,s.kt)("inlineCode",{parentName:"p"},"headers")," \u662f\u5426\u5b58\u5728\u67d0\u4e2a ",(0,s.kt)("inlineCode",{parentName:"p"},"header name")," \u4e0b\u7684\u67d0\u4e2a\u503c\u3002"),(0,s.kt)("p",null,"\u81f3\u6b64\u6211\u4eec\u5b8c\u6210\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"ts-axios")," \u5e93 ",(0,s.kt)("inlineCode",{parentName:"p"},"headers")," \u6a21\u5757\u76f8\u5173\u4e1a\u52a1\u903b\u8f91\u7684\u6d4b\u8bd5\uff0c\u4e0b\u4e00\u8282\u8bfe\u6211\u4eec\u4f1a\u5bf9 ",(0,s.kt)("inlineCode",{parentName:"p"},"Axios")," \u7684\u5b9e\u4f8b\u505a\u6d4b\u8bd5\u3002"))}u.isMDXComponent=!0}}]);