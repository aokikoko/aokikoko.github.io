<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Aoki çš„è‡ªç•™åœ° RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Aoki çš„è‡ªç•™åœ° Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Aoki çš„è‡ªç•™åœ°" href="/opensearch.xml"><title data-react-helmet="true">[Nginx] ä¼ä¸šæ¶æ„åŒç‚¹æœåŠ¡å™¨HA-é«˜å¯ç”¨ | Aoki çš„è‡ªç•™åœ°</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://phero.live/docs/Nginx/ha"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="[Nginx] ä¼ä¸šæ¶æ„åŒç‚¹æœåŠ¡å™¨HA-é«˜å¯ç”¨ | Aoki çš„è‡ªç•™åœ°"><meta data-react-helmet="true" name="description" content="èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡"><meta data-react-helmet="true" property="og:description" content="èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://phero.live/docs/Nginx/ha"><link data-react-helmet="true" rel="alternate" href="https://phero.live/docs/Nginx/ha" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://phero.live/docs/Nginx/ha" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BMRZNSN9O0-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.23909136.css">
<link rel="preload" href="/assets/js/runtime~main.c2d35455.js" as="script">
<link rel="preload" href="/assets/js/main.dd54a102.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Aoki</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">ç¬”è®°</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aokikoko" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ğŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ğŸŒ</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">æˆ‘çš„çŸ¥è¯†åº“ ğŸ˜€</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/CSS/transition-animation-transform">CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/DocusaurusTips/code-theme">Docusaurusä½¿ç”¨æŠ€å·§</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/TypeScript/basic-types">TypeScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Another/bigo">ç®—æ³•å°é¢˜ç›®</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/architecture/history">æ¶æ„</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Cli/ESLint">Cli</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/DevOps/prometheus">DevOps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Http/OptionsRequest">Http</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Java/basic">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Linux/basic">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Mysql/case">Mysql</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/Nginx/sign">Nginx</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/sign">[Nginx] ä¿¡å·å‚æ•°åŠé…ç½®æ–‡ä»¶ä»‹ç»</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/server">[Nginx] ä¼ä¸šçº§å¸¸è§é…ç½®</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/gzip">[Nginx] å®ç°gzipå‹ç¼©ä¸æ—¥å¿—æŸ¥çœ‹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/location">[Nginx] URLåŒ¹é…ä¹‹location</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/return">[Nginx] URLé‡å†™</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/safe">[Nginx] å®‰å…¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Nginx/ha">[Nginx] ä¼ä¸šæ¶æ„åŒç‚¹æœåŠ¡å™¨HA-é«˜å¯ç”¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/lb">[Nginx] ä¼ä¸šæ¶æ„é«˜å¯ç”¨è´Ÿè½½å‡è¡¡LBæœåŠ¡å™¨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Nginx/lvs">[Nginx] ä¼ä¸šæ¶æ„LB-è´Ÿè½½å‡è¡¡ä¹‹LVSå®ç°</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Node.js/buffer">Node.js</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/React/jsx">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/interview/http">interview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/javascript/ecma">javascript</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>[Nginx] ä¼ä¸šæ¶æ„åŒç‚¹æœåŠ¡å™¨HA-é«˜å¯ç”¨</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡">èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡<a class="hash-link" href="#èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ä¸šåŠ¡èƒŒæ™¯æè¿°">1ã€ä¸šåŠ¡èƒŒæ™¯æè¿°<a class="hash-link" href="#1ä¸šåŠ¡èƒŒæ™¯æè¿°" title="Direct link to heading">â€‹</a></h3><p>â€‹ éšç€ç”¨æˆ·é‡å¢å¤šï¼Œå•å° WEB æœåŠ¡å™¨ï¼Œå‹åŠ›è¶Šæ¥è¶Šå¤§ã€‚è™½ç„¶å•å° WEB æœåŠ¡å™¨ï¼Œç›®å‰å¯ä»¥å®Œæˆå·¥ä½œä»»åŠ¡ã€‚ä½†æ˜¯å¦‚æœä¸€æ—¦å®•æœºï¼Œç”¨æˆ·å°±å®Œå…¨å¤±å»æœåŠ¡äº†ï¼Œç”¨æˆ·ä½“éªŒç‰¹åˆ«ä¸å¥½ã€‚éœ€è¦å¤‡ç”¨ä¸€å°æœåŠ¡å™¨è¿›è¡Œä½¿ç”¨ï¼Œä¸»æœåŠ¡å™¨å®•æœºä¹‹åï¼Œå¿«é€Ÿåˆ‡æ¢ä¸ºå¤‡ç”¨æœåŠ¡å™¨</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2æ¨¡æ‹Ÿè¿ç»´è®¾è®¡æ–¹æ¡ˆ">2ã€æ¨¡æ‹Ÿè¿ç»´è®¾è®¡æ–¹æ¡ˆ<a class="hash-link" href="#2æ¨¡æ‹Ÿè¿ç»´è®¾è®¡æ–¹æ¡ˆ" title="Direct link to heading">â€‹</a></h3><p>åœ¨ä¹‹å‰æ¶æ„ä¸­ï¼Œå…ˆå°†æ•°æ®åº“æœåŠ¡å™¨å•ç‹¬è¿ç§»</p><p><img alt="ha1" src="/assets/images/ha1-36de72211be3bd7550a8e88e7a1bb579.jpg"></p><p>é’ˆå¯¹ web æœåŠ¡å™¨å•ç‚¹æ•…éšœï¼Œå‡çº§ä¸ºä¸»å¤‡æœåŠ¡å™¨æ¶æ„</p><p><img alt="ha2" src="/assets/images/ha2-45fd75f790d30e5525bca70cb0bc5f25.jpg"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="æ•°æ®åº“æœåŠ¡å™¨è¿ç§»">æ•°æ®åº“æœåŠ¡å™¨è¿ç§»<a class="hash-link" href="#æ•°æ®åº“æœåŠ¡å™¨è¿ç§»" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1æœåŠ¡å™¨-ip">1ã€æœåŠ¡å™¨ ip<a class="hash-link" href="#1æœåŠ¡å™¨-ip" title="Direct link to heading">â€‹</a></h3><blockquote><p>server01 WEB æœåŠ¡å™¨ master 192.168.17.102</p><p>server02 æ•°æ®åº“æœåŠ¡å™¨ 192.168.17.100</p><p>server03 WEB æœåŠ¡å™¨ backup 192.168.17.101</p></blockquote><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2æœåŠ¡å™¨åŸºæœ¬é…ç½®">2ã€æœåŠ¡å™¨åŸºæœ¬é…ç½®<a class="hash-link" href="#2æœåŠ¡å™¨åŸºæœ¬é…ç½®" title="Direct link to heading">â€‹</a></h3><p>æ ¹æ®ä¹‹å‰çš„æœåŠ¡å™¨åŸºæœ¬ç¯å¢ƒçš„è¦æ±‚è¿›è¡Œé…ç½®</p><p>å› ä¸ºæ˜¯å…‹éš†è·å–è™šæ‹Ÿæœºï¼Œæ‰€ä»¥åªéœ€è¦è¿›è¡Œ IP å’Œ MAC åœ°å€çš„ä¿®æ”¹å³å¯ã€‚</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#1ã€åˆ é™¤åŸæœ‰ç½‘å¡macåœ°å€è®°å½•ä¿¡æ¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> /etc/udev/rules.d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rm</span><span class="token plain"> -rf </span><span class="token number">70</span><span class="token plain">-persistent-net.rules</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#2ã€åˆ é™¤eth0é‡Œçš„macåœ°å€é¡¹ HWADDRå‚æ•°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#3ã€ä¿®æ”¹ä¸»æœºåç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;s/server01/server02/&quot;</span><span class="token plain"> /etc/sysconfig/network</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#4ã€å¯åŠ¨ä¹‹åï¼ŒæŠŠhostsæ–‡ä»¶å¯¹åº”ä¹Ÿåšè§£æ</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3æ•°æ®å¤‡ä»½å’Œè¿ç§»">3ã€æ•°æ®å¤‡ä»½å’Œè¿ç§»<a class="hash-link" href="#3æ•°æ®å¤‡ä»½å’Œè¿ç§»" title="Direct link to heading">â€‹</a></h3><p><strong>â‘  æºæ•°æ®åº“æœåŠ¡å™¨å¯¼å‡ºæ•°æ®</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#æºæ•°æ®åº“æ˜¯server01 åœ¨server01ä¸Šæ“ä½œ</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> mysqldump -uroot -p --database tp5shop </span><span class="token operator">&gt;</span><span class="token plain"> /root/tp5shop.sql</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¡ å¯¼å…¥æ•°æ®åˆ°æ–°æ•°æ®åº“æœåŠ¡å™¨</strong></p><div class="codeBlockContainer_J+bg language-mysql theme-code-block"><div class="codeBlockContent_csEI mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#å› ä¸ºæ•°æ®åº“æœåŠ¡å™¨å…‹éš†æ¥çš„ï¼Œæ‰€æœ‰æœ¬èº«å…·æœ‰æ•°æ® å¯ä»¥åˆ é™¤äº†åº“ï¼Œæ¨¡æ‹Ÿæ–°æœºå™¨ï¼Œé‡æ–°å¯¼å…¥</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql &gt; drop database tp5shop;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#åˆ›å»ºæ•°æ®åº“å¹¶å¯¼å…¥æ•°æ®</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql &gt; create database tp5shop;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql &gt; use tp5shop;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql &gt; source /root/tp5shop.sql;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¢ åœ¨ server02 MySQL æœåŠ¡å™¨ä¸­å»ºç«‹è¿œç¨‹è¿æ¥ç”¨æˆ·å¹¶æˆäºˆæƒé™</strong></p><div class="codeBlockContainer_J+bg language-mysql theme-code-block"><div class="codeBlockContent_csEI mysql"><pre tabindex="0" class="prism-code language-mysql codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql &gt; grant all on tp5shop.* to &#x27;tp5shop&#x27;@&#x27;192.168.17.%&#x27; identified by &#x27;$Abc3721&#x27;;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘£ ä¿®æ”¹é¡¹ç›®æ•°æ®åº“é…ç½®æ–‡ä»¶</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">vim</span><span class="token plain"> /usr/local/nginx/html/tp5shop/application/database.php</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¿®æ”¹å‚è€ƒç¤ºä¾‹ï¼š</p><div class="codeBlockContainer_J+bg language-php theme-code-block"><div class="codeBlockContent_csEI php"><pre tabindex="0" class="prism-code language-php codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">return [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // æ•°æ®åº“ç±»å‹</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;type&#x27;            =&gt; &#x27;mysql&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // æœåŠ¡å™¨åœ°å€</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;hostname&#x27;        =&gt; &#x27;192.168.17.100&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // æ•°æ®åº“å</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;database&#x27;        =&gt; &#x27;tp5shop&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ç”¨æˆ·å</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;username&#x27;        =&gt; &#x27;tp5shop&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // å¯†ç </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;password&#x27;        =&gt; &#x27;$Abc3721&#x27;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // ç«¯å£</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &#x27;hostport&#x27;        =&gt; &#x27;3306&#x27;,</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¤ è®¿é—®é¡µé¢ï¼ŒæŸ¥çœ‹ä¸šåŠ¡ä½¿ç”¨æƒ…å†µ</strong></p><hr><h2 class="anchor anchorWithStickyNavbar_y2LR" id="é«˜å¯ç”¨æœåŠ¡æ­å»º">é«˜å¯ç”¨æœåŠ¡æ­å»º<a class="hash-link" href="#é«˜å¯ç”¨æœåŠ¡æ­å»º" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1ha-é«˜å¯ç”¨">1ã€HA é«˜å¯ç”¨<a class="hash-link" href="#1ha-é«˜å¯ç”¨" title="Direct link to heading">â€‹</a></h3><p>â€‹ é«˜å¯ç”¨ HAï¼ˆHigh Availabilityï¼‰æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œå®ƒé€šå¸¸æ˜¯æŒ‡é€šè¿‡è®¾è®¡ï¼Œå‡å°‘ç³»ç»ŸæœåŠ¡ä¸å¯ç”¨çš„æ—¶é—´ã€‚å‡è®¾ç³»ç»Ÿä¸€ç›´èƒ½å¤Ÿæä¾›æœåŠ¡ï¼Œæˆ‘ä»¬è¯´ç³»ç»Ÿçš„å¯ç”¨æ€§æ˜¯ 100%ã€‚å¦‚æœç³»ç»Ÿæ¯è¿è¡Œ 100 ä¸ªæ—¶é—´å•ä½ï¼Œä¼šæœ‰ 1 ä¸ªæ—¶é—´å•ä½æ— æ³•æä¾›æœåŠ¡ï¼Œæˆ‘ä»¬è¯´ç³»ç»Ÿçš„å¯ç”¨æ€§æ˜¯ 99%ã€‚==å¾ˆå¤šå…¬å¸çš„é«˜å¯ç”¨ç›®æ ‡æ˜¯ 4 ä¸ª 9ï¼Œä¹Ÿå°±æ˜¯ 99.99%ï¼Œè¿™å°±æ„å‘³ç€ï¼Œç³»ç»Ÿçš„å¹´åœæœºæ—¶é—´ä¸º 0.876 ä¸ªå°æ—¶==ã€‚</p><table><thead><tr><th><strong>æè¿°</strong></th><th><strong>é€šä¿—å«æ³•</strong></th><th><strong>å¯ç”¨æ€§çº§åˆ«</strong></th><th><strong>å¹´åº¦åœæœºæ—¶é—´</strong></th></tr></thead><tbody><tr><td>åŸºæœ¬å¯ç”¨æ€§</td><td>2 ä¸ª 9</td><td>99%</td><td>87.6 å°æ—¶</td></tr><tr><td>è¾ƒé«˜å¯ç”¨æ€§</td><td>3 ä¸ª 9</td><td>99.9%</td><td>8.8 å°æ—¶</td></tr><tr><td><strong>å…·æœ‰æ•…éšœè‡ªåŠ¨æ¢å¤èƒ½åŠ›çš„å¯ç”¨æ€§</strong></td><td><strong>4 ä¸ª 9</strong></td><td><strong>99.99%</strong></td><td><strong>53 åˆ†é’Ÿ</strong></td></tr><tr><td>æé«˜å¯ç”¨æ€§</td><td>5 ä¸ª 9</td><td>99.999%</td><td>5 åˆ†é’Ÿ</td></tr></tbody></table><blockquote><p><strong>å®ç°é«˜å¯ç”¨çš„æ ¸å¿ƒç‚¹ï¼š</strong></p><p>â‘  å†—ä½™ï¼ˆå¤šå°æœåŠ¡å™¨ï¼‰</p><p>â‘¡ è‡ªåŠ¨åˆ‡æ¢</p></blockquote><p>å¤‡ä»½æœåŠ¡å™¨ï¼š</p><p>å†·å¤‡ æœåŠ¡å™¨ä¸å¯ç”¨ï¼ˆåŸŸåä¸è§£æï¼‰ï¼Œä½¿ç”¨çš„æ—¶å€™å†å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡æ¢</p><p>çƒ­å¤‡ æœåŠ¡å™¨åœ¨ç­‰å¾…çŠ¶æ€ï¼ˆç›‘æ§ä¸»æœåŠ¡å™¨çŠ¶æ€ï¼‰ï¼Œä¸€æ—¦ä¸»å®•æœºï¼Œå¤‡å°±æ¥ç®¡ï¼Œè‡ªåŠ¨åˆ‡æ¢</p><p>å®ç°çƒ­å¤‡ï¼Œå¼•å…¥ VIP çš„åˆ‡æ¢</p><p><img alt="ha3" src="/assets/images/ha3-57bd73db814df29a787a75d8a18f7dd8.jpg"></p><p><strong>é€šè¿‡ VIP çš„æ–¹å¼ï¼Œåˆ‡æ¢ä¸»å¤‡æœåŠ¡å™¨</strong></p><p>â‘  é»˜è®¤ VIP ç»‘å®šåœ¨ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰</p><p>â‘¡master ä¸å¯ç”¨ï¼Œå°±åˆ‡æ¢ VIP åˆ°å¤‡ä»½æœåŠ¡å™¨ï¼ˆbackupï¼‰</p><p>â‘¢ ç”¨æˆ·å¯ä»¥ä½¿ç”¨åˆ°è¿ç»­æ€§æ›´å¥½çš„æœåŠ¡ï¼Œé€šè¿‡ VIP è®¿é—®æœåŠ¡å™¨</p><p><strong>å¸¸ç”¨æ¥å•ç‹¬å®ç°é«˜å¯ç”¨çš„è½¯ä»¶ï¼š</strong></p><p><code>â‘ keepalived</code></p><p>â‘¡heartbeat è¾ƒæ—© å±äº redhat HA å·¥ç¨‹çš„ä¸€éƒ¨åˆ†</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2keepalived-ä»‹ç»">2ã€keepalived ä»‹ç»<a class="hash-link" href="#2keepalived-ä»‹ç»" title="Direct link to heading">â€‹</a></h3><p>â€‹ Keepalived è½¯ä»¶èµ·åˆæ˜¯ä¸“ä¸º LVS è´Ÿè½½å‡è¡¡è½¯ä»¶è®¾è®¡çš„ï¼Œç”¨æ¥ç®¡ç†å¹¶ç›‘æ§ LVS é›†ç¾¤ç³»ç»Ÿä¸­å„ä¸ªæœåŠ¡èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œåæ¥åˆåŠ å…¥äº†å¯ä»¥å®ç°é«˜å¯ç”¨çš„ VRRP åŠŸèƒ½ã€‚å› æ­¤ï¼ŒKeepalived é™¤äº†èƒ½å¤Ÿç®¡ç† LVS è½¯ä»¶å¤–ï¼Œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–æœåŠ¡ï¼ˆä¾‹å¦‚ï¼šNginxã€Haproxyã€MySQL ç­‰ï¼‰çš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆè½¯ä»¶</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3keepalived-ç»„æˆå’ŒåŸç†">3ã€keepalived ç»„æˆå’ŒåŸç†<a class="hash-link" href="#3keepalived-ç»„æˆå’ŒåŸç†" title="Direct link to heading">â€‹</a></h3><p>â€‹ Keepalived è½¯ä»¶ä¸»è¦æ˜¯é€šè¿‡ VRRP åè®®å®ç°é«˜å¯ç”¨åŠŸèƒ½çš„ã€‚</p><p>â€‹ VRRP æ˜¯ Virtual Router RedundancyProtocol(è™šæ‹Ÿè·¯ç”±å™¨å†—ä½™åè®®ï¼‰çš„ç¼©å†™ï¼ŒVRRP å‡ºç°çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³é™æ€è·¯ç”±å•ç‚¹æ•…éšœé—®é¢˜çš„ï¼Œå®ƒèƒ½å¤Ÿä¿è¯å½“ä¸ªåˆ«èŠ‚ç‚¹å®•æœºæ—¶ï¼Œæ•´ä¸ªç½‘ç»œå¯ä»¥ä¸é—´æ–­åœ°è¿è¡Œã€‚</p><p>â€‹ è™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®ç°è·¯ç”±å™¨é«˜å¯ç”¨çš„åè®®ï¼Œå³å°† N å°æä¾›ç›¸åŒåŠŸèƒ½çš„è·¯ç”±å™¨ç»„æˆä¸€ä¸ªè·¯ç”±å™¨ç»„ï¼Œè¿™ä¸ªç»„é‡Œé¢æœ‰ä¸€ä¸ª master å’Œå¤šä¸ª backupï¼Œmaster ä¸Šé¢æœ‰ä¸€ä¸ªå¯¹å¤–æä¾›æœåŠ¡çš„ vipï¼ˆè¯¥è·¯ç”±å™¨æ‰€åœ¨å±€åŸŸç½‘å†…å…¶ä»–æœºå™¨çš„é»˜è®¤è·¯ç”±ä¸ºè¯¥ vipï¼‰ï¼Œmaster ä¼šå‘ç»„æ’­ï¼Œå½“ backup æ”¶ä¸åˆ° vrrp åŒ…æ—¶å°±è®¤ä¸º master å®•æ‰äº†ï¼Œè¿™æ—¶å°±éœ€è¦æ ¹æ® VRRP çš„ä¼˜å…ˆçº§æ¥é€‰ä¸¾ä¸€ä¸ª backup å½“ masterã€‚è¿™æ ·çš„è¯å°±å¯ä»¥ä¿è¯è·¯ç”±å™¨çš„é«˜å¯ç”¨äº†ã€‚</p><p><img alt="ha4" src="/assets/images/ha4-7e7eafd5810a2a3f371d42faf203c9f5.jpg">
<img alt="ha5" src="/assets/images/ha5-61bf24b1c2c206f5af56accb9f2f76fb.JPG"></p><p>Keepalived çš„åŠŸèƒ½ä½“ç³»ç»“æ„ï¼Œå¤§è‡´åˆ†ä¸¤å±‚ï¼š<strong>ç”¨æˆ·ç©ºé—´ï¼ˆuser spaceï¼‰å’Œå†…æ ¸ç©ºé—´ï¼ˆkernel spaceï¼‰</strong>ã€‚</p><p><strong>å†…æ ¸ç©ºé—´ï¼š</strong></p><p>ä¸»è¦åŒ…æ‹¬ IPVSï¼ˆIP è™šæ‹ŸæœåŠ¡å™¨ï¼Œç”¨äºå®ç°ç½‘ç»œæœåŠ¡çš„è´Ÿè½½å‡è¡¡ï¼‰å’Œ NETLINKï¼ˆæä¾›é«˜çº§è·¯ç”±åŠå…¶ä»–ç›¸å…³çš„ç½‘ç»œåŠŸèƒ½ï¼‰ä¸¤ä¸ªéƒ¨ä»½ã€‚</p><p><strong>ç”¨æˆ·ç©ºé—´ï¼š</strong></p><blockquote><p>WatchDogï¼šè´Ÿè½½ç›‘æ§ checkers å’Œ VRRP è¿›ç¨‹çš„çŠ¶å†µ</p><p>VRRP Stackï¼šè´Ÿè½½å‡è¡¡å™¨ä¹‹é—´çš„å¤±è´¥åˆ‡æ¢ FailOverï¼Œå¦‚æœåªç”¨ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œåˆ™ VRRP ä¸æ˜¯å¿…é¡»çš„ã€‚</p><p>Checkersï¼šè´Ÿè´£çœŸå®æœåŠ¡å™¨çš„å¥åº·æ£€æŸ¥ healthcheckingï¼Œæ˜¯ keepalived æœ€ä¸»è¦çš„åŠŸèƒ½ã€‚æ¢è¨€ä¹‹ï¼Œå¯ä»¥æ²¡æœ‰ VRRP Stackï¼Œä½†å¥åº·æ£€æŸ¥ healthchecking æ˜¯ä¸€å®šè¦æœ‰çš„ã€‚</p><p>IPVS wrapperï¼šç”¨æˆ·å‘é€è®¾å®šçš„è§„åˆ™åˆ°å†…æ ¸ ipvs ä»£ç </p><p>Netlink Reflectorï¼šç”¨æ¥è®¾å®š vrrp çš„ vip åœ°å€ç­‰ã€‚</p></blockquote><p>keepalived ä¸»è¦ä½¿ç”¨ä¸‰ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ coreã€check å’Œ vrrpã€‚</p><p>core æ¨¡å—ä¸º keepalived çš„æ ¸å¿ƒï¼Œè´Ÿè´£ä¸»è¿›ç¨‹çš„å¯åŠ¨ã€ç»´æŠ¤ä»¥åŠå…¨å±€é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œè§£æã€‚</p><p>check è´Ÿè´£å¥åº·æ£€æŸ¥ï¼ŒåŒ…æ‹¬å¸¸è§çš„å„ç§æ£€æŸ¥æ–¹å¼ã€‚</p><p>vrrp æ¨¡å—æ˜¯æ¥å®ç° VRRP åè®®çš„ã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="4å®‰è£…é…ç½®å¯åŠ¨-keepalived">4ã€å®‰è£…é…ç½®å¯åŠ¨ keepalived<a class="hash-link" href="#4å®‰è£…é…ç½®å¯åŠ¨-keepalived" title="Direct link to heading">â€‹</a></h3><p>master å’Œ backup éƒ½éœ€è¦è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå°±æ˜¯ server01 å’Œ server03 æœºå™¨</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#å®‰è£…keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> yum -y </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> keepalived</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><table><thead><tr><th>ä¸»æœºåç§°</th><th>æœåŠ¡å™¨ IP</th><th></th></tr></thead><tbody><tr><td>server01</td><td>192.168.17.102</td><td>master</td></tr><tr><td>server03</td><td>192.168.17.101</td><td>backup</td></tr></tbody></table><p><strong>keepalived éœ€è¦ä½¿ç”¨çš„ç›®å½•å’Œæ–‡ä»¶ï¼š</strong></p><table><thead><tr><th>æ–‡ä»¶æˆ–è€…ç›®å½•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/etc/keepalived/keepalived.conf</td><td>ç”Ÿæ•ˆçš„é…ç½®æ–‡ä»¶</td></tr><tr><td>/etc/init.d/keepalived</td><td>æœåŠ¡å™¨ç®¡ç†è„šæœ¬</td></tr><tr><td>/var/log/messages</td><td>æ—¥å¿—ä¿¡æ¯</td></tr></tbody></table><p><strong>é…ç½® keepalived</strong></p><p><strong>â‘  å¤‡ä»½ä¸»å¤‡æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain">  /etc/keepalived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> keepalived.conf keepalived.conf_bak</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¡ åˆ†åˆ«ä¿®æ”¹ä¸»å¤‡æœåŠ¡å™¨é…ç½®æ–‡ä»¶</strong></p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell &gt; vim keepalived.conf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>ç¤ºä¾‹é…ç½®æ–‡ä»¶è¯´æ˜</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token operator">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#å‘é€é‚®ä»¶çš„é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     acassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     failover@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     sysadmin@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email_from Alexandre.Cassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_server </span><span class="token number">192.168</span><span class="token plain">.200.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_connect_timeout </span><span class="token number">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#vrrpåè®®çš„é…ç½®</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#å·¥ä½œæ¨¡å¼</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state MASTER</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#ç›‘å¬çš„ç½‘å¡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    interface eth0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#è™šæ‹Ÿè·¯ç”±id éœ€è¦å’Œå¤‡æœåŠ¡å™¨ä¸€è‡´</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_router_id </span><span class="token number">51</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#æƒé‡ ä¼˜å…ˆçº§</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    priority </span><span class="token number">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#vrrpåŒ…çš„å‘é€å‘¨æœŸ  1s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    advert_int </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#æƒé™éªŒè¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_type PASS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_pass </span><span class="token number">1111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#éœ€è¦ç»‘å®šåˆ‡æ¢çš„VIP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">192.168</span><span class="token plain">.200.16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">192.168</span><span class="token plain">.200.17</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">192.168</span><span class="token plain">.200.18</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>ä¸»æœåŠ¡å™¨</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token operator">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     acassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     failover@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     sysadmin@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email_from Alexandre.Cassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_server </span><span class="token number">192.168</span><span class="token plain">.200.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_connect_timeout </span><span class="token number">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state MASTER</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    interface eth0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_router_id </span><span class="token number">51</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    priority </span><span class="token number">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    advert_int </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_type PASS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_pass </span><span class="token number">1111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#masteré»˜è®¤åªéœ€è¦ä¿®æ”¹ä½¿ç”¨VIPå³å¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">192.168</span><span class="token plain">.17.200</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>å¤‡æœåŠ¡å™¨</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token operator">!</span><span class="token plain"> Configuration File </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">global_defs </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     acassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     failover@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     sysadmin@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   notification_email_from Alexandre.Cassen@firewall.loc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_server </span><span class="token number">192.168</span><span class="token plain">.200.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   smtp_connect_timeout </span><span class="token number">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vrrp_instance VI_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#ä¿®æ”¹å·¥ä½œæ¨¡å¼ä¸ºå¤‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    state BACKUP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    interface eth0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_router_id </span><span class="token number">51</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    priority </span><span class="token number">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    advert_int </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    authentication </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_type PASS</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        auth_pass </span><span class="token number">1111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#æ³¨æ„ä¿®æ”¹VIP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    virtual_ipaddress </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token number">192.168</span><span class="token plain">.17.200</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¢ åˆ†åˆ«æŒ‰ç…§é¡ºåºå¯åŠ¨ä¸»æœåŠ¡å™¨å’Œå¤‡æœåŠ¡å™¨çš„ keepalived</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> keepalived start</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘£ æŸ¥çœ‹ä¸»å¤‡æœåŠ¡å™¨çš„ç½‘å¡ä¿¡æ¯</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#éœ€è¦é€šè¿‡ip aå‘½ä»¤æŸ¥çœ‹  åˆ†åˆ«åœ¨server01å’Œserver03æŸ¥çœ‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">ip</span><span class="token plain"> a</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>##5ã€æ¨¡æ‹ŸæœåŠ¡å™¨ä¸å¯ç”¨ VIP åˆ‡æ¢</p><p>æœåŠ¡å™¨æ•´æœºä¸å¯ç”¨ï¼Œå¸¸è§äºæœåŠ¡å™¨æ–­ç½‘ï¼Œæˆ–è€…æ–­ç”µå…³æœºç­‰ã€‚</p><p><strong>æ–¹æ³•ä¸€ï¼šæ¨¡æ‹Ÿä¸»æœåŠ¡å™¨æ–­ç”µå…³é—­</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#å…³é—­ä¸»æœåŠ¡å™¨  VIPæ‰€åœ¨æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> poweroff</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>æ–¹æ³•äºŒï¼šæ¨¡æ‹Ÿä¸»æœåŠ¡å™¨æ–­ç½‘</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#å…³é—­VIPæ‰€åœ¨æœåŠ¡å™¨çš„ç½‘å¡  ä½¿å…¶ä¸èƒ½å¤Ÿè”ç½‘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> network stop</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>é€šè¿‡ä»¥ä¸Šå®éªŒæ£€æµ‹ï¼Œå‘ç°å½“ä¸»æœåŠ¡å™¨æ•´æœºä¸å¯ç”¨æ—¶ï¼ŒVIP ä¼šåˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="å®ç°æœåŠ¡-ha">å®ç°æœåŠ¡ HA<a class="hash-link" href="#å®ç°æœåŠ¡-ha" title="Direct link to heading">â€‹</a></h2><p>â€‹ é€šè¿‡ keepalived å¯ä»¥ç›´æ¥å®ç°ä¸»æœåŠ¡å™¨æ•´æœºä¸å¯ç”¨ï¼Œå®ç° VIP çš„åˆ‡æ¢ã€‚ä¿è¯ç”¨æˆ·å¯ä»¥é€šè¿‡ VIP è¿›è¡Œè®¿é—®æœåŠ¡ã€‚</p><p>ä½†æ˜¯å®é™…æƒ…å†µä¸‹ï¼Œå¾€å¾€å¹¶ä¸æ˜¯æœåŠ¡å™¨æ•´æœºä¸å¯ç”¨ï¼Œåªæ˜¯å¯¹åº”çš„æœåŠ¡æˆ–è€…è½¯ä»¶ä¸å¯ç”¨ã€‚</p><p>æ¯”å¦‚è¯´ï¼šnginx æä¾›çš„ web æœåŠ¡ï¼Œnginx è¿›ç¨‹å…³é—­</p><p>å°±éœ€è¦æ£€æµ‹å½“ nginx ä¸å¯ç”¨æ—¶ï¼Œå°±åˆ‡æ¢ VIP</p><p><strong>å®ç°è¿‡ç¨‹åˆ†æï¼š</strong></p><p>VIP å®é™…æ˜¯ç”± keepalived è¿›è¡Œç»‘å®šçš„ï¼Œæ‰€ä»¥å½“ nginx æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œå°±å…³é—­å½“å‰æœºå™¨çš„ keepalived å³å¯ï¼Œé‡Šæ”¾ VIPã€‚è¿›è€Œç»‘å®šåˆ°å…¶ä»–å¤‡ç”¨æœåŠ¡å™¨ã€‚</p><p>â‘  ç¼–å†™æœåŠ¡æ£€æµ‹è„šæœ¬ï¼Œå®ç°æ£€æµ‹ nginx æ˜¯å¦å¯ç”¨ï¼Œä¸å¯ç”¨åˆ™å…³é—­å½“å‰æ‰€åœ¨ä¸»æœºçš„ keepalived</p><p>â‘¡ åœ¨ keepalived é…ç½®ä¸­è°ƒç”¨æ£€æµ‹æœåŠ¡è„šæœ¬</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1nginx-æœåŠ¡å¯ç”¨æ£€æµ‹è„šæœ¬">1ã€Nginx æœåŠ¡å¯ç”¨æ£€æµ‹è„šæœ¬<a class="hash-link" href="#1nginx-æœåŠ¡å¯ç”¨æ£€æµ‹è„šæœ¬" title="Direct link to heading">â€‹</a></h3><p>ä¸»å¤‡æœåŠ¡å™¨éƒ½è¦å®ç°æ­¤è„šæœ¬</p><p><strong>â‘  ç¼–å†™æµ‹è¯•è„šæœ¬ èµ‹äºˆæ‰§è¡Œæƒé™</strong></p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell &gt; cd /etc/keepalived</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell &gt; vim check_nginx.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>è„šæœ¬å†…å®¹ï¼š</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">nginx_status</span><span class="token operator">=</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">ps</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> -C nginx --no-header </span><span class="token variable operator" style="color:rgb(189, 147, 249);font-style:italic">|</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> </span><span class="token variable function" style="color:rgb(80, 250, 123);font-style:italic">wc</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic"> -l</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$nginx_status</span><span class="token plain"> -eq </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token function" style="color:rgb(80, 250, 123)">service</span><span class="token plain"> keepalived stop</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fi</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ æ–¹ä¾¿ä¹‹åå…¶ä»–è½¯ä»¶è°ƒç”¨æ‰§è¡Œ</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x check_nginx.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>â‘¡ æµ‹è¯•è„šæœ¬å¯ç”¨æ€§</strong></p><p>å¯åŠ¨ nginx å’Œ keepalived</p><p>å…³é—­ nginx æ‰§è¡Œè„šæœ¬ æŸ¥çœ‹ keepalived æ˜¯å¦ä¹Ÿå…³é—­</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2æ¨¡æ‹Ÿå®•æœºå®ç°æœåŠ¡åˆ‡æ¢">2ã€æ¨¡æ‹Ÿå®•æœºå®ç°æœåŠ¡åˆ‡æ¢<a class="hash-link" href="#2æ¨¡æ‹Ÿå®•æœºå®ç°æœåŠ¡åˆ‡æ¢" title="Direct link to heading">â€‹</a></h3><p>åœ¨å¤šå°æœåŠ¡å™¨ä¸­é…ç½® keepalived å®šæ—¶è§¦å‘æ£€æµ‹ nginx çš„è„šæœ¬æ¨¡å—</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#åœ¨vrrp_instanceå¤–ä¸Šé¢å®šä¹‰</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vrrp_script check_nginx </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">#è°ƒç”¨è„šæœ¬åœ°å€</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   script  /etc/keepalived/check_nginx.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token comment" style="color:rgb(98, 114, 164)">#æ£€æµ‹é—´éš”æ—¶é—´</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   interval </span><span class="token number">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#åœ¨vrrp_instanceé‡Œè°ƒç”¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">track_script </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#ä¸Šçº¿å®šä¹‰çš„åç§°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    check_nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>##3ã€å®ç° web æœåŠ¡å™¨é«˜å¯ç”¨</p><p>ä»¥ä¸Šæ¡ˆä¾‹å·²ç»å®ç°äº†ï¼ŒæœåŠ¡ä¸å¯ç”¨ VIP åˆ‡æ¢åˆ°å¯ç”¨æœåŠ¡å™¨ã€‚</p><p>ç°åœ¨éœ€æ±‚ç”¨æˆ·çš„æœåŠ¡æ˜¯è¿ç»­ä¸é—´æ–­çš„ï¼Œæ•…<strong>ç”¨æˆ·éœ€è¦é€šè¿‡ VIP è¿›è¡Œè®¿é—®</strong></p><p><strong>â‘  è§£æåŸŸååˆ° VIP</strong></p><p><strong>â‘¡ æ¨¡æ‹Ÿç”¨æˆ·è®¿é—®</strong></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="keepalived-çš„é…ç½®è¡¥å……">keepalived çš„é…ç½®è¡¥å……<a class="hash-link" href="#keepalived-çš„é…ç½®è¡¥å……" title="Direct link to heading">â€‹</a></h2><blockquote><p>è„‘è£‚ï¼ˆè£‚è„‘ï¼‰ï¼švip å‡ºç°åœ¨äº†å¤šå°æœºå™¨ä¸Šã€‚ç½‘ç»œä¸é€šç•…ï¼Œç¦ç”¨äº†æ•°æ®åŒ…ï¼Œä¸»å¤‡æœåŠ¡å™¨æ²¡æ³•é€šè®¯ï¼Œé€ æˆå¤‡æœåŠ¡å™¨è®¤ä¸ºä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œç»‘å®š VIPï¼Œä¸»æœåŠ¡å™¨ VIP ä¸ä¼šé‡Šæ”¾ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>â‘  åŒå¤‡æˆ–è€…å¤šå¤‡æ¨¡å¼ BACKUP é€šè¿‡ priority æƒé‡æ¥åŒºåˆ†è°çš„ä¼˜å…ˆçº§æ›´é«˜</p><p>â‘¡ å•æ’­(å®šå‘å¹¿æ’­)çš„æ–¹å¼ (ä¸€äº›ç‰¹å®šç¯å¢ƒç¦ç”¨äº†ç»„æ’­æ–¹å¼)</p><p>â‘¢ æ—¶é—´ä¸åŒæ­¥ æœåŠ¡å™¨æ—¶é—´æ ¡æ—¶</p></blockquote><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1éæŠ¢å æ¨¡å¼">1ã€éæŠ¢å æ¨¡å¼<a class="hash-link" href="#1éæŠ¢å æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p><strong>â‘ nopreempt</strong></p><p>åœ¨ä¸»å¤‡æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œvrrp_instance æ®µä¸­</p><p><strong>â‘¡ è®¾ç½® state å·¥ä½œæ¨¡å¼ä¸º BACKUP</strong>
ä¸¤ä¸ª keepalived èŠ‚ç‚¹éƒ½å¯åŠ¨åï¼Œé»˜è®¤éƒ½æ˜¯ BACKUP çŠ¶æ€ï¼ŒåŒæ–¹åœ¨å‘é€ç»„æ’­ä¿¡æ¯åï¼Œä¼šæ ¹æ®ä¼˜å…ˆçº§æ¥é€‰ä¸¾ä¸€ä¸ª MASTER å‡ºæ¥ã€‚ç”±äºä¸¤è€…éƒ½é…ç½®äº† nopreemptï¼Œæ‰€ä»¥ MASTER ä»æ•…éšœä¸­æ¢å¤åï¼Œä¸ä¼šæŠ¢å  vipã€‚è¿™æ ·ä¼šé¿å… VIP åˆ‡æ¢å¯èƒ½é€ æˆçš„æœåŠ¡å»¶è¿Ÿã€‚</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2å•æ’­æ¨¡å¼">2ã€å•æ’­æ¨¡å¼<a class="hash-link" href="#2å•æ’­æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>ä¸€äº›ç‰¹å®šç¯å¢ƒä¸‹ä¸å…è®¸å‘é€ç»„æ’­ï¼Œé€ æˆå¤‡æœåŠ¡å™¨æ— æ³•æ”¶åˆ° vrrp åŒ…ï¼Œå¯èƒ½ä¼šé€ æˆè„‘è£‚ç°è±¡ã€‚å¯ä»¥é€šè¿‡å•æ’­çš„æ–¹å¼è§£å†³ã€‚</p><p><strong>å•æ’­ç¤ºä¾‹é…ç½®ï¼š</strong>æ³¨æ„æ­¤è¯­æ³•åœ¨ keepalived1.2.11 ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ</p><blockquote><p>unicast_src_ip 192.168.1.21##ï¼ˆæœ¬åœ° IP åœ°å€ï¼‰</p><p>unicast_peer {</p><p>â€‹ 192.168.1.22##ï¼ˆå¯¹ç«¯ IP åœ°å€ï¼‰æ­¤åœ°å€ä¸€å®šä¸èƒ½å¿˜è®°</p><p>}</p></blockquote><p><strong>ä¸»æœåŠ¡å™¨ server01 é…ç½®</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#åœ¨vrrp_instaceæ®µä¸­åŠ å…¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#æœ¬åœ°IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unicast_src_ip </span><span class="token number">192.168</span><span class="token plain">.17.102</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unicast_peer </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#å¯¹è±¡IP  å‘é€vrrpåŒ…ç»™å¤‡æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">192.168</span><span class="token plain">.17.101</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>å¤‡æœåŠ¡å™¨ server03 é…ç½®</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">#åœ¨vrrp_instaceæ®µä¸­åŠ å…¥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">#æœ¬åœ°IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unicast_src_ip </span><span class="token number">192.168</span><span class="token plain">.17.101</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">unicast_peer </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#å¯¹è±¡IP  å‘é€vrrpåŒ…ç»™å¤‡æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token number">192.168</span><span class="token plain">.17.102</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>tcpdump æŠ“ vrrp åŒ…çš„æ–¹å¼ï¼š</strong></p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">shell </span><span class="token operator">&gt;</span><span class="token plain"> tcpdump vrrp -n</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/Nginx/ha.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Nginx/safe"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">[Nginx] å®‰å…¨</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Nginx/lb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[Nginx] ä¼ä¸šæ¶æ„é«˜å¯ç”¨è´Ÿè½½å‡è¡¡LBæœåŠ¡å™¨</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡" class="table-of-contents__link toc-highlight">èƒŒæ™¯æè¿°åŠå…¶æ–¹æ¡ˆè®¾è®¡</a><ul><li><a href="#1ä¸šåŠ¡èƒŒæ™¯æè¿°" class="table-of-contents__link toc-highlight">1ã€ä¸šåŠ¡èƒŒæ™¯æè¿°</a></li><li><a href="#2æ¨¡æ‹Ÿè¿ç»´è®¾è®¡æ–¹æ¡ˆ" class="table-of-contents__link toc-highlight">2ã€æ¨¡æ‹Ÿè¿ç»´è®¾è®¡æ–¹æ¡ˆ</a></li></ul></li><li><a href="#æ•°æ®åº“æœåŠ¡å™¨è¿ç§»" class="table-of-contents__link toc-highlight">æ•°æ®åº“æœåŠ¡å™¨è¿ç§»</a><ul><li><a href="#1æœåŠ¡å™¨-ip" class="table-of-contents__link toc-highlight">1ã€æœåŠ¡å™¨ ip</a></li><li><a href="#2æœåŠ¡å™¨åŸºæœ¬é…ç½®" class="table-of-contents__link toc-highlight">2ã€æœåŠ¡å™¨åŸºæœ¬é…ç½®</a></li><li><a href="#3æ•°æ®å¤‡ä»½å’Œè¿ç§»" class="table-of-contents__link toc-highlight">3ã€æ•°æ®å¤‡ä»½å’Œè¿ç§»</a></li></ul></li><li><a href="#é«˜å¯ç”¨æœåŠ¡æ­å»º" class="table-of-contents__link toc-highlight">é«˜å¯ç”¨æœåŠ¡æ­å»º</a><ul><li><a href="#1ha-é«˜å¯ç”¨" class="table-of-contents__link toc-highlight">1ã€HA é«˜å¯ç”¨</a></li><li><a href="#2keepalived-ä»‹ç»" class="table-of-contents__link toc-highlight">2ã€keepalived ä»‹ç»</a></li><li><a href="#3keepalived-ç»„æˆå’ŒåŸç†" class="table-of-contents__link toc-highlight">3ã€keepalived ç»„æˆå’ŒåŸç†</a></li><li><a href="#4å®‰è£…é…ç½®å¯åŠ¨-keepalived" class="table-of-contents__link toc-highlight">4ã€å®‰è£…é…ç½®å¯åŠ¨ keepalived</a></li></ul></li><li><a href="#å®ç°æœåŠ¡-ha" class="table-of-contents__link toc-highlight">å®ç°æœåŠ¡ HA</a><ul><li><a href="#1nginx-æœåŠ¡å¯ç”¨æ£€æµ‹è„šæœ¬" class="table-of-contents__link toc-highlight">1ã€Nginx æœåŠ¡å¯ç”¨æ£€æµ‹è„šæœ¬</a></li><li><a href="#2æ¨¡æ‹Ÿå®•æœºå®ç°æœåŠ¡åˆ‡æ¢" class="table-of-contents__link toc-highlight">2ã€æ¨¡æ‹Ÿå®•æœºå®ç°æœåŠ¡åˆ‡æ¢</a></li></ul></li><li><a href="#keepalived-çš„é…ç½®è¡¥å……" class="table-of-contents__link toc-highlight">keepalived çš„é…ç½®è¡¥å……</a><ul><li><a href="#1éæŠ¢å æ¨¡å¼" class="table-of-contents__link toc-highlight">1ã€éæŠ¢å æ¨¡å¼</a></li><li><a href="#2å•æ’­æ¨¡å¼" class="table-of-contents__link toc-highlight">2ã€å•æ’­æ¨¡å¼</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.c2d35455.js"></script>
<script src="/assets/js/main.dd54a102.js"></script>
</body>
</html>