<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Aoki 的自留地 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Aoki 的自留地 Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Aoki 的自留地" href="/opensearch.xml"><title data-react-helmet="true">[DevOps] Docker三剑客 | Aoki 的自留地</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://phero.live/docs/DevOps/18"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="[DevOps] Docker三剑客 | Aoki 的自留地"><meta data-react-helmet="true" name="description" content="Docker 三剑客介绍"><meta data-react-helmet="true" property="og:description" content="Docker 三剑客介绍"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://phero.live/docs/DevOps/18"><link data-react-helmet="true" rel="alternate" href="https://phero.live/docs/DevOps/18" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://phero.live/docs/DevOps/18" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BMRZNSN9O0-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.b35462c9.css">
<link rel="preload" href="/assets/js/runtime~main.dc09de2b.js" as="script">
<link rel="preload" href="/assets/js/main.283c929e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Aoki</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">笔记</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aokikoko" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">我的知识库 😀</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/CSS/transition-animation-transform">CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/DocusaurusTips/code-theme">Docusaurus使用技巧</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/TypeScript/basic-types">TypeScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/architecture/history">架构</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Algorithm/algo">算法</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Another/bigo">interview2</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Cli/ESLint">Cli</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/DevOps/prometheus">DevOps</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/prometheus">[DevOps] 普罗米修斯</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/daima">[DevOps] 代码更新方法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/jenkins">[DevOps] jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/paas">[DevOps] 容器-虚拟化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/docker1">[DevOps] 容器技术管理工具-Docker(上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/docker2">[DevOps] 容器技术管理工具-Docker(中)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/docker3">[DevOps] 容器技术管理工具-Docker(下)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/dockercompose">[DevOps] 容器编排-docker compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/autopublish">[DevOps] 代码自动发布系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/DevOps/18">[DevOps] Docker三剑客</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/DevOps/kubernetes">[DevOps] kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Http/OptionsRequest">Http</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Java/basic">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Linux/basic">Linux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Mysql/case">Mysql</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Nginx/sign">Nginx</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Node.js/buffer">Node.js</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/React/jsx">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/interview/http">interview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/javascript/ecma">javascript</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_eoK2"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_e+kA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>[DevOps] Docker三剑客</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="docker-三剑客介绍">Docker 三剑客介绍<a class="hash-link" href="#docker-三剑客介绍" title="Direct link to heading">​</a></h2><p>为了把容器化技术的优点发挥得更好，docker 公司先后推出了三大技术:</p><ul><li>docker-machine</li><li>docker-compose</li><li>docker-swarm</li></ul><p>使用&quot;三剑客&quot;可以帮助我们解决 docker host 维护,多容器编排部署,多个 docker host 集群的各个难题。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="docker-machine">Docker machine<a class="hash-link" href="#docker-machine" title="Direct link to heading">​</a></h2><p>docker 使用了 linux 的内核技术(namespace,cgroup 等),那么如果我想在 windows 或 Mac 系统上运行 docker 怎么办呢?</p><p>答案是借助虚拟机来实现,也就是说我在 windows 或 Mac 上运行一个 linux 虚拟机,再在虚拟机里运行 docker。</p><p><img alt="machine" src="/assets/images/machine-51d3a5969d8635bdd78c2cf2f762871d.JPG"></p><p>docker-machine 就是 docker 公司官方提出的,用于在各种平台上快速创建具有 docker 服务的虚拟机的技术.</p><p>参考: <a href="https://docs.docker.com/machine/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/machine/</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="docker-compose">Docker compose<a class="hash-link" href="#docker-compose" title="Direct link to heading">​</a></h2><p>用容器运行一个服务,需要使用 docker run 命令。但如果我要运行多个服务呢? 假设我要运行一个 web 服务,还要运行一个 db 服务,那么是用一个容器运行,还是用多个容器运行呢?</p><p>一个容器运行多个服务会造成镜像的复杂度提高,docker 倾向于一个容器运行一个应用。</p><p>那么复杂的架构就会需要很多的容器,并且需要它们之间有关联(容器之间的依赖和连接)就更复杂了。</p><p>这个复杂的问题需要解决,这就涉及到了<code>容器编排</code>的问题了。</p><p>docker-compose 就是可以做容器编排的小工具，它可以在一个文件中定义多个容器,只用一行命令就可以让一切就绪并运行。</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="docker-compose-安装">docker-compose 安装<a class="hash-link" href="#docker-compose-安装" title="Direct link to heading">​</a></h3><p>方法 1: 使用 pip 安装</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># yum install epel-release -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># yum install python2-pip -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># pip2.7 install docker-compose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>卸载方法:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># pip uninstall docker-compose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>方法 2: 直接下载</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># curl -L</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token string" style="color:rgb(255, 121, 198)">&quot;https://github.com/docker/compose/releases/download/1.24.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token string" style="color:rgb(255, 121, 198)">1/docker-compose-</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -s</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">-</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token string variable function" style="color:rgb(80, 250, 123);font-style:italic">uname</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic"> -m</span><span class="token string variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;</span><span class="token plain"> -o</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># chmod +x /usr/local/bin/docker-compose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>卸载方法:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># rm /usr/local/bin/docker-compose</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>安装完后验证</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)"># docker-compose -v</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">docker-compose</span><span class="token plain"> version </span><span class="token number">1.24</span><span class="token plain">.1, build </span><span class="token number">4667896</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="使用-docker-compose-的三个步骤">使用 docker-compose 的三个步骤<a class="hash-link" href="#使用-docker-compose-的三个步骤" title="Direct link to heading">​</a></h3><p>Docker Compose 将所管理的容器分为三层</p><ol><li>工程（project）</li><li>服务（service）</li><li>容器（contaienr）</li></ol><p>Docker Compose 运行的目录下的所有文件（docker-compose.yml,extends 文件或环境变量文件等）组成一个工程，若无特殊指定工程名即为当前目录名。</p><p>一个工程当中可包含多个服务，每个服务中定义了容器运行的镜像，参数，依赖。</p><p>一个服务当中可包括多个容器实例</p><p>使用 Compose 基本上分为三步：</p><ol><li>Dockerfile 定义应用的运行环境（镜像)</li><li>docker-compose.yml 定义组成应用的各服务</li><li>docker-compose up 构建并启动整个应用</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="docker-compose-常见语法">docker compose 常见语法<a class="hash-link" href="#docker-compose-常见语法" title="Direct link to heading">​</a></h2><p>docker compose 使用.yml 或.yaml 后缀</p><p>参考: <a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/compose-file/</a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="build">build<a class="hash-link" href="#build" title="Direct link to heading">​</a></h3><p>指定镜像构建时的 dockerfile 目录,格式一般为绝对路径目录或相对路径目录(dockerfile 需要命名为 Dockerfile)</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">build: /path/to/build/dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">或者</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">build: ./dir</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="image">image<a class="hash-link" href="#image" title="Direct link to heading">​</a></h3><p>指定要启动容器的镜像</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: redis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: ubuntu:14.04</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: tutum/influxdb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: example-registry.com:4000/postgresql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: a4bc65fd</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>如果镜像不存在,compose 尝试拉它</p><p>如果指定了构建, 可以使用指定的选项构建它,并使用指定的 tag 进行标记</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="environment">environment<a class="hash-link" href="#environment" title="Direct link to heading">​</a></h3><p>设置镜像变量，它可以保存变量到镜像里面，也就是说启动的容器也会包含这些变量设置</p><p>environment 和 Dockerfile 中的 ENV 指令一样会把变量一直保存在镜像容器中</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RACK_ENV: development</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SHOW: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">或</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">RACK_ENV</span><span class="token operator">=</span><span class="token plain">development</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">SHOW</span><span class="token operator">=</span><span class="token plain">true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="expose">expose<a class="hash-link" href="#expose" title="Direct link to heading">​</a></h3><p>这个标签与 Dockerfile 中的 EXPOSE 指令一样，用于指定暴露的端口，但只将端口暴露给连接的服务，而不暴露给主机.</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;8000&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="ports">ports<a class="hash-link" href="#ports" title="Direct link to heading">​</a></h3><p>映射端口，可以使用 HOST:CONTAINER 的方式指定端口，也可以指定容器端口（选择临时主机端口），宿主机会随机映射端口</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3000-3005&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;8000:8000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;9090-9091:8080-8081&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;49100:22&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;127.0.0.1:8001:8001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;6060:6060/udp&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="restart">restart<a class="hash-link" href="#restart" title="Direct link to heading">​</a></h3><p>指定 Docker 容器的重启策略</p><p>默认值为 no ，即在任何情况下都不会重新启动容器</p><p>当值为 always 时，容器退出时总是重新启动；</p><p>当值为 on-failure 时，当出现 on-failure 报错（非正常退出，退出状态非 0）,才会重启容器</p><p>当值为 unless-stopped 时, 在容器退出时总是重启容器，但是不考虑在 Docker 守护进程启动时就已经停止了的容器</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: on-failure</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: on-failure:3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: unless-stopped</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="volume">volume<a class="hash-link" href="#volume" title="Direct link to heading">​</a></h3><p>数据卷挂载，可以直接使用 HOST:CONTAINER 这样的格式或者使用 HOST:CONTAINER:ro 这样的格式，ro 代表数据卷是只读的</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 只是指定一个路径，Docker 会自动在创建一个数据卷（这个路径是容器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">内部的）。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- /var/lib/mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 使用绝对路径挂载数据卷</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- /opt/data:/var/lib/mysql</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 以Compose配置文件为中心的相对路径作为数据卷挂载到容器。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ./cache:/tmp/cache</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 使用用户的相对路径（~/ 表示的目录是 /home/&lt;用户目录&gt;/ 或者</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/root/）。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ~/configs:/etc/configs/:ro</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># 已经存在的命名的数据卷。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- datavolume:/var/lib/mysql</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="depends_on">depends_on<a class="hash-link" href="#depends_on" title="Direct link to heading">​</a></h3><p>此标签解决了容器的依赖、启动先后的问题</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">version: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  web:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    build: </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      - redis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  redis:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: redis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  db:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    image: mysql</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>使用 docker-compose up web 启动,会先启动 redis 和 db,再启动 web</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="links">links<a class="hash-link" href="#links" title="Direct link to heading">​</a></h3><p>链接到其它服务的中的容器, 与 link 连接一样效果，会连接到其它服务中的容器</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">web:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">links:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- db:database</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- redis</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="docker-compose-基础应用案例一">docker-compose 基础应用案例一<a class="hash-link" href="#docker-compose-基础应用案例一" title="Direct link to heading">​</a></h2><p>参考: <a href="https://docs.docker.com/compose/gettingstarted/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/compose/gettingstarted/</a></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="案例-1-wordpress-应用">案例 1: wordpress 应用<a class="hash-link" href="#案例-1-wordpress-应用" title="Direct link to heading">​</a></h3><p>1, 创建一个名为 wordpress 的 project(工程)</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir -p /doker-compose/wordpress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cd /doker-compose/wordpress</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2, 创建 docker-compose.yml</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel wordpress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">version: </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;3&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">db:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: mysql:5.7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;./data:/var/lib/mysql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MYSQL_ROOT_PASSWORD: wordpress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MYSQL_DATABASE: wordpress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MYSQL_USER: wordpress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MYSQL_PASSWORD: wordpress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3306&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wordpress:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">depends_on:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: wordpress:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">links:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;8010:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">restart: always</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">environment:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORDPRESS_DB_HOST: db:3306</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">WORDPRESS_DB_PASSWORD: wordpress</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>说明:</p><p>这个应用定义了两个容器服务：db, wordpress</p><p>db 容器通过 mysql:5.7 镜像启动</p><ul><li>MySQL 的数据目录挂载到当前目录./data，此目录不存在会自动创建</li><li>容器重启策略为 always</li><li>设置了连接 mysql 的 4 个变量</li></ul><p>wordpress 容器通过 wordpress:latest 启动</p><ul><li>需要 db 容器先启动再启动 wordpress 容器</li><li>wordpress 容器要 link 连接 db 容器</li><li>wordpress 容器将 80 端口映射到宿主机的 8010 端口</li><li>容器重启策略为 always</li><li>设置连接数据库的变量</li></ul><p>3, 启动</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel wordpress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker-compose up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>如果本地没有镜像,下载的两个镜像比较大</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel wordpress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker images</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">REPOSITORY TAG IMAGE ID</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CREATED SIZE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mysql </span><span class="token number">5.7</span><span class="token plain"> e9c354083de7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">3</span><span class="token plain"> days ago 373MB</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wordpress latest 4ba1e63bd20c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">8</span><span class="token plain"> days ago 501MB</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>4, 访问</p><p>访问容器主机的 8010 端口</p><p>5, 不用了可以关闭并删除</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel wordpress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker-compose stop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Stopping wordpress_wordpress_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Stopping wordpress_db_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel wordpress</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker-compose rm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Going to remove wordpress_wordpress_1, wordpress_db_1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Are you sure? </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">yN</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> y 输</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">入y确认删除容器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Removing wordpress_wordpress_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Removing wordpress_db_1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">. </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="案例-2-haproxy-应用">案例 2: haproxy 应用<a class="hash-link" href="#案例-2-haproxy-应用" title="Direct link to heading">​</a></h3><p>1, 创建一个工程目录 haproxy</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel ~</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># mkdir -p /docker-compose/haproxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># cd /docker-compose/haproxy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>2, 准备 haproxy.cfg 配置文件</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim haproxy.cfg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log </span><span class="token number">127.0</span><span class="token plain">.0.1 local0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log </span><span class="token number">127.0</span><span class="token plain">.0.1 local1 notice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">defaults</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">log global</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mode http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">option httplog</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">option dontlognull</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">timeout</span><span class="token plain"> connect 5000ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">timeout</span><span class="token plain"> client 50000ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">timeout</span><span class="token plain"> server 50000ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">stats uri /status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">frontend balancer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">bind</span><span class="token plain"> </span><span class="token number">0.0</span><span class="token plain">.0.0:80</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mode http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">default_backend web_backends</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">backend web_backends</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mode http</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">option forwardfor</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">balance roundrobin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server web1 web1:80 check</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server web2 web2:80 check</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server web3 web3:80 check</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">option httpchk GET /</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">http-check </span><span class="token function" style="color:rgb(80, 250, 123)">expect</span><span class="token plain"> status </span><span class="token number">200</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>3, 创建编排脚本</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@vm1 haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># vim docker-compose.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">web1:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: httpd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ./httpd1:/usr/local/apache2/htdocs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">web2:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: httpd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ./httpd2:/usr/local/apache2/htdocs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">web3:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: httpd:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ./httpd3:/usr/local/apache2/htdocs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token number">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">haproxy:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">image: haproxy:latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg:ro</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">links:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- web1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- web2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- web3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ports:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;80:80&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">- </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;80&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>4, 启动应用</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># docker-compose up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>5, 在挂载目录建立不同的主页用于测试</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># echo web1 &gt; httpd1/index.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># echo web2 &gt; httpd2/index.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">root@daniel haproxy</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token comment" style="color:rgb(98, 114, 164)"># echo web3 &gt; httpd3/index.html</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>6, 访问 http:// docker 宿主机 IP :80 验证是否负载均衡调度</p><p>访问 http:// docker 宿主机 IP :80/status 验证是否有状态页面</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aokikoko/aokikoko.github.io/blob/main/website/docs/DevOps/18.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/DevOps/autopublish"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">[DevOps] 代码自动发布系统</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/DevOps/kubernetes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[DevOps] kubernetes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#docker-三剑客介绍" class="table-of-contents__link toc-highlight">Docker 三剑客介绍</a></li><li><a href="#docker-machine" class="table-of-contents__link toc-highlight">Docker machine</a></li><li><a href="#docker-compose" class="table-of-contents__link toc-highlight">Docker compose</a><ul><li><a href="#docker-compose-安装" class="table-of-contents__link toc-highlight">docker-compose 安装</a></li><li><a href="#使用-docker-compose-的三个步骤" class="table-of-contents__link toc-highlight">使用 docker-compose 的三个步骤</a></li></ul></li><li><a href="#docker-compose-常见语法" class="table-of-contents__link toc-highlight">docker compose 常见语法</a><ul><li><a href="#build" class="table-of-contents__link toc-highlight">build</a></li><li><a href="#image" class="table-of-contents__link toc-highlight">image</a></li><li><a href="#environment" class="table-of-contents__link toc-highlight">environment</a></li><li><a href="#expose" class="table-of-contents__link toc-highlight">expose</a></li><li><a href="#ports" class="table-of-contents__link toc-highlight">ports</a></li><li><a href="#restart" class="table-of-contents__link toc-highlight">restart</a></li><li><a href="#volume" class="table-of-contents__link toc-highlight">volume</a></li><li><a href="#depends_on" class="table-of-contents__link toc-highlight">depends_on</a></li><li><a href="#links" class="table-of-contents__link toc-highlight">links</a></li></ul></li><li><a href="#docker-compose-基础应用案例一" class="table-of-contents__link toc-highlight">docker-compose 基础应用案例一</a><ul><li><a href="#案例-1-wordpress-应用" class="table-of-contents__link toc-highlight">案例 1: wordpress 应用</a></li><li><a href="#案例-2-haproxy-应用" class="table-of-contents__link toc-highlight">案例 2: haproxy 应用</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.dc09de2b.js"></script>
<script src="/assets/js/main.283c929e.js"></script>
</body>
</html>